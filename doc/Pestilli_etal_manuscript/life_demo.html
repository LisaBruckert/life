<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of life_demo</title>
  <meta name="keywords" content="life_demo">
  <meta name="description" content="% Example of initialization and fitting of the LiFE model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">Pestilli_etal_manuscript</a> &gt; life_demo.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Pestilli_etal_manuscript&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>life_demo
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% Example of initialization and fitting of the LiFE model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [fh, fe] = life_demo() </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Example of initialization and fitting of the LiFE model
 This demo function illustrates how to:
  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in
  the code below. This model contains a prediction of the diffusion
  measurements in each white-matter voxel given by the fascicles contained
  in a tractogrpahy solution, the connectome. Each fascicles makes a
  prediction about the direction of diffusion in the set of voxels where
  it travels through. The prediction is generated given the fascicle
  orientation and position isndie the voxel. Predictions from multiple
  fascicles in in each voxels are combined to generate a global connectome
  prediciton for the diffusion signal in large sets of white matter
  voxels.
  - B - Fit the LiFE model to compute the weights associated to each fascicle
  in the connectome. Fascicles in the conenctome contribute differently to
  predicting the diffusion signal in each voxel. First of all, fascicles
  make predictions about the diffusion only in voxels where they travel.
  Secondly, some fascicles have paths that produce better diffusion
  predictions than others. We use a least-square method to find the
  contribution of each fascicle to the diffusion signal in the white
  matter voxels where the fascicles travels. A single weight is assigned
  to each fascicle representing the global contribution of the fasicle to
  the signal of all the voxels along its path - we call this
  fascicle-global. Because multiple fascicles exist in several voxels the
  set of fascicles weights and fascicles predicitons represents the
  connectome-global prediction of the diffusion signal within the entire
  set of white matter voxels. Estimating the fascicle weights allows for
  evaluating the quality of the tractography solution. Eliminating
  fascicles that do not contribute to predicting the diffusion signal
  (they have assigned a zreo-weight). Finaly, the root-mean-squared error
  (RMSE) of the model to the diffusion data - the model prediction error -
  is used to evaluate the model prediction quality, compare different
  tractography models and to perform statistical inference on the on
  properties of the connectomes.
  - C - Compare two different connectome models. This demo will show how to
  compare two different conenctome models by using the diffusion
  prediction error (the Root-Mean-Squared Error, RMSE). We report the
  example of two conenctomes one generated using Constrained-spherical
  deconvolution (CSD) and probabilistic tractography the other using a
  tensor model and deterministic tractography
  - D - Not Implemented : Performs a virtual lesion.
  - Note - The example connectomes used for this demo comprise a portion
  of the right occiptial lobe of an individual human brain. LiFE utilizes
  large-scale methods to solve the foward model. The software allows for
  solving connectomes spanning the entire white-matter of idnvidual
  brains. The size of the connectome on the test data set is small enought
  to allow for testing the code within a few minutes requiring only about
  10GB of computer RAM and standard hardaware. This code has been tested
  with: 
   - Ubuntu 12.04.4 LTS (Precise) 
   - 2.6Ghz i7 Processor and 24GB of RAM.
   - MatLab Version: 8.0.0.783 (R2012b)

 Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [fh, rmse, rmsexv] = plotHistRMSE(info)</a></li><li><a href="#_sub2" class="code">function [fh, R] = plotHistRrmse(info)</a></li><li><a href="#_sub3" class="code">function [fh, w] = plotHistWeigths(info)</a></li><li><a href="#_sub4" class="code">function fh = scatterPlotRMSE(det,prob)</a></li><li><a href="#_sub5" class="code">function fh = distributionPlotStrengthOfEvidence(se)</a></li><li><a href="#_sub6" class="code">function fh = distributionPlotEarthMoversDistance(se)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [fh, fe] = life_demo()</a>
0002 <span class="comment">%% Example of initialization and fitting of the LiFE model</span>
0003 <span class="comment">% This demo function illustrates how to:</span>
0004 <span class="comment">%  - A - Set up a LiFE structure, identified as 'fe' (fascicle evaluation) in</span>
0005 <span class="comment">%  the code below. This model contains a prediction of the diffusion</span>
0006 <span class="comment">%  measurements in each white-matter voxel given by the fascicles contained</span>
0007 <span class="comment">%  in a tractogrpahy solution, the connectome. Each fascicles makes a</span>
0008 <span class="comment">%  prediction about the direction of diffusion in the set of voxels where</span>
0009 <span class="comment">%  it travels through. The prediction is generated given the fascicle</span>
0010 <span class="comment">%  orientation and position isndie the voxel. Predictions from multiple</span>
0011 <span class="comment">%  fascicles in in each voxels are combined to generate a global connectome</span>
0012 <span class="comment">%  prediciton for the diffusion signal in large sets of white matter</span>
0013 <span class="comment">%  voxels.</span>
0014 <span class="comment">%  - B - Fit the LiFE model to compute the weights associated to each fascicle</span>
0015 <span class="comment">%  in the connectome. Fascicles in the conenctome contribute differently to</span>
0016 <span class="comment">%  predicting the diffusion signal in each voxel. First of all, fascicles</span>
0017 <span class="comment">%  make predictions about the diffusion only in voxels where they travel.</span>
0018 <span class="comment">%  Secondly, some fascicles have paths that produce better diffusion</span>
0019 <span class="comment">%  predictions than others. We use a least-square method to find the</span>
0020 <span class="comment">%  contribution of each fascicle to the diffusion signal in the white</span>
0021 <span class="comment">%  matter voxels where the fascicles travels. A single weight is assigned</span>
0022 <span class="comment">%  to each fascicle representing the global contribution of the fasicle to</span>
0023 <span class="comment">%  the signal of all the voxels along its path - we call this</span>
0024 <span class="comment">%  fascicle-global. Because multiple fascicles exist in several voxels the</span>
0025 <span class="comment">%  set of fascicles weights and fascicles predicitons represents the</span>
0026 <span class="comment">%  connectome-global prediction of the diffusion signal within the entire</span>
0027 <span class="comment">%  set of white matter voxels. Estimating the fascicle weights allows for</span>
0028 <span class="comment">%  evaluating the quality of the tractography solution. Eliminating</span>
0029 <span class="comment">%  fascicles that do not contribute to predicting the diffusion signal</span>
0030 <span class="comment">%  (they have assigned a zreo-weight). Finaly, the root-mean-squared error</span>
0031 <span class="comment">%  (RMSE) of the model to the diffusion data - the model prediction error -</span>
0032 <span class="comment">%  is used to evaluate the model prediction quality, compare different</span>
0033 <span class="comment">%  tractography models and to perform statistical inference on the on</span>
0034 <span class="comment">%  properties of the connectomes.</span>
0035 <span class="comment">%  - C - Compare two different connectome models. This demo will show how to</span>
0036 <span class="comment">%  compare two different conenctome models by using the diffusion</span>
0037 <span class="comment">%  prediction error (the Root-Mean-Squared Error, RMSE). We report the</span>
0038 <span class="comment">%  example of two conenctomes one generated using Constrained-spherical</span>
0039 <span class="comment">%  deconvolution (CSD) and probabilistic tractography the other using a</span>
0040 <span class="comment">%  tensor model and deterministic tractography</span>
0041 <span class="comment">%  - D - Not Implemented : Performs a virtual lesion.</span>
0042 <span class="comment">%  - Note - The example connectomes used for this demo comprise a portion</span>
0043 <span class="comment">%  of the right occiptial lobe of an individual human brain. LiFE utilizes</span>
0044 <span class="comment">%  large-scale methods to solve the foward model. The software allows for</span>
0045 <span class="comment">%  solving connectomes spanning the entire white-matter of idnvidual</span>
0046 <span class="comment">%  brains. The size of the connectome on the test data set is small enought</span>
0047 <span class="comment">%  to allow for testing the code within a few minutes requiring only about</span>
0048 <span class="comment">%  10GB of computer RAM and standard hardaware. This code has been tested</span>
0049 <span class="comment">%  with:</span>
0050 <span class="comment">%   - Ubuntu 12.04.4 LTS (Precise)</span>
0051 <span class="comment">%   - 2.6Ghz i7 Processor and 24GB of RAM.</span>
0052 <span class="comment">%   - MatLab Version: 8.0.0.783 (R2012b)</span>
0053 <span class="comment">%</span>
0054 <span class="comment">% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</span>
0055 
0056 <span class="comment">% Intialize a local matlab cluster if the parallel toolbox is available.</span>
0057 <span class="comment">% This helps speeding up computations espacially for large conenctomes.</span>
0058 feOpenLocalCluster;
0059 
0060 <span class="comment">%% Build the file names for the diffusion data, the anatomical MRI.</span>
0061 dwiFile       = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'pestilli_etal_life_demo_scan1_subject1_b2000_150dirs_stanford.nii.gz'</span>);
0062 dwiFileRepeat = fullfile(lifeDemoDataPath(<span class="string">'diffusion'</span>),<span class="string">'pestilli_etal_life_demo_scan2_subject1_b2000_150dirs_stanford.nii.gz'</span>);
0063 t1File        = fullfile(lifeDemoDataPath(<span class="string">'anatomy'</span>),  <span class="string">'pestilli_etal_life_demo_anatomy_t1w_stanford.nii.gz'</span>);
0064 
0065 <span class="comment">%% (1) Evaluate the Probabilistic CSD-based connectome.</span>
0066 <span class="comment">% We will analyze first the CSD-based probabilistic tractography</span>
0067 <span class="comment">% connectome.</span>
0068 prob.tractography = <span class="string">'Probabilistic'</span>;
0069 fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
0070                 <span class="string">'pestilli_et_al_life_demo_mrtrix_csd_lmax10_probabilistic.mat'</span>);
0071 
0072 <span class="comment">% The final connectome and data astructure will be saved with this name:</span>
0073 feFileName    = <span class="string">'life_build_model_demo_CSD_PROB'</span>;
0074 
0075 <span class="comment">%% (1.1) Initialize the LiFE model structure, 'fe' in the code below.</span>
0076 <span class="comment">% This structure contains the forward model of diffusion based on the</span>
0077 <span class="comment">% tractography solution. It also contains all the information necessary to</span>
0078 <span class="comment">% compute model accuracry, and perform statistical tests. You can type</span>
0079 <span class="comment">% help('feBuildModel') in the MatLab prompt for more information.</span>
0080 fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
0081 
0082 <span class="comment">%% (1.2) Fit the model.</span>
0083 <span class="comment">% Hereafter we fit the forward model of tracrography using a least-squared</span>
0084 <span class="comment">% method. The information generated by fitting the model (fiber weights</span>
0085 <span class="comment">% etc) is then installed in the LiFE structure.</span>
0086 fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
0087 
0088 <span class="comment">%% (1.3) Extract the RMSE of the model on the fitted data set.</span>
0089 <span class="comment">% We now use the LiFE structure and the fit to compute the error in each</span>
0090 <span class="comment">% white-matter voxel spanned by the tractography model.</span>
0091 prob.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
0092 
0093 <span class="comment">%% (1.4) Extract the RMSE of the model on the second data set.</span>
0094 <span class="comment">% Here we show how to compute the cross-valdiated RMSE of the tractography</span>
0095 <span class="comment">% model in each white-matter voxel. We store this information for later use</span>
0096 <span class="comment">% and to save computer memory.</span>
0097 prob.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
0098 
0099 <span class="comment">%% (1.5) Extract the Rrmse.</span>
0100 <span class="comment">% We show how to extract the ratio between the model prediction error</span>
0101 <span class="comment">% (RMSE) and the test-retest reliability of the data.</span>
0102 prob.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
0103 
0104 <span class="comment">%% (1.6) Extract the fitted weights for the fascicles.</span>
0105 <span class="comment">% The following line shows how to extract the weight assigned to each</span>
0106 <span class="comment">% fascicle in the connectome.</span>
0107 prob.w      = feGet(fe,<span class="string">'fiber weights'</span>);
0108 
0109 <span class="comment">%% (1.7) Plot a histogram of the RMSE.</span>
0110 <span class="comment">% We plot the histogram of  RMSE across white-mater voxels.</span>
0111 [fh(1), ~, ~] = <a href="#_sub1" class="code" title="subfunction [fh, rmse, rmsexv] = plotHistRMSE(info)">plotHistRMSE</a>(prob);
0112 
0113 <span class="comment">%% (1.8) Plot a histogram of the RMSE ratio.</span>
0114 <span class="comment">% As a reminder the Rrmse is the ratio between data test-retest reliability</span>
0115 <span class="comment">% and model error (the quality of the model fit).</span>
0116 [fh(2), ~] = <a href="#_sub2" class="code" title="subfunction [fh, R] = plotHistRrmse(info)">plotHistRrmse</a>(prob);
0117 
0118 <span class="comment">%% (1.9) Plot a histogram of the fitted fascicle weights.</span>
0119 [fh(3), ~] = <a href="#_sub3" class="code" title="subfunction [fh, w] = plotHistWeigths(info)">plotHistWeigths</a>(prob);
0120 fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
0121 
0122 <span class="comment">%% Extract the coordinates of the white-matter voxels</span>
0123 <span class="comment">% We will use this later to compare probabilistic and deterministic models.</span>
0124 p.coords = feGet(fe,<span class="string">'roi coords'</span>);
0125 clear fe
0126 
0127 <span class="comment">%% (2) Evaluate the Deterministic tensor-based connectome.</span>
0128 <span class="comment">% We will now analyze the tensor-based Deterministic tractography</span>
0129 <span class="comment">% connectome.</span>
0130 det.tractography = <span class="string">'Deterministic'</span>;
0131 fgFileName    = fullfile(lifeDemoDataPath(<span class="string">'tractography'</span>), <span class="keyword">...</span>
0132                 <span class="string">'pestilli_et_al_life_demo_mrtrix_tensor_deterministic.mat'</span>);
0133 
0134 <span class="comment">% The final connectome and data astructure will be saved with this name:</span>
0135 feFileName    = <span class="string">'life_build_model_demo_TENSOR_DET'</span>;
0136 
0137 <span class="comment">%% (2.1) Initialize the LiFE model structure, 'fe' in the code below.</span>
0138 <span class="comment">% This structure contains the forward model of diffusion based on the</span>
0139 <span class="comment">% tractography solution. It also contains all the information necessary to</span>
0140 <span class="comment">% compute model accuracry, and perform statistical tests. You can type</span>
0141 <span class="comment">% help('feBuildModel') in the MatLab prompt for more information.</span>
0142 fe = feConnectomeInit(dwiFile,fgFileName,feFileName,[],dwiFileRepeat,t1File);
0143 
0144 <span class="comment">%% (2.2) Fit the model.</span>
0145 <span class="comment">% Hereafter we fit the forward model of tracrography using a least-squared</span>
0146 <span class="comment">% method. The information generated by fitting the model (fiber weights</span>
0147 <span class="comment">% etc) is then installed in the LiFE structure.</span>
0148 fe = feSet(fe,<span class="string">'fit'</span>,feFitModel(feGet(fe,<span class="string">'mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'bbnnls'</span>));
0149 
0150 <span class="comment">%% (2.3) Extract the RMSE of the model on the fitted data set.</span>
0151 <span class="comment">% We now use the LiFE structure and the fit to compute the error in each</span>
0152 <span class="comment">% white-matter voxel spanned by the tractography model.</span>
0153 det.rmse   = feGet(fe,<span class="string">'vox rmse'</span>);
0154 
0155 <span class="comment">%% (2.4) Extract the RMSE of the model on the second data set.</span>
0156 <span class="comment">% Here we show how to compute the cross-valdiated RMSE of the tractography</span>
0157 <span class="comment">% model in each white-matter voxel. We store this information for later use</span>
0158 <span class="comment">% and to save computer memory.</span>
0159 det.rmsexv = feGetRep(fe,<span class="string">'vox rmse'</span>);
0160 
0161 <span class="comment">%% (2.5) Extract the Rrmse.</span>
0162 <span class="comment">% We show how to extract the ratio between the model prediction error</span>
0163 <span class="comment">% (RMSE) and the test-retest reliability of the data.</span>
0164 det.rrmse  = feGetRep(fe,<span class="string">'vox rmse ratio'</span>);
0165 
0166 <span class="comment">%% (2.6) Extract the fitted weights for the fascicles.</span>
0167 <span class="comment">% The following line shows how to extract the weight assigned to each</span>
0168 <span class="comment">% fascicle in the connectome.</span>
0169 det.w      = feGet(fe,<span class="string">'fiber weights'</span>);
0170 
0171 <span class="comment">%% (2.7) Plot a histogram of the RMSE.</span>
0172 <span class="comment">% We plot the histogram of  RMSE across white-mater voxels.</span>
0173 [fh(1), ~, ~] = <a href="#_sub1" class="code" title="subfunction [fh, rmse, rmsexv] = plotHistRMSE(info)">plotHistRMSE</a>(det);
0174 
0175 <span class="comment">%% (2.8) Plot a histogram of the RMSE ratio.</span>
0176 <span class="comment">% As a reminder the Rrmse is the ratio between data test-retest reliability</span>
0177 <span class="comment">% and model error (the quality of the model fit).</span>
0178 [fh(2), ~] = <a href="#_sub2" class="code" title="subfunction [fh, R] = plotHistRrmse(info)">plotHistRrmse</a>(det);
0179 
0180 <span class="comment">%% (2.9) Plot a histogram of the fitted fascicle weights.</span>
0181 [fh(3), ~] = <a href="#_sub3" class="code" title="subfunction [fh, w] = plotHistWeigths(info)">plotHistWeigths</a>(det);
0182 
0183 <span class="comment">%% Extract the coordinates of the white-matter voxels.</span>
0184 <span class="comment">% We will use this later to compare probabilistic and deterministic models.</span>
0185 d.coords = feGet( fe, <span class="string">'roi coords'</span>);
0186 clear fe
0187 
0188 <span class="comment">%% (3) Compare the quality of fit of Probabilistic and Deterministic connectomes.</span>
0189 <span class="comment">%% (3.1) Find the common coordinates between the two connectomes.</span>
0190 <span class="comment">%</span>
0191 <span class="comment">% The two tractography method might have passed through slightly different</span>
0192 <span class="comment">% white-matter voxels. Here we find the voxels where both models passed. We</span>
0193 <span class="comment">% will compare the error only in these common voxels. There are more</span>
0194 <span class="comment">% coordinates in the Prob connectome, because the tracking fills up more</span>
0195 <span class="comment">% White-matter.</span>
0196 <span class="comment">%</span>
0197 <span class="comment">% So, hereafter:</span>
0198 <span class="comment">% - First we find the indices in the probabilistic connectome of the</span>
0199 <span class="comment">% coordinate in the deterministic connectome. But there are some of the</span>
0200 <span class="comment">% coordinates in the Deterministic conectome that are NOT in the</span>
0201 <span class="comment">% Probabilistic connectome.</span>
0202 <span class="comment">%</span>
0203 <span class="comment">% - Second we find the indices in the Deterministic connectome of the</span>
0204 <span class="comment">% subset of coordinates in the Probabilistic connectome found in the</span>
0205 <span class="comment">% previous step.</span>
0206 <span class="comment">%</span>
0207 <span class="comment">% - Third we find the common voxels. These allow us to find the rmse for</span>
0208 <span class="comment">% the same voxels.</span>
0209 fprintf(<span class="string">'Finding common brain coordinates between P and D connectomes...\n'</span>)
0210 prob.coordsIdx = ismember(p.coords,d.coords,<span class="string">'rows'</span>);
0211 prob.coords    = p.coords(prob.coordsIdx,:);
0212 det.coordsIdx  = ismember(d.coords,prob.coords,<span class="string">'rows'</span>);
0213 det.coords     = d.coords(det.coordsIdx,:);
0214 prob.rmse      = prob.rmse( prob.coordsIdx);
0215 det.rmse       = det.rmse( det.coordsIdx);
0216 clear p d
0217 
0218 <span class="comment">%% (3.2) Make a scatter plot of the RMSE of the two tractography models</span>
0219 fh(4) = <a href="#_sub4" class="code" title="subfunction fh = scatterPlotRMSE(det,prob)">scatterPlotRMSE</a>(det,prob);
0220 
0221 <span class="comment">%% (3.3) Compute the strength-of-evidence (S) and the Earth Movers Distance.</span>
0222 <span class="comment">% Compare the RMSE of the two models using the Stregth-of-evidence and the</span>
0223 <span class="comment">% Earth Movers Distance.</span>
0224 se = feComputeEvidence(prob.rmse,det.rmse);
0225 
0226 <span class="comment">%% (3.4) Strength of evidence in favor of Probabilistic tractography.</span>
0227 <span class="comment">% Plot the distributions of resampled mean RMSE</span>
0228 <span class="comment">% used to compute the strength of evidence (S).</span>
0229 fh(5) = <a href="#_sub5" class="code" title="subfunction fh = distributionPlotStrengthOfEvidence(se)">distributionPlotStrengthOfEvidence</a>(se);
0230 
0231 <span class="comment">%% (3.5) RMSE distributions for Probabilistic and Deterministic tractography.</span>
0232 <span class="comment">% Compare the distributions using the Earth Movers Distance.</span>
0233 <span class="comment">% Plot the distributions of RMSE for the two models and report the Earth</span>
0234 <span class="comment">% Movers Distance between the distributions.</span>
0235 fh(6) = <a href="#_sub6" class="code" title="subfunction fh = distributionPlotEarthMoversDistance(se)">distributionPlotEarthMoversDistance</a>(se);
0236 
0237 <span class="keyword">end</span>
0238 
0239 <span class="comment">% ---------- Local Plot Functions ----------- %</span>
0240 <a name="_sub1" href="#_subfunctions" class="code">function [fh, rmse, rmsexv] = plotHistRMSE(info)</a>
0241 <span class="comment">% Make a plot of the RMSE:</span>
0242 rmse   = info.rmse;
0243 rmsexv = info.rmsexv;
0244 
0245 figName = sprintf(<span class="string">'%s - RMSE'</span>,info.tractography);
0246 fh = mrvNewGraphWin(figName);
0247 [y,x] = hist(rmse,50);
0248 plot(x,y,<span class="string">'k-'</span>);
0249 hold on
0250 [y,x] = hist(rmsexv,50);
0251 plot(x,y,<span class="string">'r-'</span>);
0252 set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
0253 title(<span class="string">'Root-mean squared error distribution across voxels'</span>,<span class="string">'fontsize'</span>,16);
0254 ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
0255 xlabel(<span class="string">'rmse (scanner units)'</span>,<span class="string">'fontsize'</span>,16);
0256 legend({<span class="string">'RMSE fitted data set'</span>,<span class="string">'RMSE cross-validated'</span>},<span class="string">'fontsize'</span>,16);
0257 <span class="keyword">end</span>
0258 
0259 <a name="_sub2" href="#_subfunctions" class="code">function [fh, R] = plotHistRrmse(info)</a>
0260 <span class="comment">% Make a plot of the RMSE Ratio:</span>
0261 
0262 R       = info.rrmse;
0263 figName = sprintf(<span class="string">'%s - RMSE RATIO'</span>,info.tractography);
0264 fh      = mrvNewGraphWin(figName);
0265 [y,x]   = hist(R,linspace(.5,4,50));
0266 plot(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2);
0267 hold on
0268 plot([median(R) median(R)],[0 1200],<span class="string">'r-'</span>,<span class="string">'linewidth'</span>,2);
0269 plot([1 1],[0 1200],<span class="string">'k-'</span>);
0270 set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>);
0271 title(<span class="string">'Root-mean squared error ratio'</span>,<span class="string">'fontsize'</span>,16);
0272 ylabel(<span class="string">'number of voxels'</span>,<span class="string">'fontsize'</span>,16);
0273 xlabel(<span class="string">'R_{rmse}'</span>,<span class="string">'fontsize'</span>,16);
0274 legend({sprintf(<span class="string">'Distribution of R_{rmse}'</span>),sprintf(<span class="string">'Median R_{rmse}'</span>)});
0275 <span class="keyword">end</span>
0276 
0277 <a name="_sub3" href="#_subfunctions" class="code">function [fh, w] = plotHistWeigths(info)</a>
0278 <span class="comment">% Make a plot of the weights:</span>
0279 
0280 w       = info.w;
0281 figName = sprintf(<span class="string">'%s - Distribution of fascicle weights'</span>,info.tractography);
0282 fh      = mrvNewGraphWin(figName);
0283 [y,x]   = hist(w( w &gt; 0 ),logspace(-5,-.3,40));
0284 semilogx(x,y,<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,2)
0285 set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'fontsize'</span>,16,<span class="string">'box'</span>,<span class="string">'off'</span>)
0286 title( <span class="keyword">...</span>
0287     sprintf(<span class="string">'Number of fascicles candidate connectome: %2.0f\nNumber of fascicles in optimized connetome: %2.0f'</span> <span class="keyword">...</span>
0288     ,length(w),sum(w &gt; 0)),<span class="string">'fontsize'</span>,16)
0289 ylabel(<span class="string">'Number of fascicles'</span>,<span class="string">'fontsize'</span>,16)
0290 xlabel(<span class="string">'Fascicle weight'</span>,<span class="string">'fontsize'</span>,16)
0291 <span class="keyword">end</span>
0292 
0293 <a name="_sub4" href="#_subfunctions" class="code">function fh = scatterPlotRMSE(det,prob)</a>
0294 figNameRmse = sprintf(<span class="string">'prob_vs_det_rmse_common_voxels_map'</span>);
0295 fh = mrvNewGraphWin(figNameRmse);
0296 [ymap,x]  = hist3([det.rmse;prob.rmse]',{[10:1:70], [10:1:70]});
0297 ymap = ymap./length(prob.rmse);
0298 sh   = imagesc(flipud(log10(ymap)));
0299 cm   = colormap(flipud(hot)); view(0,90);
0300 axis(<span class="string">'square'</span>)      
0301 set(gca, <span class="keyword">...</span>
0302     <span class="string">'xlim'</span>,[1 length(x{1})],<span class="keyword">...</span>
0303     <span class="string">'ylim'</span>,[1 length(x{1})], <span class="keyword">...</span>
0304     <span class="string">'ytick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
0305     <span class="string">'xtick'</span>,[1 (length(x{1})/2) length(x{1})], <span class="keyword">...</span>
0306     <span class="string">'yticklabel'</span>,[x{1}(end) x{1}(round(end/2)) x{1}(1)], <span class="keyword">...</span>
0307     <span class="string">'xticklabel'</span>,[x{1}(1)   x{1}(round(end/2)) x{1}(end)], <span class="keyword">...</span>
0308     <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
0309     <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
0310 hold on
0311 plot3([1 length(x{1})],[length(x{1}) 1],[max(ymap(:)) max(ymap(:))],<span class="string">'k-'</span>,<span class="string">'linewidth'</span>,1)
0312 ylabel(<span class="string">'Deterministic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
0313 xlabel(<span class="string">'Probabilistic_{rmse}'</span>,<span class="string">'fontsize'</span>,16)
0314 cb = colorbar;
0315 tck = get(cb,<span class="string">'ytick'</span>);
0316 set(cb,<span class="string">'yTick'</span>,[min(tck)  mean(tck) max(tck)], <span class="keyword">...</span>
0317     <span class="string">'yTickLabel'</span>,round(1000*10.^[min(tck),<span class="keyword">...</span>
0318     mean(tck), <span class="keyword">...</span>
0319     max(tck)])/1000, <span class="keyword">...</span>
0320     <span class="string">'tickdir'</span>,<span class="string">'out'</span>,<span class="string">'ticklen'</span>,[.025 .05],<span class="string">'box'</span>,<span class="string">'on'</span>, <span class="keyword">...</span>
0321     <span class="string">'fontsize'</span>,16,<span class="string">'visible'</span>,<span class="string">'on'</span>)
0322 <span class="keyword">end</span>
0323 
0324 <a name="_sub5" href="#_subfunctions" class="code">function fh = distributionPlotStrengthOfEvidence(se)</a>
0325 
0326 y_e        = se.s.unlesioned_e;
0327 ywo_e      = se.s.lesioned_e;
0328 dprime     = se.s.mean;
0329 std_dprime = se.s.std;
0330 xhis       = se.s.unlesioned.xbins;
0331 woxhis     = se.s.lesioned.xbins;
0332 
0333 histcolor{1} = [0 0 0];
0334 histcolor{2} = [.95 .6 .5];
0335 figName = sprintf(<span class="string">'Strength_of_Evidence_test_PROB_vs_DET_model_rmse_mean_HIST'</span>);
0336 fh = mrvNewGraphWin(figName);
0337 patch([xhis,xhis],y_e(:),histcolor{1},<span class="string">'FaceColor'</span>,histcolor{1},<span class="string">'EdgeColor'</span>,histcolor{1});
0338 hold on
0339 patch([woxhis,woxhis],ywo_e(:),histcolor{2},<span class="string">'FaceColor'</span>,histcolor{2},<span class="string">'EdgeColor'</span>,histcolor{2}); 
0340 set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
0341         <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
0342         <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
0343         <span class="string">'ylim'</span>,[0 .2], <span class="keyword">...</span><span class="comment"> </span>
0344         <span class="string">'xlim'</span>,[min(xhis) max(woxhis)], <span class="keyword">...</span>
0345         <span class="string">'xtick'</span>,[min(xhis) round(mean([xhis, woxhis])) max(woxhis)], <span class="keyword">...</span>
0346         <span class="string">'ytick'</span>,[0 .1 .2], <span class="keyword">...</span>
0347         <span class="string">'fontsize'</span>,16)
0348 ylabel(<span class="string">'Probability'</span>,<span class="string">'fontsize'</span>,16)
0349 xlabel(<span class="string">'rmse'</span>,<span class="string">'fontsize'</span>,16')
0350 
0351 title(sprintf(<span class="string">'Strength of evidence:\n mean %2.3f - std %2.3f'</span>,dprime,std_dprime), <span class="keyword">...</span>
0352     <span class="string">'FontSize'</span>,16)
0353 legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
0354 <span class="keyword">end</span>
0355 
0356 <a name="_sub6" href="#_subfunctions" class="code">function fh = distributionPlotEarthMoversDistance(se)</a>
0357 
0358 prob = se.nolesion;
0359 det  = se.lesion;
0360 em   = se.em;
0361 
0362 histcolor{1} = [0 0 0];
0363 histcolor{2} = [.95 .6 .5];
0364 figName = sprintf(<span class="string">'EMD_PROB_DET_model_rmse_mean_HIST'</span>);
0365 fh = mrvNewGraphWin(figName);
0366 plot(prob.xhist,prob.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{1},<span class="string">'linewidth'</span>,4);
0367 hold on
0368 plot(det.xhist,det.hist,<span class="string">'r-'</span>,<span class="string">'color'</span>,histcolor{2},<span class="string">'linewidth'</span>,4); 
0369 set(gca,<span class="string">'tickdir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
0370         <span class="string">'box'</span>,<span class="string">'off'</span>, <span class="keyword">...</span>
0371         <span class="string">'ticklen'</span>,[.025 .05], <span class="keyword">...</span>
0372         <span class="string">'ylim'</span>,[0 .12], <span class="keyword">...</span><span class="comment"> </span>
0373         <span class="string">'xlim'</span>,[0 95], <span class="keyword">...</span>
0374         <span class="string">'xtick'</span>,[0 45 90], <span class="keyword">...</span>
0375         <span class="string">'ytick'</span>,[0 .06 .12], <span class="keyword">...</span>
0376         <span class="string">'fontsize'</span>,16)
0377 ylabel(<span class="string">'Proportion white-matter volume'</span>,<span class="string">'fontsize'</span>,16)
0378 xlabel(<span class="string">'RMSE (raw MRI scanner units)'</span>,<span class="string">'fontsize'</span>,16')
0379 title(sprintf(<span class="string">'Earth Movers Distance: %2.3f (raw scanner units)'</span>,em.mean),<span class="string">'FontSize'</span>,16)
0380 legend({<span class="string">'Probabilistic'</span>,<span class="string">'Deterministic'</span>})
0381 <span class="keyword">end</span>
0382</pre></div>
<hr><address>Generated on Tue 01-Jul-2014 19:44:25 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>