<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of feGet</title>
  <meta name="keywords" content="feGet">
  <meta name="description" content="Get function for fascicle evaluation structure">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">fe</a> &gt; feGet.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for fe&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>feGet
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Get function for fascicle evaluation structure</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function val = feGet(fe,param,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Get function for fascicle evaluation structure

   val = feGet(fe,param,varargin)


 INPUTS: 
  Coords    - Nx3 set of coordinates in image space
  voxelIndices - Vector of 1's and 0's, there is a one for each
              location the the connectome coordinates for which there is
              a match in the coords


 Franco &amp; Brian (c) Stanford Vista Team 2012


---------- List of arguments ----
 Name of the current fe structure.
 name = feGet(fe,'name')
----------
 The type of objes (always, fascicle evaluation)
 type = feGet(fe,'type')
----------
 Structure of parameters and results from LIFE analysis
 life = feGet(fe,'life')
----------
 Return the connectome (fiber group) in image coordinates.
 fg = feGEt(fe,'fg img')
----------
 return the connectome in acpc coordinates.
 fg  = feGet(fg,'fg acpc')
----------
 Return the VOI comprised by the full connectome.
 roi = feGet(fe,'roi')
----------
 Transforms between coords for fg, roi, and dwi data
 xform = feGet(fe,'xform')
----------
 Load the diffusion weighted data.
 dwi = feGet(fe,'dwi')
----------
 Return the path to the diffusion weighted data file.
 dwiFile = feGet(fe,'dwifile')   
----------
 Load the repeated-measure diffusion weighted data.
 dwi = feGet(fe,'dwirepeat') 
----------
 Load the repeated measure of the diffusion weighted data.
 dwiFile = feGet(fe,'dwirepeatfile')
----------
 Directory where the LiFe structes are saved by defualt.
 sdir = feGet(fe,'savedir');
----------
 Diffusion directions.
 val = feGet(fe,'bvecs');
----------
 Indices to the diffusion directions in the DWi 4th Dimension.
 val = feGet(fe,'bvecs indices');
----------
 Number of B0's
 val = feGet(fe,'n bvals');
----------
 B0 Values.
 bval = feGet(fe,'bvals')
----------
 Returns a nVoxels X nBvecs array of measured diffusion signal
 val = feGet(fe,'dsiinvox');
 val = feGet(fe,'dsiinvox',voxelsIndices);
 val = feGet(fe,'dsiinvox',coords);
----------
 Returns a nVoxels X nBvecs array of demeaned diffusion signal
 val =feGet(fe,'dsiinvoxdemeaned');
 val =feGet(fe,'dsiinvoxdemeaned',voxelsIndices);
 val =feGet(fe,'dsiinvoxdemeaned',coords);
----------
 Get the diffusion signal at 0 diffusion weighting (B0) for this voxel
 val = feGet(fe,'b0signalvoxel');
 val = feGet(fe,'b0signalvoxel',voxelIndex);
 val = feGet(fe,'b0signalvoxel',coords);
----------
 Return a subset of fibers from the conenctome.
 fg = feGet(fe,'fiberssubset',fiberList);
----------
 Return the coordinates of the VOI comprised in the connectome.
 Always in image space.
 coords = feGet(fe,'roi coords')
----------
 Number of voxels in the connectome/VOI.
 nVoxels = feGet(fe,'n voxels')
----------
 Indexes of actually used voxels.
 These can be different than the number of voxels in the VOI in case some
 voxels have no fibers in them.

 TO BE DEPRECATED.
 indxUsedVx = feGet(fe,'index of used voxels')
----------
 Number of actually used voxels.
 This can be less than the number of voxels in the VOI in case some
 voxels have no fibers in them.

 TO BE DEPRECATED.
 nUsedVx = feGet(fe,'index of used voxels')
----------
 Returns the first index to a voxel in the dSig vector.
 The dSig vector is 1:nBvecs*nVoxels.
 val = feGet(fe,'start rows')
----------
 Return the rows corresponding to a set of voxels.
 rows = feGet(fe,'voxel rows',idxVoxel)
----------
 Return the model (M matrix), or a subset of it.
 Mfiber = feGet(fe,'M fiber');
 Mfiber = feGet(fe,'model',voxelsIndices);
 Mfiber = feGet(fe,'model',coords);
----------
 Return a subset of measurements from the fiber portion of M matrix
 The rows of M are specified.  Remember that the rows refer to a
 combination of voxel and measurement direction and potentially in the
 future a b-value.  Hence, the rows are not specific to a voxel.
 Mfiber = feGet(fe,'mfiber subset',rowsToKeep);
----------
 Pairing of fibers and nodes in each voxel.
 v2fnp = feGet(fe,'v2fnp');
----------
 Tensors computed for each node and fiber in a set of voxels.
 t = feGet(fe,'tensors')
 t = feGet(fe,'tensors',voxelsIndices);
 t = feGet(fe,'tensors',coords);
----------
 Get all the tensors in a single voxel.
 val = feGet(fe,'voxtensors',voxelIndex)
 val = feGet(fe,'voxtensors',coord)
----------
 Returns the model (M) with only a subset of columns (fibers).
 fiberList is a vector of indexes, e.g, [1 10 100]
 M = feGet(fe,'keepfibers',fiberList)
----------
 Isotropic portion of M matrix. Returns the matrix for the full model or
 for a subset of voxels.
 Miso = feGet(fe,'M iso')
 Miso = feGet(fe,'M iso',voxelsIndices)
 Miso = feGet(fe,'M iso',coords)
----------
 Total number of nodes in each voxel The voxel2FN pairs are row size
 equals number of nodes and column size is always 2. The entries of
 the first column are the fiber number. The entries in the second
 column are the node of the fiber inside the voxel.
 val = feGet(fe,'n nodes');
 val = feGet(fe,'n nodes',voxelsIndices);
 val = feGet(fe,'n nodes',coords);
----------
 Return the total number of fibers for all the voxels or in a set of
 voxels.
 nFibers = feGet(fe,'uniquefnum');           % all the voxels
 nFibers = feGet(fe,'uniquefnum',[1 2 3 4]); % for some the voxels,
                                             % specified by indexes
 nFibers = feGet(fe,'uniquefnum',coords);    % for some the voxels,
                                             % specified by coordinates
----------
 Return the indexes of the fibers for all the voxels or in a set of
 voxels.
 idxFibers = feGet(fe,'uniquef');           % all the voxels
 idxFibers = feGet(fe,'uniquef',[1 2 3 4]); % for some the voxels,
                                            % specified by indexes
 idxFibers = feGet(fe,'uniquef',coords);    % for some the voxels,
                                            % specified by coordinates
----------
 Return the total number of fibers for all the voxels or in a set of
 voxels
 nFibers = feGet(fe,'totfnum');           % all the voxels
 nFibers = feGet(fe,'totfnum',[1 2 3 4]); % for some the voxels,
                                          % specified by indexes
 nFibers = feGet(fe,'totfnum',coords);    % for some the voxels,
                                          % specified by coordinates
----------
 Return the indexes of the fibers for all the voxels or in a set of
 voxels
 idxFibers = feGet(fe,'totf');             % all the voxels
 idxFibers = feGet(fe,'totf',[1 2 3 4]);   % for some the voxels,
                                           % specified by indexes
 idxFibers = feGet(fe,'totfibers',coords); % for some the voxels,
                                           % specified by coordinates
----------
 Return the number of fibers in the model.
 nFibers = feGet(fe,'n fibers');
----------
 Weights of the isotropic voxel signals, this is the mean signal in
 each voxel.
 val = feGet(fe,'iso weights');
 val = feGet(fe,'iso weights'coords)
 val = feGet(fe,'iso weights',voxelIndices)
----------
 Weights of the fiber component. For all the fibers or a subset of
 them.
 w = feGet(fe,'fiber weights')
 w = feGet(fe,'fiber weights',fiberIndices)
----------
 Weights of the fiber component with a subset of the fibers' weights
 set to zero. This can be used to test the loss in RMSE for the
 connectome when a subset of fibers is removed, but the connectome is
 not fitted again.
 w = feGet(fe,'fiber weights test',fiberIndices)
----------
 Predicted signal (demeaned) with a subset of fibers' weights set to 0.
 This can be used to test the loss in RMSE for the connectome when a
 subset of fibers is removed, but the connectome is not fitted again.

 pSig = feGet(fe,'pSig fiber test',fiberIndices);
 pSig = feGet(fe,'pSig fiber test',fiberIndices,voxelIndices);
 pSig = feGet(fe,'pSig fiber test',fiberIndices,coords);
----------
 Measured signal in VOI, this is the raw signal. not demeaned

 dSig = feGet(fe,'dSig full')
---------
 Measured signal in VOI, demeaned, this is the signal used for the
 fiber-portion of the M model.

 dSig = feGet(fe,'dsigdemeaned');
 dSig = feGet(fe,'dsigdemeaned',[1 10 100]);
 dSig = feGet(fe,'dsigdemeaned',coords);
---------
 Get the demeaned signal for a subset of rows.
 Useful for cross-validation.
 dSig = feGet(fe,'dsigrowssubset',voxelsList);
---------
 Predicted signal of fiber alone (demeaned).
 pSig = feGet(fe,'pSig fiber');
 pSig = feGet(fe,'pSig fiber',coords);
 pSig = feGet(fe,'pSig fiber',voxelIndices);
---------
 Predicted measured signal from both fiber and iso
 pSig = feGet(fe,'pSig full')
 pSig = feGet(fe,'pSig full',coords)
 pSig = feGet(fe,'pSig full',voxelIndices)
---------
 The woxels returned by a fit of LiFE by voxel/fiber
 w = feGet(fe,'fiberweightsvoxelwise')
---------
 Predict the diffusion signal for the fiber component
 with the voxel-wise fit of LiFE
 pSig = feGet(fe,'psigfvoxelwise')
 pSig = feGet(fe,'psigfvoxelwise',coords)
 pSig = feGet(fe,'psigfvoxelwise',voxelIndices)
---------
 Predict the diffusion signal for the fiber component
 with the voxel-wise fit of LiFE, return the an array of pSigXnVoxel
 pSig = feGet(fe,'psigfvoxelwisebyvoxel')
 pSig = feGet(fe,'psigfvoxelwisebyvoxel',coords)
 pSig = feGet(fe,'psigfvoxelwisebyvoxel',voxelIndices)
---------
 The fiber and isotropic weights as a long vector
 w = feGet(fe,'fullweights')
---------
 Return the global R2 (fraction of variance explained) of the full life
 model.
 R2 = feGet(fe,'total r2');
---------
 Percent variance explained
 R2 = feGet(fe,'explained variance')
---------
 Root mean squared error of the LiFE fit to the whole data
 rmse = feGet(fe,'rmse')
---------
 Residual signal: (fiber prediction - measured_demeaned).
 res = feGet(fe,'res sig fiber')
---------
 Residual signal: (full model prediction - measured signal).
 res = feGet(fe,'res sig full');
---------
 Residual signal: (fiber model prediction - demeaned measured signal)
 with added mean signal. Res is returned as a vector.
 This is used to reconstruct an image (volume) to be used for the
 refinement process.
 res = feGet(fe,'fiber res sig with mean');
 res = feGet(fe,'fiber res sig with mean',coords);
 res = feGet(fe,'fiber res sig with mean',voxelIndices);
---------
 Residual signal fiber model prediction - demeaned measured signal
 with added mean signal. Res is returned as an array (nBvecs x nVoxel).
 This is used to reconstruct an image (volume) to be used for the
 refinement process.
 res = feGet(fe,'fiber res sig with mean voxel');
 res = feGet(fe,'fiber res sig with mean voxel',coords);
 res = feGet(fe,'fiber res sig with mean voxel',voxelIndices);
---------
 Predicted signal by the fiber model in a set of voxels.
 Vox subfield stores per voxel within the VOI. The pSig has size of the
 dwi. - It is stored as val = pSig(X,Y,Z,Theta)

 pSig = feGet(fe, 'pSig fiber by voxel');
 pSig = feGet(fe, 'pSig fiber by voxel',coords);
 pSig = feGet(fe, 'pSig fiber by voxel',voxelIndex);
---------
 Return a column vector of the proportion of variance explained in
 each voxel.
 R2byVox = feGet(fe,'voxr2');
 R2byVox = feGet(fe,'voxr2',coords);
---------
 Return a column vector of the proportion of variance explained in
 each voxel. (Normalized to the squared mean diffusion signal in each voxel)
 R2byVox = feGet(fe,'voxr2zero');
 R2byVox = feGet(fe,'voxr2zero',coords);
---------
 Return the percent of varince explained in each voxel.
 R2byVox = feGet(fe,'var exp by voxel');
 R2byVox = feGet(fe,'var exp by voxel',coords);
---------
 Demeaned diffusion signal in each voxel.
 dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel');
 dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',coords);
 dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',vxIndex);
---------
 Full (measured) signal in each voxel.
 dSigByVoxel = feGet(fe,'dSig full by Voxel');
 dSigByVoxel = feGet(fe,'dSig full by Voxel',coords);
 dSigByVoxel = feGet(fe,'dSig full by Voxel',vxIndex);
---------
 Predicted signal by the full model in a set of voxeles.
 pSigByVoxel = feGet(fe, 'pSig full by voxel');
 pSigByVoxel = feGet(fe, 'pSig full by voxel',coords);
 pSigByVoxel = feGet(fe, 'pSig full by voxel',voxelIndex);
---------
 A volume of RMSE values.
 RMSE = feGet(fe,'vox rmse')
 RMSE = feGet(fe,'vox rmse',coords)
 RMSE = feGet(fe,'vox rmse',vxIndex)
---------
 A volume of RMSE values with a subset of fibers' weights set to 0.
 RMSE = feGet(fe,'vox rmse',fiberIndices)
 RMSE = feGet(fe,'vox rmse',fiberIndices,coords)
 RMSE = feGet(fe,'vox rmse',fiberIndices,voxelIndex)
---------
 Fibers' residual signal by voxel.
 res = feGet(fe,'res sig fiber vox')
 res = feGet(fe,'res sig fiber vox',coords)
 res = feGet(fe,'res sig fiber vox',vxIndex)
---------
 Full (measured) residual signal by voxel.
 res = feGet(fe,'res sig full vox')
 res = feGet(fe,'res sig full vox',coords)
 res = feGet(fe,'res sig full vox',vxIndex)
---------
 Fibers' residual signal by voxel with mean signal added (with added
 isotropic component).
 This is used to compute the residual signal for the refinement.
 res = feGet(fe,'fiber res sig with mean vox')
 res = feGet(fe,'fiber res sig with mean vox',coords)
 res = feGet(fe,'fiber res sig with mean vox',vxIndex)
---------
 Residual signal full model prediction from a multi-voxel fit.
 res = feGet(fe,'res sig full voxfit');
 res = feGet(fe, 'res sig full voxfit',coords);
 res = feGet(fe, 'res sig full voxfit',voxelIndex);
---------
 Given an VOI or a set of indices to voxels returns the indices of the matching voxels inside the big
 volume, which ordinarily represents the full connectome.
 voxelIndices = feGet(fe,'voxelsindices',coords)
 voxelIndices = feGet(fe,'voxelsindices',voxelIndices)
---------
 Given an VOI finds the indices of the matching voxels inside the big
 volume, which ordinarily represents the full connectome.

 foundVoxels = feGet(fe,'find voxels',coords)

 coords is a Nx3 set of coordinates in image space
 foundVoxels is a vector of 1's and 0's, there is a one for each
 location the the connectome coordinates for which there is a match in
 the coords
---------
 Given a set of VOI coords finds the row numbers of the Model matrix
 (or equivalently the dSig vector) that represent the data for this
 set of VOI coords.
 foundVoxels = feGet(fe,'coords 2 rows',coords)
 coords      - a Nx3 set of coordinates in image space
 foundVoxels - a binary vector that is 1 for each Model matrix row
               that corresponds to at least one of the coords.
---------
 Quaternian transformation from IMAGE space to ACPC space.
 xform = feGet(fe,'xform')
---------
 Quaternian transformation from ACPC space to IMAGE space.
 xform = feGet(fe,'xform')
---------
 Dimensions of the DW volume.
 dim = feGet(fe,'dims')
---------
 Dimensions of the maps of parameters and results.
 dims = feGet(fe, 'mapsize')
---------
 Path to the 3D Anatomy Volume.
 anatomyfile = feGet(fe, 't1 file')

 End of feGet.m parameters, 
 
 Franco Pestilli (c) Stanford Vista Team 2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>	Get function for fascicle evaluation structure</li><li><a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>	Get function for fascicle evaluation structure, to use for a repeated</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feConnectomeBuildModel.html" class="code" title="function fe = feConnectomeBuildModel(fe)">feConnectomeBuildModel</a>	Compute matrix to predict directional diffusion in each voxel from fibers</li><li><a href="feConnectomeInit.html" class="code" title="function fe = feConnectomeInit(dwiFile,dtFile,fgFileName,feFileName,savedir,dwiFileRepeated,anatomyFile,varargin)">feConnectomeInit</a>	</li><li><a href="feConnectomeReduceFibers.html" class="code" title="function fe = feConnectomeReduceFibers(fe, fibersToKeep,reduceVoxels)">feConnectomeReduceFibers</a>	Deletes a set of fibers from the signal and the M matrix.</li><li><a href="feConnectomeReduceVoxels.html" class="code" title="function [Mfiber dSig] = feConnectomeReduceVoxels(fe,voxelsToKeep)">feConnectomeReduceVoxels</a>	Select the voxels to keep (extract) in a connectome matrix</li><li><a href="feConnectomeSelectFibers.html" class="code" title="function fe = feConnectomeSelectFibers(fe, fibersToKeep,recomputeFibersInfo)">feConnectomeSelectFibers</a>	Deletes a set of fibers from the signal and the M matrix.</li><li><a href="feConnectomeSetDwi.html" class="code" title="function fe = feConnectomeSetDwi(fe,dwiFileName,isrepeat)">feConnectomeSetDwi</a>	</li><li><a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>	Get function for fascicle evaluation structure</li><li><a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>	Get function for fascicle evaluation structure, to use for a repeated</li><li><a href="feSet.html" class="code" title="function fe = feSet(fe,param,val,varargin)">feSet</a>	Set fascicle evaluation parameters</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function val = feGet(fe,param,varargin)</a>
0002 <span class="comment">% Get function for fascicle evaluation structure</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   val = feGet(fe,param,varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% INPUTS:</span>
0008 <span class="comment">%  Coords    - Nx3 set of coordinates in image space</span>
0009 <span class="comment">%  voxelIndices - Vector of 1's and 0's, there is a one for each</span>
0010 <span class="comment">%              location the the connectome coordinates for which there is</span>
0011 <span class="comment">%              a match in the coords</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Franco &amp; Brian (c) Stanford Vista Team 2012</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%---------- List of arguments ----</span>
0018 <span class="comment">% Name of the current fe structure.</span>
0019 <span class="comment">% name = feGet(fe,'name')</span>
0020 <span class="comment">%----------</span>
0021 <span class="comment">% The type of objes (always, fascicle evaluation)</span>
0022 <span class="comment">% type = feGet(fe,'type')</span>
0023 <span class="comment">%----------</span>
0024 <span class="comment">% Structure of parameters and results from LIFE analysis</span>
0025 <span class="comment">% life = feGet(fe,'life')</span>
0026 <span class="comment">%----------</span>
0027 <span class="comment">% Return the connectome (fiber group) in image coordinates.</span>
0028 <span class="comment">% fg = feGEt(fe,'fg img')</span>
0029 <span class="comment">%----------</span>
0030 <span class="comment">% return the connectome in acpc coordinates.</span>
0031 <span class="comment">% fg  = feGet(fg,'fg acpc')</span>
0032 <span class="comment">%----------</span>
0033 <span class="comment">% Return the VOI comprised by the full connectome.</span>
0034 <span class="comment">% roi = feGet(fe,'roi')</span>
0035 <span class="comment">%----------</span>
0036 <span class="comment">% Transforms between coords for fg, roi, and dwi data</span>
0037 <span class="comment">% xform = feGet(fe,'xform')</span>
0038 <span class="comment">%----------</span>
0039 <span class="comment">% Load the diffusion weighted data.</span>
0040 <span class="comment">% dwi = feGet(fe,'dwi')</span>
0041 <span class="comment">%----------</span>
0042 <span class="comment">% Return the path to the diffusion weighted data file.</span>
0043 <span class="comment">% dwiFile = feGet(fe,'dwifile')</span>
0044 <span class="comment">%----------</span>
0045 <span class="comment">% Load the repeated-measure diffusion weighted data.</span>
0046 <span class="comment">% dwi = feGet(fe,'dwirepeat')</span>
0047 <span class="comment">%----------</span>
0048 <span class="comment">% Load the repeated measure of the diffusion weighted data.</span>
0049 <span class="comment">% dwiFile = feGet(fe,'dwirepeatfile')</span>
0050 <span class="comment">%----------</span>
0051 <span class="comment">% Directory where the LiFe structes are saved by defualt.</span>
0052 <span class="comment">% sdir = feGet(fe,'savedir');</span>
0053 <span class="comment">%----------</span>
0054 <span class="comment">% Diffusion directions.</span>
0055 <span class="comment">% val = feGet(fe,'bvecs');</span>
0056 <span class="comment">%----------</span>
0057 <span class="comment">% Indices to the diffusion directions in the DWi 4th Dimension.</span>
0058 <span class="comment">% val = feGet(fe,'bvecs indices');</span>
0059 <span class="comment">%----------</span>
0060 <span class="comment">% Number of B0's</span>
0061 <span class="comment">% val = feGet(fe,'n bvals');</span>
0062 <span class="comment">%----------</span>
0063 <span class="comment">% B0 Values.</span>
0064 <span class="comment">% bval = feGet(fe,'bvals')</span>
0065 <span class="comment">%----------</span>
0066 <span class="comment">% Returns a nVoxels X nBvecs array of measured diffusion signal</span>
0067 <span class="comment">% val = feGet(fe,'dsiinvox');</span>
0068 <span class="comment">% val = feGet(fe,'dsiinvox',voxelsIndices);</span>
0069 <span class="comment">% val = feGet(fe,'dsiinvox',coords);</span>
0070 <span class="comment">%----------</span>
0071 <span class="comment">% Returns a nVoxels X nBvecs array of demeaned diffusion signal</span>
0072 <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned');</span>
0073 <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned',voxelsIndices);</span>
0074 <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned',coords);</span>
0075 <span class="comment">%----------</span>
0076 <span class="comment">% Get the diffusion signal at 0 diffusion weighting (B0) for this voxel</span>
0077 <span class="comment">% val = feGet(fe,'b0signalvoxel');</span>
0078 <span class="comment">% val = feGet(fe,'b0signalvoxel',voxelIndex);</span>
0079 <span class="comment">% val = feGet(fe,'b0signalvoxel',coords);</span>
0080 <span class="comment">%----------</span>
0081 <span class="comment">% Return a subset of fibers from the conenctome.</span>
0082 <span class="comment">% fg = feGet(fe,'fiberssubset',fiberList);</span>
0083 <span class="comment">%----------</span>
0084 <span class="comment">% Return the coordinates of the VOI comprised in the connectome.</span>
0085 <span class="comment">% Always in image space.</span>
0086 <span class="comment">% coords = feGet(fe,'roi coords')</span>
0087 <span class="comment">%----------</span>
0088 <span class="comment">% Number of voxels in the connectome/VOI.</span>
0089 <span class="comment">% nVoxels = feGet(fe,'n voxels')</span>
0090 <span class="comment">%----------</span>
0091 <span class="comment">% Indexes of actually used voxels.</span>
0092 <span class="comment">% These can be different than the number of voxels in the VOI in case some</span>
0093 <span class="comment">% voxels have no fibers in them.</span>
0094 <span class="comment">%</span>
0095 <span class="comment">% TO BE DEPRECATED.</span>
0096 <span class="comment">% indxUsedVx = feGet(fe,'index of used voxels')</span>
0097 <span class="comment">%----------</span>
0098 <span class="comment">% Number of actually used voxels.</span>
0099 <span class="comment">% This can be less than the number of voxels in the VOI in case some</span>
0100 <span class="comment">% voxels have no fibers in them.</span>
0101 <span class="comment">%</span>
0102 <span class="comment">% TO BE DEPRECATED.</span>
0103 <span class="comment">% nUsedVx = feGet(fe,'index of used voxels')</span>
0104 <span class="comment">%----------</span>
0105 <span class="comment">% Returns the first index to a voxel in the dSig vector.</span>
0106 <span class="comment">% The dSig vector is 1:nBvecs*nVoxels.</span>
0107 <span class="comment">% val = feGet(fe,'start rows')</span>
0108 <span class="comment">%----------</span>
0109 <span class="comment">% Return the rows corresponding to a set of voxels.</span>
0110 <span class="comment">% rows = feGet(fe,'voxel rows',idxVoxel)</span>
0111 <span class="comment">%----------</span>
0112 <span class="comment">% Return the model (M matrix), or a subset of it.</span>
0113 <span class="comment">% Mfiber = feGet(fe,'M fiber');</span>
0114 <span class="comment">% Mfiber = feGet(fe,'model',voxelsIndices);</span>
0115 <span class="comment">% Mfiber = feGet(fe,'model',coords);</span>
0116 <span class="comment">%----------</span>
0117 <span class="comment">% Return a subset of measurements from the fiber portion of M matrix</span>
0118 <span class="comment">% The rows of M are specified.  Remember that the rows refer to a</span>
0119 <span class="comment">% combination of voxel and measurement direction and potentially in the</span>
0120 <span class="comment">% future a b-value.  Hence, the rows are not specific to a voxel.</span>
0121 <span class="comment">% Mfiber = feGet(fe,'mfiber subset',rowsToKeep);</span>
0122 <span class="comment">%----------</span>
0123 <span class="comment">% Pairing of fibers and nodes in each voxel.</span>
0124 <span class="comment">% v2fnp = feGet(fe,'v2fnp');</span>
0125 <span class="comment">%----------</span>
0126 <span class="comment">% Tensors computed for each node and fiber in a set of voxels.</span>
0127 <span class="comment">% t = feGet(fe,'tensors')</span>
0128 <span class="comment">% t = feGet(fe,'tensors',voxelsIndices);</span>
0129 <span class="comment">% t = feGet(fe,'tensors',coords);</span>
0130 <span class="comment">%----------</span>
0131 <span class="comment">% Get all the tensors in a single voxel.</span>
0132 <span class="comment">% val = feGet(fe,'voxtensors',voxelIndex)</span>
0133 <span class="comment">% val = feGet(fe,'voxtensors',coord)</span>
0134 <span class="comment">%----------</span>
0135 <span class="comment">% Returns the model (M) with only a subset of columns (fibers).</span>
0136 <span class="comment">% fiberList is a vector of indexes, e.g, [1 10 100]</span>
0137 <span class="comment">% M = feGet(fe,'keepfibers',fiberList)</span>
0138 <span class="comment">%----------</span>
0139 <span class="comment">% Isotropic portion of M matrix. Returns the matrix for the full model or</span>
0140 <span class="comment">% for a subset of voxels.</span>
0141 <span class="comment">% Miso = feGet(fe,'M iso')</span>
0142 <span class="comment">% Miso = feGet(fe,'M iso',voxelsIndices)</span>
0143 <span class="comment">% Miso = feGet(fe,'M iso',coords)</span>
0144 <span class="comment">%----------</span>
0145 <span class="comment">% Total number of nodes in each voxel The voxel2FN pairs are row size</span>
0146 <span class="comment">% equals number of nodes and column size is always 2. The entries of</span>
0147 <span class="comment">% the first column are the fiber number. The entries in the second</span>
0148 <span class="comment">% column are the node of the fiber inside the voxel.</span>
0149 <span class="comment">% val = feGet(fe,'n nodes');</span>
0150 <span class="comment">% val = feGet(fe,'n nodes',voxelsIndices);</span>
0151 <span class="comment">% val = feGet(fe,'n nodes',coords);</span>
0152 <span class="comment">%----------</span>
0153 <span class="comment">% Return the total number of fibers for all the voxels or in a set of</span>
0154 <span class="comment">% voxels.</span>
0155 <span class="comment">% nFibers = feGet(fe,'uniquefnum');           % all the voxels</span>
0156 <span class="comment">% nFibers = feGet(fe,'uniquefnum',[1 2 3 4]); % for some the voxels,</span>
0157 <span class="comment">%                                             % specified by indexes</span>
0158 <span class="comment">% nFibers = feGet(fe,'uniquefnum',coords);    % for some the voxels,</span>
0159 <span class="comment">%                                             % specified by coordinates</span>
0160 <span class="comment">%----------</span>
0161 <span class="comment">% Return the indexes of the fibers for all the voxels or in a set of</span>
0162 <span class="comment">% voxels.</span>
0163 <span class="comment">% idxFibers = feGet(fe,'uniquef');           % all the voxels</span>
0164 <span class="comment">% idxFibers = feGet(fe,'uniquef',[1 2 3 4]); % for some the voxels,</span>
0165 <span class="comment">%                                            % specified by indexes</span>
0166 <span class="comment">% idxFibers = feGet(fe,'uniquef',coords);    % for some the voxels,</span>
0167 <span class="comment">%                                            % specified by coordinates</span>
0168 <span class="comment">%----------</span>
0169 <span class="comment">% Return the total number of fibers for all the voxels or in a set of</span>
0170 <span class="comment">% voxels</span>
0171 <span class="comment">% nFibers = feGet(fe,'totfnum');           % all the voxels</span>
0172 <span class="comment">% nFibers = feGet(fe,'totfnum',[1 2 3 4]); % for some the voxels,</span>
0173 <span class="comment">%                                          % specified by indexes</span>
0174 <span class="comment">% nFibers = feGet(fe,'totfnum',coords);    % for some the voxels,</span>
0175 <span class="comment">%                                          % specified by coordinates</span>
0176 <span class="comment">%----------</span>
0177 <span class="comment">% Return the indexes of the fibers for all the voxels or in a set of</span>
0178 <span class="comment">% voxels</span>
0179 <span class="comment">% idxFibers = feGet(fe,'totf');             % all the voxels</span>
0180 <span class="comment">% idxFibers = feGet(fe,'totf',[1 2 3 4]);   % for some the voxels,</span>
0181 <span class="comment">%                                           % specified by indexes</span>
0182 <span class="comment">% idxFibers = feGet(fe,'totfibers',coords); % for some the voxels,</span>
0183 <span class="comment">%                                           % specified by coordinates</span>
0184 <span class="comment">%----------</span>
0185 <span class="comment">% Return the number of fibers in the model.</span>
0186 <span class="comment">% nFibers = feGet(fe,'n fibers');</span>
0187 <span class="comment">%----------</span>
0188 <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0189 <span class="comment">% each voxel.</span>
0190 <span class="comment">% val = feGet(fe,'iso weights');</span>
0191 <span class="comment">% val = feGet(fe,'iso weights'coords)</span>
0192 <span class="comment">% val = feGet(fe,'iso weights',voxelIndices)</span>
0193 <span class="comment">%----------</span>
0194 <span class="comment">% Weights of the fiber component. For all the fibers or a subset of</span>
0195 <span class="comment">% them.</span>
0196 <span class="comment">% w = feGet(fe,'fiber weights')</span>
0197 <span class="comment">% w = feGet(fe,'fiber weights',fiberIndices)</span>
0198 <span class="comment">%----------</span>
0199 <span class="comment">% Weights of the fiber component with a subset of the fibers' weights</span>
0200 <span class="comment">% set to zero. This can be used to test the loss in RMSE for the</span>
0201 <span class="comment">% connectome when a subset of fibers is removed, but the connectome is</span>
0202 <span class="comment">% not fitted again.</span>
0203 <span class="comment">% w = feGet(fe,'fiber weights test',fiberIndices)</span>
0204 <span class="comment">%----------</span>
0205 <span class="comment">% Predicted signal (demeaned) with a subset of fibers' weights set to 0.</span>
0206 <span class="comment">% This can be used to test the loss in RMSE for the connectome when a</span>
0207 <span class="comment">% subset of fibers is removed, but the connectome is not fitted again.</span>
0208 <span class="comment">%</span>
0209 <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices);</span>
0210 <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices,voxelIndices);</span>
0211 <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices,coords);</span>
0212 <span class="comment">%----------</span>
0213 <span class="comment">% Measured signal in VOI, this is the raw signal. not demeaned</span>
0214 <span class="comment">%</span>
0215 <span class="comment">% dSig = feGet(fe,'dSig full')</span>
0216 <span class="comment">%---------</span>
0217 <span class="comment">% Measured signal in VOI, demeaned, this is the signal used for the</span>
0218 <span class="comment">% fiber-portion of the M model.</span>
0219 <span class="comment">%</span>
0220 <span class="comment">% dSig = feGet(fe,'dsigdemeaned');</span>
0221 <span class="comment">% dSig = feGet(fe,'dsigdemeaned',[1 10 100]);</span>
0222 <span class="comment">% dSig = feGet(fe,'dsigdemeaned',coords);</span>
0223 <span class="comment">%---------</span>
0224 <span class="comment">% Get the demeaned signal for a subset of rows.</span>
0225 <span class="comment">% Useful for cross-validation.</span>
0226 <span class="comment">% dSig = feGet(fe,'dsigrowssubset',voxelsList);</span>
0227 <span class="comment">%---------</span>
0228 <span class="comment">% Predicted signal of fiber alone (demeaned).</span>
0229 <span class="comment">% pSig = feGet(fe,'pSig fiber');</span>
0230 <span class="comment">% pSig = feGet(fe,'pSig fiber',coords);</span>
0231 <span class="comment">% pSig = feGet(fe,'pSig fiber',voxelIndices);</span>
0232 <span class="comment">%---------</span>
0233 <span class="comment">% Predicted measured signal from both fiber and iso</span>
0234 <span class="comment">% pSig = feGet(fe,'pSig full')</span>
0235 <span class="comment">% pSig = feGet(fe,'pSig full',coords)</span>
0236 <span class="comment">% pSig = feGet(fe,'pSig full',voxelIndices)</span>
0237 <span class="comment">%---------</span>
0238 <span class="comment">% The woxels returned by a fit of LiFE by voxel/fiber</span>
0239 <span class="comment">% w = feGet(fe,'fiberweightsvoxelwise')</span>
0240 <span class="comment">%---------</span>
0241 <span class="comment">% Predict the diffusion signal for the fiber component</span>
0242 <span class="comment">% with the voxel-wise fit of LiFE</span>
0243 <span class="comment">% pSig = feGet(fe,'psigfvoxelwise')</span>
0244 <span class="comment">% pSig = feGet(fe,'psigfvoxelwise',coords)</span>
0245 <span class="comment">% pSig = feGet(fe,'psigfvoxelwise',voxelIndices)</span>
0246 <span class="comment">%---------</span>
0247 <span class="comment">% Predict the diffusion signal for the fiber component</span>
0248 <span class="comment">% with the voxel-wise fit of LiFE, return the an array of pSigXnVoxel</span>
0249 <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel')</span>
0250 <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel',coords)</span>
0251 <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel',voxelIndices)</span>
0252 <span class="comment">%---------</span>
0253 <span class="comment">% The fiber and isotropic weights as a long vector</span>
0254 <span class="comment">% w = feGet(fe,'fullweights')</span>
0255 <span class="comment">%---------</span>
0256 <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
0257 <span class="comment">% model.</span>
0258 <span class="comment">% R2 = feGet(fe,'total r2');</span>
0259 <span class="comment">%---------</span>
0260 <span class="comment">% Percent variance explained</span>
0261 <span class="comment">% R2 = feGet(fe,'explained variance')</span>
0262 <span class="comment">%---------</span>
0263 <span class="comment">% Root mean squared error of the LiFE fit to the whole data</span>
0264 <span class="comment">% rmse = feGet(fe,'rmse')</span>
0265 <span class="comment">%---------</span>
0266 <span class="comment">% Residual signal: (fiber prediction - measured_demeaned).</span>
0267 <span class="comment">% res = feGet(fe,'res sig fiber')</span>
0268 <span class="comment">%---------</span>
0269 <span class="comment">% Residual signal: (full model prediction - measured signal).</span>
0270 <span class="comment">% res = feGet(fe,'res sig full');</span>
0271 <span class="comment">%---------</span>
0272 <span class="comment">% Residual signal: (fiber model prediction - demeaned measured signal)</span>
0273 <span class="comment">% with added mean signal. Res is returned as a vector.</span>
0274 <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0275 <span class="comment">% refinement process.</span>
0276 <span class="comment">% res = feGet(fe,'fiber res sig with mean');</span>
0277 <span class="comment">% res = feGet(fe,'fiber res sig with mean',coords);</span>
0278 <span class="comment">% res = feGet(fe,'fiber res sig with mean',voxelIndices);</span>
0279 <span class="comment">%---------</span>
0280 <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
0281 <span class="comment">% with added mean signal. Res is returned as an array (nBvecs x nVoxel).</span>
0282 <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0283 <span class="comment">% refinement process.</span>
0284 <span class="comment">% res = feGet(fe,'fiber res sig with mean voxel');</span>
0285 <span class="comment">% res = feGet(fe,'fiber res sig with mean voxel',coords);</span>
0286 <span class="comment">% res = feGet(fe,'fiber res sig with mean voxel',voxelIndices);</span>
0287 <span class="comment">%---------</span>
0288 <span class="comment">% Predicted signal by the fiber model in a set of voxels.</span>
0289 <span class="comment">% Vox subfield stores per voxel within the VOI. The pSig has size of the</span>
0290 <span class="comment">% dwi. - It is stored as val = pSig(X,Y,Z,Theta)</span>
0291 <span class="comment">%</span>
0292 <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel');</span>
0293 <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel',coords);</span>
0294 <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel',voxelIndex);</span>
0295 <span class="comment">%---------</span>
0296 <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0297 <span class="comment">% each voxel.</span>
0298 <span class="comment">% R2byVox = feGet(fe,'voxr2');</span>
0299 <span class="comment">% R2byVox = feGet(fe,'voxr2',coords);</span>
0300 <span class="comment">%---------</span>
0301 <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0302 <span class="comment">% each voxel. (Normalized to the squared mean diffusion signal in each voxel)</span>
0303 <span class="comment">% R2byVox = feGet(fe,'voxr2zero');</span>
0304 <span class="comment">% R2byVox = feGet(fe,'voxr2zero',coords);</span>
0305 <span class="comment">%---------</span>
0306 <span class="comment">% Return the percent of varince explained in each voxel.</span>
0307 <span class="comment">% R2byVox = feGet(fe,'var exp by voxel');</span>
0308 <span class="comment">% R2byVox = feGet(fe,'var exp by voxel',coords);</span>
0309 <span class="comment">%---------</span>
0310 <span class="comment">% Demeaned diffusion signal in each voxel.</span>
0311 <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel');</span>
0312 <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',coords);</span>
0313 <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',vxIndex);</span>
0314 <span class="comment">%---------</span>
0315 <span class="comment">% Full (measured) signal in each voxel.</span>
0316 <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel');</span>
0317 <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel',coords);</span>
0318 <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel',vxIndex);</span>
0319 <span class="comment">%---------</span>
0320 <span class="comment">% Predicted signal by the full model in a set of voxeles.</span>
0321 <span class="comment">% pSigByVoxel = feGet(fe, 'pSig full by voxel');</span>
0322 <span class="comment">% pSigByVoxel = feGet(fe, 'pSig full by voxel',coords);</span>
0323 <span class="comment">% pSigByVoxel = feGet(fe, 'pSig full by voxel',voxelIndex);</span>
0324 <span class="comment">%---------</span>
0325 <span class="comment">% A volume of RMSE values.</span>
0326 <span class="comment">% RMSE = feGet(fe,'vox rmse')</span>
0327 <span class="comment">% RMSE = feGet(fe,'vox rmse',coords)</span>
0328 <span class="comment">% RMSE = feGet(fe,'vox rmse',vxIndex)</span>
0329 <span class="comment">%---------</span>
0330 <span class="comment">% A volume of RMSE values with a subset of fibers' weights set to 0.</span>
0331 <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices)</span>
0332 <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices,coords)</span>
0333 <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices,voxelIndex)</span>
0334 <span class="comment">%---------</span>
0335 <span class="comment">% Fibers' residual signal by voxel.</span>
0336 <span class="comment">% res = feGet(fe,'res sig fiber vox')</span>
0337 <span class="comment">% res = feGet(fe,'res sig fiber vox',coords)</span>
0338 <span class="comment">% res = feGet(fe,'res sig fiber vox',vxIndex)</span>
0339 <span class="comment">%---------</span>
0340 <span class="comment">% Full (measured) residual signal by voxel.</span>
0341 <span class="comment">% res = feGet(fe,'res sig full vox')</span>
0342 <span class="comment">% res = feGet(fe,'res sig full vox',coords)</span>
0343 <span class="comment">% res = feGet(fe,'res sig full vox',vxIndex)</span>
0344 <span class="comment">%---------</span>
0345 <span class="comment">% Fibers' residual signal by voxel with mean signal added (with added</span>
0346 <span class="comment">% isotropic component).</span>
0347 <span class="comment">% This is used to compute the residual signal for the refinement.</span>
0348 <span class="comment">% res = feGet(fe,'fiber res sig with mean vox')</span>
0349 <span class="comment">% res = feGet(fe,'fiber res sig with mean vox',coords)</span>
0350 <span class="comment">% res = feGet(fe,'fiber res sig with mean vox',vxIndex)</span>
0351 <span class="comment">%---------</span>
0352 <span class="comment">% Residual signal full model prediction from a multi-voxel fit.</span>
0353 <span class="comment">% res = feGet(fe,'res sig full voxfit');</span>
0354 <span class="comment">% res = feGet(fe, 'res sig full voxfit',coords);</span>
0355 <span class="comment">% res = feGet(fe, 'res sig full voxfit',voxelIndex);</span>
0356 <span class="comment">%---------</span>
0357 <span class="comment">% Given an VOI or a set of indices to voxels returns the indices of the matching voxels inside the big</span>
0358 <span class="comment">% volume, which ordinarily represents the full connectome.</span>
0359 <span class="comment">% voxelIndices = feGet(fe,'voxelsindices',coords)</span>
0360 <span class="comment">% voxelIndices = feGet(fe,'voxelsindices',voxelIndices)</span>
0361 <span class="comment">%---------</span>
0362 <span class="comment">% Given an VOI finds the indices of the matching voxels inside the big</span>
0363 <span class="comment">% volume, which ordinarily represents the full connectome.</span>
0364 <span class="comment">%</span>
0365 <span class="comment">% foundVoxels = feGet(fe,'find voxels',coords)</span>
0366 <span class="comment">%</span>
0367 <span class="comment">% coords is a Nx3 set of coordinates in image space</span>
0368 <span class="comment">% foundVoxels is a vector of 1's and 0's, there is a one for each</span>
0369 <span class="comment">% location the the connectome coordinates for which there is a match in</span>
0370 <span class="comment">% the coords</span>
0371 <span class="comment">%---------</span>
0372 <span class="comment">% Given a set of VOI coords finds the row numbers of the Model matrix</span>
0373 <span class="comment">% (or equivalently the dSig vector) that represent the data for this</span>
0374 <span class="comment">% set of VOI coords.</span>
0375 <span class="comment">% foundVoxels = feGet(fe,'coords 2 rows',coords)</span>
0376 <span class="comment">% coords      - a Nx3 set of coordinates in image space</span>
0377 <span class="comment">% foundVoxels - a binary vector that is 1 for each Model matrix row</span>
0378 <span class="comment">%               that corresponds to at least one of the coords.</span>
0379 <span class="comment">%---------</span>
0380 <span class="comment">% Quaternian transformation from IMAGE space to ACPC space.</span>
0381 <span class="comment">% xform = feGet(fe,'xform')</span>
0382 <span class="comment">%---------</span>
0383 <span class="comment">% Quaternian transformation from ACPC space to IMAGE space.</span>
0384 <span class="comment">% xform = feGet(fe,'xform')</span>
0385 <span class="comment">%---------</span>
0386 <span class="comment">% Dimensions of the DW volume.</span>
0387 <span class="comment">% dim = feGet(fe,'dims')</span>
0388 <span class="comment">%---------</span>
0389 <span class="comment">% Dimensions of the maps of parameters and results.</span>
0390 <span class="comment">% dims = feGet(fe, 'mapsize')</span>
0391 <span class="comment">%---------</span>
0392 <span class="comment">% Path to the 3D Anatomy Volume.</span>
0393 <span class="comment">% anatomyfile = feGet(fe, 't1 file')</span>
0394 <span class="comment">%</span>
0395 <span class="comment">% End of feGet.m parameters,</span>
0396 <span class="comment">%</span>
0397 <span class="comment">% Franco Pestilli (c) Stanford Vista Team 2012</span>
0398    
0399 val = [];
0400 
0401 <span class="comment">% Format the input parameters.</span>
0402 param = lower(strrep(param,<span class="string">' '</span>,<span class="string">''</span>));
0403 
0404 <span class="comment">% Start sorting the input and computing the output.</span>
0405 <span class="keyword">switch</span> param
0406   <span class="keyword">case</span> <span class="string">'name'</span>
0407     <span class="comment">% Name of the current fe structure.</span>
0408     <span class="comment">%</span>
0409     <span class="comment">% name = feGet(fe,'name')</span>
0410     val = fe.name;
0411     
0412   <span class="keyword">case</span> <span class="string">'type'</span>
0413     <span class="comment">% The type of objes (always, fascicle evaluation)</span>
0414     <span class="comment">%</span>
0415     <span class="comment">% type = feGet(fe,'type')</span>
0416     val = fe.type; <span class="comment">% Always fascicle evaluation</span>
0417     
0418     <span class="comment">% Set top level structure, not just single slot</span>
0419   <span class="keyword">case</span> <span class="string">'life'</span>
0420     <span class="comment">% Structure of parameters and results from LIFE analysis</span>
0421     <span class="comment">%</span>
0422     <span class="comment">% life = feGet(fe,'life')</span>
0423     val = fe.life; 
0424     
0425   <span class="keyword">case</span> {<span class="string">'fgimg'</span>,<span class="string">'fibersimg'</span>}
0426     <span class="comment">% Return the connectome (fiber group) in image coordinates.</span>
0427     <span class="comment">%</span>
0428     <span class="comment">% fg = feGet(fe,'fg img')</span>
0429     val = fe.fg;  <span class="comment">% Fiber group candidate fascicles, uses fgSet/Get</span>
0430     
0431   <span class="keyword">case</span> {<span class="string">'fgacpc'</span>,<span class="string">'fibersacpc'</span>}
0432     <span class="comment">% return the connectome in acpc coordinates.</span>
0433     <span class="comment">%</span>
0434     <span class="comment">% fg  = feGet(fg,'fg acpc')</span>
0435     xform = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'img2acpcxform'</span>);
0436     val   = dtiXformFiberCoords(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fgimg'</span>),xform,<span class="string">'acpc'</span>);
0437     
0438   <span class="keyword">case</span> <span class="string">'roi'</span>
0439     <span class="comment">% Return the VOI comprised by the full connectome.</span>
0440     <span class="comment">%</span>
0441     <span class="comment">% roi = feGet(fe,'roi')</span>
0442     val = fe.roi;
0443     
0444   <span class="keyword">case</span> <span class="string">'roiacpc'</span>
0445     <span class="comment">% Return the VOI comprised by the full connectome.</span>
0446     <span class="comment">%</span>
0447     <span class="comment">% roi = feGet(fe,'roi acpc')</span>
0448     name   = sprintf(<span class="string">'roi_%s'</span>,fe.fg.name); 
0449     randColor = rand(1,3);
0450     val = dtiNewRoi(name,randColor,fefgGet(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fg acpc'</span>),<span class="string">'unique image coords'</span>));
0451     
0452   <span class="keyword">case</span> <span class="string">'xform'</span>
0453     <span class="comment">% Transforms between coords for fg, roi, and dwi data</span>
0454     <span class="comment">%</span>
0455     <span class="comment">% xform = feGet(fe,'xform')</span>
0456     val = fe.life.xform;
0457     
0458   <span class="keyword">case</span> <span class="string">'dwi'</span>
0459     <span class="comment">%  Load the diffusion weighted data.</span>
0460     <span class="comment">%</span>
0461     <span class="comment">% dwi = feGet(fe,'dwi')</span>
0462     val = dwiLoad(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dwifile'</span>));
0463   
0464   <span class="keyword">case</span> <span class="string">'dwirepeat'</span>
0465     <span class="comment">%  Load the diffusion weighted data.</span>
0466     <span class="comment">%</span>
0467     <span class="comment">% dwi = feGet(fe,'dwirepeat')</span>
0468     val = dwiLoad(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dwifile'</span>));
0469     
0470   <span class="keyword">case</span> <span class="string">'dwifile'</span>
0471     <span class="comment">%  Load the diffusion weighted data.</span>
0472     <span class="comment">%</span>
0473     <span class="comment">% dwiFile = feGet(fe,'dwifile')</span>
0474     val = fe.path.dwifile;
0475     
0476   <span class="keyword">case</span> <span class="string">'savedir'</span>
0477     <span class="comment">%  Directory where the LiFe structes are saved by defualt.</span>
0478     <span class="comment">%</span>
0479     <span class="comment">% sdir = feGet(fe,'savedir');</span>
0480     val = fe.path.savedir;
0481     
0482   <span class="keyword">case</span> {<span class="string">'bvecs'</span>}
0483     <span class="comment">% Diffusion directions.</span>
0484     <span class="comment">%</span>
0485     <span class="comment">% val = feGet(fe,'bvecs');</span>
0486     val = fe.life.bvecs;
0487     
0488   <span class="keyword">case</span> {<span class="string">'bvecsindices'</span>}
0489     <span class="comment">% Indices to the diffusion directions in the DWi 4th Dimension.</span>
0490     <span class="comment">%</span>
0491     <span class="comment">% val = feGet(fe,'bvecs indices');</span>
0492     val = fe.life.bvecsindices;
0493     
0494   <span class="keyword">case</span> {<span class="string">'nbvecs'</span>,<span class="string">'nbvals'</span>}
0495     <span class="comment">% Number of B0's</span>
0496     <span class="comment">%</span>
0497     <span class="comment">% val = feGet(fe,'n bvals');</span>
0498     val = length(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'bvals'</span>));
0499     
0500   <span class="keyword">case</span> {<span class="string">'bvals'</span>}
0501     <span class="comment">% B0 Values.</span>
0502     <span class="comment">%</span>
0503     <span class="comment">% bval = feGet(fe,'bvals')</span>
0504     val = fe.life.bvals;
0505     
0506   <span class="keyword">case</span> {<span class="string">'diffusionsignalinvoxel'</span>,<span class="string">'dsiinvox'</span>,<span class="string">'dsigvox'</span>,<span class="string">'dsigmeasuredvoxel'</span>}
0507     <span class="comment">% Returns a nVoxels X nBvecs array of measured diffusion signal</span>
0508     <span class="comment">%</span>
0509     <span class="comment">% val = feGet(fe,'dsiinvox');</span>
0510     <span class="comment">% val = feGet(fe,'dsiinvox',voxelsIndices);</span>
0511     <span class="comment">% val = feGet(fe,'dsiinvox',coords);</span>
0512     val = fe.life.diffusion_signal_img(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin),:)';
0513     
0514   <span class="keyword">case</span> {<span class="string">'diffusionsignalinvoxeldemeaned'</span>,<span class="string">'dsiinvoxdemeaned'</span>}
0515     <span class="comment">% Returns a nVoxels X nBvecs array of demeaned diffusion signal</span>
0516     <span class="comment">%</span>
0517     <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned');</span>
0518     <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned',voxelsIndices);</span>
0519     <span class="comment">% val =feGet(fe,'dsiinvoxdemeaned',coords);</span>
0520     nBvecs     = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
0521     voxelIndices = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin);
0522     val = fe.life.diffusion_signal_img(voxelIndices,:) - repmat(mean(fe.life.diffusion_signal_img(voxelIndices,:), 2),1,nBvecs);
0523     keyboard
0524     <span class="comment">% THis seems to be worng</span>
0525   <span class="keyword">case</span> {<span class="string">'b0signalimage'</span>,<span class="string">'b0vox'</span>}
0526     <span class="comment">% Get the diffusion signal at 0 diffusion weighting (B0) for this voxel</span>
0527     <span class="comment">%</span>
0528     <span class="comment">% val = feGet(fe,'b0signalvoxel');</span>
0529     <span class="comment">% val = feGet(fe,'b0signalvoxel',voxelIndex);</span>
0530     <span class="comment">% val = feGet(fe,'b0signalvoxel',coords);</span>
0531     val = fe.life.diffusion_S0_img(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin), :);
0532     
0533   <span class="keyword">case</span> {<span class="string">'fiberssubset'</span>,<span class="string">'fsub'</span>,<span class="string">'subsetoffibers'</span>,<span class="string">'fgsubset'</span>}
0534     <span class="comment">% Return a subset of fibers from the conenctome.</span>
0535     <span class="comment">%</span>
0536     <span class="comment">% fg = feGet(fe,'fiberssubset',fiberList);</span>
0537     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fg img'</span>);
0538     fiberList = varargin{1};
0539     fibers = cell(size(fiberList));
0540     <span class="keyword">for</span> ff = 1:length(fiberList)
0541       fibers{ff} = val.fibers{fiberList(ff)};
0542       <span class="keyword">if</span> isfield(val,<span class="string">'pathwayInfo'</span>)
0543         pathInfo(ff) = val.pathwayInfo(fiberList(ff));
0544       <span class="keyword">end</span>
0545     <span class="keyword">end</span>
0546     val.fibers = fibers;
0547     <span class="keyword">if</span> isfield(val,<span class="string">'pathwayInfo'</span>)
0548       val.pathwayInfo = pathInfo;
0549     <span class="keyword">end</span>
0550     val.name = sprintf(<span class="string">'subsetFrom:%s'</span>,val.name);
0551     
0552   <span class="keyword">case</span> {<span class="string">'roivoxels'</span>,<span class="string">'roicoords'</span>}
0553     <span class="comment">% Return the coordinates of the VOI comprised in the connectome.</span>
0554     <span class="comment">% Always in image space.</span>
0555     <span class="comment">%</span>
0556     <span class="comment">% coords = feGet(fe,'roi coords')</span>
0557     val = fe.roi.coords;
0558     
0559   <span class="keyword">case</span> {<span class="string">'nroivoxels'</span>,<span class="string">'nvoxels'</span>}
0560     <span class="comment">% Number of voxels in the connectome/VOI.</span>
0561     <span class="comment">%</span>
0562     <span class="comment">% nVoxels = feGet(fe,'n voxels')</span>
0563     val = size(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'roivoxels'</span>),1);
0564     
0565   <span class="keyword">case</span> {<span class="string">'usedvoxels'</span>,<span class="string">'indexesofusedvoxels'</span>}
0566     <span class="comment">% Indexes of actually used voxels.</span>
0567     <span class="comment">%</span>
0568     <span class="comment">% These can be different than the number of voxels in the VOI in case some</span>
0569     <span class="comment">% voxels have no fibers in them.</span>
0570     <span class="comment">%</span>
0571     <span class="comment">% TO BE DEPRECATED.</span>
0572     <span class="comment">%</span>
0573     <span class="comment">% indxUsedVx = feGet(fe,'index of used voxels')</span>
0574     val = find(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nnodes'</span>));
0575     
0576   <span class="keyword">case</span> {<span class="string">'nusedvoxels'</span>,<span class="string">'numberofusedvoxels'</span>}
0577     <span class="comment">% Number of actually used voxels.</span>
0578     <span class="comment">%</span>
0579     <span class="comment">% This can be less than the number of voxels in the VOI in case some</span>
0580     <span class="comment">% voxels have no fibers in them.</span>
0581     <span class="comment">%</span>
0582     <span class="comment">% TO BE DEPRECATED.</span>
0583     <span class="comment">%</span>
0584     <span class="comment">% nUsedVx = feGet(fe,'index of used voxels')</span>
0585     val = size(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'used voxels'</span>),2);
0586     
0587   <span class="keyword">case</span> {<span class="string">'startrow'</span>,<span class="string">'first index into the dsig vector for a voxel'</span>}
0588     <span class="comment">% Returns the first index to a voxel in the dSig vector.</span>
0589     <span class="comment">%</span>
0590     <span class="comment">% The dSig vector is 1:nBvecs*nVoxels.</span>
0591     <span class="comment">%</span>
0592     <span class="comment">% val = feGet(fe,'start rows')</span>
0593     val = (varargin{1}-1)*<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>) + 1;
0594     
0595   <span class="keyword">case</span> {<span class="string">'voxelrows'</span>,<span class="string">'all indexes into the dsig vector for a set of voxels'</span>}
0596     <span class="comment">% Return the rows corresponding to a set of voxels.</span>
0597     <span class="comment">%</span>
0598     <span class="comment">% rows = feGet(fe,'voxel rows',idxVoxel)</span>
0599     n        = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0600     nBvecs   = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n bvecs'</span>);
0601     voxelsToKeep = zeros(n,1); voxelsToKeep(varargin{1}) = 1;
0602     val = logical(kron(voxelsToKeep(:),ones(nBvecs,1)));
0603     
0604   <span class="keyword">case</span> {<span class="string">'modeltensor'</span>}
0605     val = fe.life.modelTensor;
0606     
0607   <span class="keyword">case</span> {<span class="string">'mfiber'</span>,<span class="string">'m'</span>,<span class="string">'model'</span>}
0608     <span class="comment">% Return the model (M matrix), or a subset of it.</span>
0609     <span class="comment">%</span>
0610     <span class="comment">% Mfiber = feGet(fe,'M fiber');</span>
0611     <span class="comment">% Mfiber = feGet(fe,'model',voxelsIndices);</span>
0612     <span class="comment">% Mfiber = feGet(fe,'model',coords);</span>
0613     
0614     <span class="comment">% idxVoxels is an integer list of the voxels to retain</span>
0615     <span class="comment">% If idxVoxels is not included, return the whole matrix</span>
0616     <span class="comment">% M contains only the rows for the specified voxels (all directions)</span>
0617     <span class="keyword">if</span> isempty(varargin)
0618       <span class="comment">% Return the whole M matrix</span>
0619       val = fe.life.Mfiber;
0620     <span class="keyword">else</span>
0621       <span class="comment">% Return only the rows for the specified voxels, including all</span>
0622       <span class="comment">% directions.</span>
0623       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0624       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0625       <span class="comment">% val = fe.life.Mfiber(voxelRowsToKeep,:);</span>
0626       val = fe.life.Mfiber(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)),:);
0627     <span class="keyword">end</span>
0628     
0629   <span class="keyword">case</span> {<span class="string">'mfibervoxelsubset'</span>,<span class="string">'indexedafiber'</span>,<span class="string">'mfiberindexed'</span>}
0630     <span class="comment">% Return a subset of measurements from the fiber portion of M matrix</span>
0631     <span class="comment">% The rows of M are specified.  Remember that the rows refer to a</span>
0632     <span class="comment">% combination of voxel and measurement direction and potentially in the</span>
0633     <span class="comment">% future a b-value.  Hence, the rows are not specific to a voxel.</span>
0634     <span class="comment">%</span>
0635     <span class="comment">% Mfiber = feGet(fe,'mfiber subset',rowsToKeep);</span>
0636     
0637     <span class="keyword">if</span> isempty(varargin), error(<span class="string">'Subset of rows must be specified'</span>); <span class="keyword">end</span>
0638     val = fe.life.Mfiber(varargin{1},:);
0639     
0640   <span class="keyword">case</span> {<span class="string">'msubsetfibers'</span>,<span class="string">'mfiberssubset'</span>,<span class="string">'mkeepfibers'</span>}
0641     <span class="comment">% Returns the model (M) with only a subset of columns (fibers).</span>
0642     <span class="comment">%</span>
0643     <span class="comment">% fiberList is a vector of indexes, e.g, [1 10 100]</span>
0644     <span class="comment">%</span>
0645     <span class="comment">% M = feGet(fe,'mkeepfibers',fiberList)</span>
0646     val = fe.life.Mfiber(:,varargin{1});
0647     
0648   <span class="keyword">case</span> {<span class="string">'miso'</span>}
0649     <span class="comment">% Isotropic portion of M matrix</span>
0650     <span class="comment">% returns the matrix for the full model or for a subset of voxels</span>
0651     <span class="comment">%</span>
0652     <span class="comment">% Miso = feGet(fe,'M iso')</span>
0653     <span class="comment">% Miso = feGet(fe,'M iso',voxelsIndices)</span>
0654     <span class="comment">% Miso = feGet(fe,'M iso',coords)</span>
0655     <span class="keyword">if</span> isempty(varargin)
0656       <span class="comment">% Return the whole M iso</span>
0657       val = feBuildSparseBlockDiag(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>),<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>));
0658     <span class="keyword">else</span>
0659       val = feBuildSparseBlockDiag(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>),length(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0660     <span class="keyword">end</span>
0661     
0662   <span class="keyword">case</span> {<span class="string">'voxel2fnpair'</span>,<span class="string">'voxel2fibernodepair'</span>,<span class="string">'v2fnp'</span>}
0663     <span class="comment">% Pairing of fibers and nodes in each voxel.</span>
0664     <span class="comment">%</span>
0665     <span class="comment">% v2fnp = feGet(fe,'v2fnp');</span>
0666     <span class="keyword">if</span> isempty(fe.life.voxel2FNpair)
0667       fprintf(<span class="string">'[%s] fe.life.voxel2FNpair is empty, can be computed as: \nfe = feSet(fe,''v2fnp'',feGet(fe,''fg img''),''v2fn'',feGet(fe,''roi coords'')'</span>,mfilename);
0668       <span class="keyword">return</span>
0669     <span class="keyword">end</span>
0670     val = fe.life.voxel2FNpair;
0671     
0672   <span class="keyword">case</span> {<span class="string">'tensors'</span>,<span class="string">'fibers tensors'</span>}
0673     <span class="comment">% Tensors computed for each node and fiber in a set of voxels.</span>
0674     <span class="comment">%</span>
0675     <span class="comment">% t = feGet(fe,'tensors')</span>
0676     <span class="comment">% t = feGet(fe,'tensors',voxelsIndices);</span>
0677     <span class="comment">% t = feGet(fe,'tensors',coords);</span>
0678     <span class="keyword">if</span> isempty(varargin)
0679       val = fe.life.fibers.tensors;
0680     <span class="keyword">else</span>
0681       vv = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin);
0682       val = cell(size(vv));
0683       <span class="keyword">for</span> ff = 1:length(vv)
0684         val{ff} = fe.life.fibers.tensors{vv(ff)};
0685       <span class="keyword">end</span>
0686     <span class="keyword">end</span>
0687     
0688   <span class="keyword">case</span> {<span class="string">'voxeltensors'</span>,<span class="string">'voxtensors'</span>,<span class="string">'voxq'</span>}
0689     <span class="comment">% Get all the tensors in a signle voxel</span>
0690     <span class="comment">%</span>
0691     <span class="comment">% val = feGet(fe,'voxtensors',voxelIndex)</span>
0692     <span class="comment">% val = feGet(fe,'voxtensors',coord)</span>
0693     
0694     <span class="comment">% Index for the voxel</span>
0695     vv = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin);
0696     
0697     <span class="comment">% The indexes of the voxeles used, to build LiFE.</span>
0698     usedVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'usedVoxels'</span>);
0699     voxIndex   = usedVoxels(vv);
0700     nNodes     = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nNodes'</span>);
0701     
0702     <span class="comment">% Get the tensors for each node in each fiber going through this voxel:</span>
0703     val = zeros(nNodes(voxIndex), 9); <span class="comment">% Allocate space for all the tensors (9 is for the 3 x 3 tensor components)</span>
0704     <span class="keyword">for</span> ii = 1:nNodes(voxIndex)           <span class="comment">% Get the tensors</span>
0705       val(ii,:) = fe.life.fibers.tensors{fe.life.voxel2FNpair{voxIndex}(ii,1)} <span class="keyword">...</span>
0706         (fe.life.voxel2FNpair{voxIndex}(ii,2),:);
0707     <span class="keyword">end</span>
0708     
0709   <span class="keyword">case</span> {<span class="string">'nnodes'</span>,<span class="string">'numofnodes'</span>}
0710     <span class="comment">% Total number of nodes in each voxel The voxel2FN pairs are row size</span>
0711     <span class="comment">% equals number of nodes and column size is always 2. The entries of</span>
0712     <span class="comment">% the first column are the fiber number. The entries in the second</span>
0713     <span class="comment">% column are the node of the fiber inside the voxel.</span>
0714     <span class="comment">%</span>
0715     <span class="comment">% val = feGet(fe,'n nodes');</span>
0716     <span class="comment">% val = feGet(fe,'n nodes',voxelsIndices);</span>
0717     <span class="comment">% val = feGet(fe,'n nodes',coords);</span>
0718     [val, ~] = cellfun(@size,fe.life.voxel2FNpair);
0719     val      = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0720     
0721   <span class="keyword">case</span> {<span class="string">'numberofuniquefibersbyvoxel'</span>,<span class="string">'uniquefnum'</span>}
0722     <span class="comment">% Return the total number of fibers for all the voxels or in a set of</span>
0723     <span class="comment">% voxels</span>
0724     <span class="comment">%</span>
0725     <span class="comment">% nFibers = feGet(fe,'uniquefnum');           % all the voxels</span>
0726     <span class="comment">% nFibers = feGet(fe,'uniquefnum',[1 2 3 4]); % for some the voxels,</span>
0727     <span class="comment">%                                             % specified by indexes</span>
0728     <span class="comment">% nFibers = feGet(fe,'uniquefnum',coords);    % for some the voxels,</span>
0729     <span class="comment">%                                             % specified by coordinates</span>
0730     val = fe.life.fibers.unique.num(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0731     
0732   <span class="keyword">case</span> {<span class="string">'indextouniquefibersbyvoxel'</span>,<span class="string">'uniquef'</span>}
0733     <span class="comment">% Return the indexes of the fibers for all the voxels or in a set of</span>
0734     <span class="comment">% voxels.</span>
0735     <span class="comment">%</span>
0736     <span class="comment">% idxFibers = feGet(fe,'uniquef');           % all the voxels</span>
0737     <span class="comment">% idxFibers = feGet(fe,'uniquef',[1 2 3 4]); % for some the voxels,</span>
0738     <span class="comment">%                                            % specified by indexes</span>
0739     <span class="comment">% idxFibers = feGet(fe,'uniquef',coords);    % for some the voxels,</span>
0740     <span class="comment">%                                            % specified by coordinates</span>
0741     vxIndex = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxels indices'</span>,varargin);
0742     val = cell(length(vxIndex),1);
0743     <span class="keyword">for</span> ii = 1:length(vxIndex)
0744       val{ii} = fe.life.fibers.unique.index{vxIndex(ii)};
0745     <span class="keyword">end</span>
0746     
0747   <span class="keyword">case</span> {<span class="string">'numberoftotalfibersbyvoxels'</span>,<span class="string">'totfnum'</span>}
0748     <span class="comment">% Return the total number of fibers for all the voxels or in a set of</span>
0749     <span class="comment">% voxels</span>
0750     <span class="comment">%</span>
0751     <span class="comment">% nFibers = feGet(fe,'totfnum');           % all the voxels</span>
0752     <span class="comment">% nFibers = feGet(fe,'totfnum',[1 2 3 4]); % for some the voxels,</span>
0753     <span class="comment">%                                          % specified by indexes</span>
0754     <span class="comment">% nFibers = feGet(fe,'totfnum',coords);    % for some the voxels,</span>
0755     <span class="comment">%                                          % specified by coordinates</span>
0756     val = fe.life.fibers.total.num(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxels indices'</span>,varargin));
0757     
0758   <span class="keyword">case</span> {<span class="string">'indexoftotalfibersbuvoxel'</span>,<span class="string">'totf'</span>}
0759     <span class="comment">% Return the indexes of the fibers for all the voxels or in a set of</span>
0760     <span class="comment">% voxels</span>
0761     <span class="comment">%</span>
0762     <span class="comment">% idxFibers = feGet(fe,'totf');             % all the voxels</span>
0763     <span class="comment">% idxFibers = feGet(fe,'totf',[1 2 3 4]);   % for some the voxels,</span>
0764     <span class="comment">%                                           % specified by indexes</span>
0765     <span class="comment">% idxFibers = feGet(fe,'totfibers',coords); % for some the voxels,</span>
0766     <span class="comment">%                                           % specified by coordinates</span>
0767     vxIndex = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxels indices'</span>,varargin);
0768     val = cell(length(vxIndex),1);
0769     <span class="keyword">for</span> ii = 1:length(vxIndex)
0770       val{ii} = fe.life.fibers.total.index{vxIndex(ii)};
0771     <span class="keyword">end</span>
0772     
0773   <span class="keyword">case</span> {<span class="string">'nfibers'</span>}
0774     <span class="comment">% Return the number of fibers in the model.</span>
0775     <span class="comment">%</span>
0776     <span class="comment">% nFibers = feGet(fe,'n fibers')</span>
0777     val = size(fe.life.Mfiber,2);
0778     
0779   <span class="keyword">case</span> {<span class="string">'isoweights'</span>,<span class="string">'weightsiso'</span>,<span class="string">'meanvoxelsignal'</span>}
0780     <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0781     <span class="comment">% each voxel.</span>
0782     <span class="comment">%</span>
0783     <span class="comment">% val = feGet(fe,'iso weights');</span>
0784     <span class="comment">% val = feGet(fe,'iso weights'coords)</span>
0785     <span class="comment">% val = feGet(fe,'iso weights',voxelIndices)</span>
0786     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Miso'</span>) \ <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsig full'</span>)';
0787     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0788      
0789   <span class="keyword">case</span> {<span class="string">'voxisoweights'</span>,<span class="string">'voxweightsiso'</span>,<span class="string">'voxmeanvoxelsignal'</span>}
0790     <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0791     <span class="comment">% each voxel.</span>
0792     <span class="comment">% Organized nBvecs x nVoxels</span>
0793     <span class="comment">%</span>
0794     <span class="comment">% val = feGet(fe,'iso weights');</span>
0795     <span class="comment">% val = feGet(fe,'iso weights'coords)</span>
0796     <span class="comment">% val = feGet(fe,'iso weights',voxelIndices)</span>
0797     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Miso'</span>) \ <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsig full'</span>)';
0798     val = repmat(val,1,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nbvecs'</span>))';
0799 
0800     <span class="keyword">if</span> ~isempty(varargin)
0801       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0802       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0803       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0804       val = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0805     <span class="keyword">end</span>
0806 
0807   <span class="keyword">case</span> {<span class="string">'dsigiso'</span>,<span class="string">'isodsig'</span>}
0808     <span class="comment">% mean signalin each voxel, returned for each diffusion direction:</span>
0809     <span class="comment">% size(nBvecsxnVoxels, 1).</span>
0810     <span class="comment">%</span>
0811     <span class="comment">% val = feGet(fe,'iso disg');</span>
0812     <span class="comment">% val = feGet(fe,'iso disg',coords)</span>
0813     <span class="comment">% val = feGet(fe,'iso dsig',voxelIndices)</span>
0814     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'iso weights'</span>);
0815     val = repmat(val,1,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nbvecs'</span>))';
0816     val = val(:);
0817     
0818   <span class="keyword">case</span> {<span class="string">'fiberweights'</span>}
0819     <span class="comment">% Weights of the fiber component. For all the fibers or a subset of</span>
0820     <span class="comment">% them.</span>
0821     <span class="comment">%</span>
0822     <span class="comment">% w = feGet(fe,'fiber weights')</span>
0823     <span class="comment">% w = feGet(fe,'fiber weights',fiberIndices)</span>
0824 
0825     <span class="comment">% If the model was not fit yet, fit it, install the fit and then return</span>
0826     <span class="comment">% the weights.</span>
0827     <span class="keyword">if</span> ~isfield(fe.life,<span class="string">'fit'</span>)
0828       fprintf(<span class="string">'[%s] fe.life.fit is empty, can be computed as: \nfeSet(fe,''fit'',feFitModel(feGet(fe,''Mfiber''), feGet(fe,''dsigdemeaned''),''sgdnn''))'</span>,mfilename);
0829       <span class="keyword">return</span>
0830     <span class="keyword">end</span>
0831     
0832     <span class="comment">% Get the weights</span>
0833     <span class="keyword">if</span> ~isempty(varargin) <span class="comment">% subselect the weights for the requested fibers</span>
0834       val = fe.life.fit.weights(varargin{1});  
0835     <span class="keyword">else</span> <span class="comment">% Return all of them</span>
0836       val = fe.life.fit.weights;
0837     <span class="keyword">end</span>
0838     
0839   <span class="keyword">case</span> {<span class="string">'fiberweightstest'</span>}
0840     <span class="comment">% Weights of the fiber component with a subset of the fibers' weigth</span>
0841     <span class="comment">% set to zero. This can be used to test the loss in RMSE for the</span>
0842     <span class="comment">% connectome when a subset of fibers is removed, but the connectome is</span>
0843     <span class="comment">% not fitted again.</span>
0844     <span class="comment">%</span>
0845     <span class="comment">% w = feGet(fe,'fiber weights test',fiberIndices)</span>
0846 
0847     <span class="comment">% If the model was not fit yet, fit it, install the fit and then return</span>
0848     <span class="comment">% the weights.</span>
0849     <span class="keyword">if</span> ~isfield(fe.life,<span class="string">'fit'</span>)
0850       fprintf(<span class="string">'[%s] fe.life.fit is empty, can be computed as: \nfeSet(fe,''fit'',feFitModel(feGet(fe,''Mfiber''), feGet(fe,''dsigdemeaned''),''sgdnn''))'</span>,mfilename);
0851       <span class="keyword">return</span>
0852     <span class="keyword">end</span>
0853     
0854     <span class="comment">% Get the weights</span>
0855     <span class="keyword">if</span> ~isempty(varargin) <span class="comment">% subselect the weights for the requested fibers</span>
0856       val = fe.life.fit.weights;  
0857       val(varargin{1}) = 0;
0858     <span class="keyword">else</span> <span class="comment">% A set of fiber weights is required as input</span>
0859       error(<span class="string">'[%s] Indices to a subset of fiber-weights must be passed in w = feGet(fe,''fiber weights test'',fiberIndices))'</span>,mfilename);
0860     <span class="keyword">end</span>
0861     
0862     <span class="keyword">case</span> {<span class="string">'fiberweightstestvoxelwise'</span>}
0863     <span class="comment">% Weights of the fiber component with a subset of the fibers' weigth</span>
0864     <span class="comment">% set to zero. This can be used to test the loss in RMSE for the</span>
0865     <span class="comment">% connectome when a subset of fibers is removed, but the connectome is</span>
0866     <span class="comment">% not fitted again.</span>
0867     <span class="comment">%</span>
0868     <span class="comment">% w = feGet(fe,'fiber weights test voxel wise',fiberIndices)</span>
0869 
0870     <span class="comment">% If the model was not fit yet, fit it, install the fit and then return</span>
0871     <span class="comment">% the weights.</span>
0872     <span class="keyword">if</span> ~isfield(fe.life,<span class="string">'voxfit'</span>)
0873       fprintf(<span class="string">'[%s] fe.life.fit is empty, can be computed as: \nfeSet(fe,''fit'',feFitModel(feGet(fe,''Mfiber''), feGet(fe,''dsigdemeaned''),''sgdnn''))'</span>,mfilename);
0874       <span class="keyword">return</span>
0875     <span class="keyword">end</span>
0876     
0877     <span class="comment">% Get the weights</span>
0878     <span class="keyword">if</span> ~isempty(varargin) <span class="comment">% subselect the weights for the requested fibers</span>
0879       val = fe.life.voxfit.weights;  
0880       val(:,varargin{1}) = 0;
0881     <span class="keyword">else</span> <span class="comment">% A set of fiber weights is required as input</span>
0882       error(<span class="string">'[%s] Indices to a subset of fiber-weights must be passed in\nw = feGet(fe,''fiber weights test voxel wise'',fiberIndices))'</span>,mfilename);
0883     <span class="keyword">end</span>
0884     
0885   <span class="keyword">case</span> {<span class="string">'dsigmeasured'</span>,<span class="string">'dsigfull'</span>}
0886     <span class="comment">% Measured signal in VOI, this is the raw signal. not demeaned</span>
0887     <span class="comment">%</span>
0888     <span class="comment">% dSig = feGet(fe,'dSig full')</span>
0889     val = fe.life.dSig;
0890     <span class="comment">% Return a subset of voxels</span>
0891     <span class="keyword">if</span> ~isempty(varargin)
0892       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0893       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0894       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
0895       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0896     <span class="keyword">end</span>
0897     
0898   <span class="keyword">case</span> {<span class="string">'diffusionsignaldemeaned'</span>,<span class="string">'dsigdemeaned'</span>}
0899     <span class="comment">% Measured signal in VOI, demeaned, this is the signal used for the</span>
0900     <span class="comment">% fiber-portion of the M model.</span>
0901     <span class="comment">%</span>
0902     <span class="comment">% dSig = feGet(fe,'dsigdemeaned');</span>
0903     <span class="comment">% dSig = feGet(fe,'dsigdemeaned',[1 10 100]);</span>
0904     <span class="comment">% dSig = feGet(fe,'dsigdemeaned',coords);</span>
0905     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>);
0906     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
0907     val     = (fe.life.dSig - reshape(repmat( <span class="keyword">...</span>
0908       mean(reshape(fe.life.dSig, nBvecs, nVoxels),1),<span class="keyword">...</span>
0909       nBvecs,1), size(fe.life.dSig)))';
0910     <span class="comment">% Return a subset of voxels</span>
0911     <span class="keyword">if</span> ~isempty(varargin)
0912       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0913       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0914       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0915       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0916     <span class="keyword">end</span>
0917     
0918   <span class="keyword">case</span> {<span class="string">'dsigrowssubset'</span>,<span class="string">'diffusionsignaldemeanedinsubsetofrows'</span>}
0919     <span class="comment">% Get the demeaned signal for a subset of rows.</span>
0920     <span class="comment">% Useful for cross-validation.</span>
0921     <span class="comment">%</span>
0922     <span class="comment">% dSig = feGet(fe,'dsigrowssubset',voxelsList);</span>
0923     dSig = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned'</span>);
0924     <span class="keyword">for</span> vv = 1:length(voxelsList)
0925       val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,vv)) = dSig(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,voxelList(vv)));
0926     <span class="keyword">end</span>
0927     
0928   <span class="keyword">case</span> {<span class="string">'psigfiber'</span>, <span class="string">'fiberpsig'</span>,<span class="string">'fiberpredicted'</span>,<span class="string">'dsigpredictedfiber'</span>}
0929     <span class="comment">% Predicted signal of fiber alone (demeaned).</span>
0930     <span class="comment">%</span>
0931     <span class="comment">% pSig = feGet(fe,'pSig fiber');</span>
0932     <span class="comment">% pSig = feGet(fe,'pSig fiber',coords);</span>
0933     <span class="comment">% pSig = feGet(fe,'pSig fiber',voxelIndices);</span>
0934     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Mfiber'</span>)*<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber weights'</span>);
0935     <span class="keyword">if</span> ~isempty(varargin)
0936       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0937       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0938       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0939       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0940     <span class="keyword">end</span>
0941     
0942   <span class="keyword">case</span> {<span class="string">'psigfibertest'</span>}
0943     <span class="comment">% Predicted signal (demeaned) with a subset of fibers' weights set to 0.</span>
0944     <span class="comment">% This can be used to test the loss in RMSE for the connectome when a</span>
0945     <span class="comment">% subset of fibers is removed, but the connectome is not fitted again.</span>
0946     <span class="comment">%</span>
0947     <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices);</span>
0948     <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices,voxelIndices);</span>
0949     <span class="comment">% pSig = feGet(fe,'pSig fiber test',fiberIndices,coords);</span>
0950     <span class="keyword">if</span> ~isempty(varargin)
0951       val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Mfiber'</span>)*<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber weights test'</span>,varargin{1});
0952           
0953       <span class="comment">% Now select a subset of voxels if requested</span>
0954       <span class="keyword">if</span> (length(varargin) == 2)
0955         <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0956         <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0957         <span class="comment">% val               = val(voxelRowsToKeep,:);</span>
0958         val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin{2})));
0959       <span class="keyword">end</span>
0960     <span class="keyword">else</span>
0961       error(<span class="string">'[%s] A set f fiber indiced must be passed in. pSig = feGet(fe,''pSig fiber test'',fiberIndices))'</span>,mfilename);
0962     <span class="keyword">end</span>
0963     
0964   <span class="keyword">case</span> {<span class="string">'psigfibertestvoxelwise'</span>}
0965     <span class="comment">% Predicted signal (demeaned) with a subset of fibers' weights set to 0.</span>
0966     <span class="comment">% This can be used to test the loss in RMSE for the connectome when a</span>
0967     <span class="comment">% subset of fibers is removed, but the connectome is not fitted again.</span>
0968     <span class="comment">%</span>
0969     <span class="comment">% pSig = feGet(fe,'pSig fiber test voxel wise',fiberIndices);</span>
0970     <span class="comment">% pSig = feGet(fe,'pSig fiber test voxel wise',fiberIndices,voxelIndices);</span>
0971     <span class="comment">% pSig = feGet(fe,'pSig fiber test voxel wise',fiberIndices,coords);</span>
0972     
0973     <span class="keyword">if</span> ~isempty(varargin)
0974       nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nvoxels'</span>);
0975       w = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber weights test voxel wise'</span>,varargin{1}); <span class="comment">% Weights with a subset set to 0</span>
0976       <span class="comment">% Handling parallel processing</span>
0977       poolwasopen=1; <span class="comment">% if a matlabpool was open already we do not open nor close one</span>
0978       <span class="keyword">if</span> (matlabpool(<span class="string">'size'</span>) == 0), matlabpool open; poolwasopen=0; <span class="keyword">end</span>
0979       val = cell(nVoxels,1);
0980       <span class="keyword">for</span> ivox = 1:nVoxels        
0981         <span class="comment">% Predict the signal.</span>
0982         val{ivox} = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Mfiber'</span>,ivox)*w(ivox,:)';
0983       <span class="keyword">end</span>
0984       
0985       <span class="comment">% Handling parallel processing.</span>
0986       <span class="keyword">if</span> ~poolwasopen, matlabpool close; <span class="keyword">end</span>
0987       fprintf(<span class="string">'done in %2.3fminutes.\n'</span>,toc/60)
0988       
0989       <span class="comment">% Reorganize the signal into a vector</span>
0990       val = vertcat(val{:})';
0991       
0992       <span class="comment">% Now select a subset of voxels if requested</span>
0993       <span class="keyword">if</span> (length(varargin) == 2)
0994         <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0995         <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0996         <span class="comment">% val               = val(voxelRowsToKeep,:);</span>
0997         val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin{2})));
0998       <span class="keyword">end</span>
0999     <span class="keyword">else</span>
1000       error(<span class="string">'[%s] A set f fiber indiced must be passed in. pSig = feGet(fe,''pSig fiber test'',fiberIndices))'</span>,mfilename);
1001     <span class="keyword">end</span>
1002     
1003   <span class="keyword">case</span> {<span class="string">'predictedsignalfull'</span>,<span class="string">'psigfull'</span>}
1004     <span class="comment">% Predicted measured signal from both fiber and iso</span>
1005     <span class="comment">%</span>
1006     <span class="comment">% pSig = feGet(fe,'pSig full')</span>
1007     <span class="comment">% pSig = feGet(fe,'pSig full',coords)</span>
1008     <span class="comment">% pSig = feGet(fe,'pSig full',voxelIndices)</span>
1009     val = [<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'M fiber'</span>), <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'M iso'</span>)] * <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'full weights'</span>);
1010     <span class="keyword">if</span> ~isempty(varargin)
1011       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1012       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1013       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
1014       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1015     <span class="keyword">end</span>
1016     
1017   <span class="keyword">case</span> {<span class="string">'fullweights'</span>}
1018     <span class="comment">% The fiber and isotropic weights as a long vector</span>
1019     <span class="comment">%</span>
1020     <span class="comment">% w = feGet(fe,'fullweights')</span>
1021     val = [<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber weights'</span>); <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'iso weights'</span>)];
1022   
1023   <span class="keyword">case</span> {<span class="string">'fiberweightsvoxelwise'</span>}
1024     <span class="comment">% The woxels returned by a fit of LiFE by voxel/fiber</span>
1025     <span class="comment">%</span>
1026     <span class="comment">% w = feGet(fe,'fiberweightsvoxelwise')</span>
1027     val = fe.life.voxfit.weights;
1028     
1029   <span class="keyword">case</span> {<span class="string">'psigfvoxelwise'</span>}
1030     <span class="comment">% Predict the diffusion signal for the fiber component</span>
1031     <span class="comment">% with the voxel-wise fit of LiFE</span>
1032     <span class="comment">%</span>
1033     <span class="comment">% pSig = feGet(fe,'psigfvoxelwise')</span>
1034     <span class="comment">% pSig = feGet(fe,'psigfvoxelwise',coords)</span>
1035     <span class="comment">% pSig = feGet(fe,'psigfvoxelwise',voxelIndices)</span>
1036     
1037     <span class="keyword">if</span> ~isfield(fe.life,<span class="string">'voxfit'</span>), 
1038       error(<span class="string">'[%s] Cannot find voxel-wise fit.\nTo fit the model voxel-wise run:\nfe = feFitModelByVoxel(fe)\n'</span>,mfilename);
1039     <span class="keyword">end</span>
1040     val = fe.life.voxfit.psig;
1041  
1042     <span class="comment">% Get a subset of voxels.</span>
1043     <span class="keyword">if</span> ~isempty(varargin)
1044       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1045       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1046       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
1047       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1048     <span class="keyword">end</span>
1049     
1050   <span class="keyword">case</span> {<span class="string">'psigfvoxelwisebyvoxel'</span>}
1051     <span class="comment">% Predict the diffusion signal for the fiber component</span>
1052     <span class="comment">% with the voxel-wise fit of LiFE, return the an array of pSigXnVoxel</span>
1053     <span class="comment">%</span>
1054     <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel')</span>
1055     <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel',coords)</span>
1056     <span class="comment">% pSig = feGet(fe,'psigfvoxelwisebyvoxel',voxelIndices)</span>
1057     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1058     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1059     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfvoxelwise'</span>), nBvecs, nVoxels);
1060 
1061   <span class="keyword">case</span> {<span class="string">'totalr2'</span>}
1062     <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
1063     <span class="comment">% model.</span>
1064     <span class="comment">%</span>
1065     <span class="comment">% R2 = feGet(fe,'total r2');</span>
1066 
1067     <span class="comment">%     measured  = feGet(fe,'dsigdemeaned');</span>
1068     <span class="comment">%     predicted = feGet(fe,'fiber p sig');</span>
1069     <span class="comment">%     val = (1 - (sum((measured - predicted).^2 ) ./ ...</span>
1070     <span class="comment">%                 sum((measured - mean(measured)).^2) ));</span>
1071     val = (1 - (sum((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1072       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber predicted'</span>)).^2 ) ./ <span class="keyword">...</span>
1073       sum((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1074       mean(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>))).^2) ));
1075   
1076   <span class="keyword">case</span> {<span class="string">'totalr2voxelwise'</span>}
1077     <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
1078     <span class="comment">% model from a voxel-wise fit.</span>
1079     <span class="comment">%</span>
1080     <span class="comment">% R2 = feGet(fe,'total r2 vocel wise');</span>
1081 
1082     <span class="comment">%     measured  = feGet(fe,'dsigdemeaned');</span>
1083     <span class="comment">%     predicted = feGet(fe,'p sig f voxel wise');</span>
1084     <span class="comment">%     val = (1 - (sum((measured - predicted).^2 ) ./ ...</span>
1085     <span class="comment">%                 sum((measured - mean(measured)).^2) ));</span>
1086     val = (1 - (sum((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1087       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfvoxelwise'</span>)').^2 ) ./ <span class="keyword">...</span>
1088       sum((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1089       mean(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>))).^2) ));
1090    
1091   <span class="keyword">case</span> {<span class="string">'totpercentvarianceexplained'</span>,<span class="string">'totpve'</span>}
1092     <span class="comment">% Percent variance explained</span>
1093     <span class="comment">%</span>
1094     <span class="comment">% R2 = feGet(fe,'explained variance')</span>
1095     val = 100 * <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'total r2'</span>);
1096     
1097   <span class="keyword">case</span> {<span class="string">'totalrmse'</span>}
1098     <span class="comment">% Root mean squared error of the LiFE fit to the whole data</span>
1099     <span class="comment">%</span>
1100     <span class="comment">% rmse = feGet(fe,'rmse')</span>
1101     val = sqrt(mean((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1102       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber'</span>)).^2));
1103   
1104   <span class="keyword">case</span> {<span class="string">'totalrmsevoxelwise'</span>}
1105     <span class="comment">% Root mean squared error of the LiFE fit to the whole data from a</span>
1106     <span class="comment">% vocel-wise fit</span>
1107     <span class="comment">%</span>
1108     <span class="comment">% rmse = feGet(fe,'rmse')</span>
1109     val = sqrt(mean((<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
1110       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxelwise'</span>)').^2));
1111   
1112   <span class="keyword">case</span> {<span class="string">'ressigfiber'</span>}
1113     <span class="comment">% Residual signal fiber prediction - measured_demeaned.</span>
1114     <span class="comment">%</span>
1115     <span class="comment">% res = feGet(fe,'res sig fiber')</span>
1116     val = (<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned'</span>)    - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig fiber'</span>));
1117     <span class="keyword">if</span> ~isempty(varargin)
1118       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1119       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1120       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
1121       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1122     <span class="keyword">end</span>
1123     
1124   <span class="keyword">case</span> {<span class="string">'ressigfull'</span>}
1125     <span class="comment">% Residual signal full model prediction - measured signal.</span>
1126     <span class="comment">%</span>
1127     <span class="comment">% res = feGet(fe,'res sig full');</span>
1128     <span class="comment">% res = feGet(fe, 'res sig full',coords);</span>
1129     <span class="comment">% res = feGet(fe, 'res sig full',voxelIndex);</span>
1130     val = (<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsig full'</span>)    - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig full'</span>)');
1131     <span class="keyword">if</span> ~isempty(varargin)
1132       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1133       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1134       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
1135       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1136     <span class="keyword">end</span>
1137     
1138   <span class="keyword">case</span> {<span class="string">'ressigfullvoxelwise'</span>}
1139     <span class="comment">% Residual signal full model prediction from a multi-voxel fit.</span>
1140     <span class="comment">%</span>
1141     <span class="comment">% res = feGet(fe,'res sig full voxfit');</span>
1142     <span class="comment">% res = feGet(fe, 'res sig full voxfit',coords);</span>
1143     <span class="comment">% res = feGet(fe, 'res sig full voxfit',voxelIndex);</span>
1144     <span class="comment">%tic,val      = feGet(fe,'dsig demeaned') - feGet(fe,'psigfvoxelwise') + feGet(fe,'dsigiso');toc</span>
1145     val      = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsig full'</span>) - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfvoxelwise'</span>)';
1146     <span class="keyword">if</span> ~isempty(varargin)
1147       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1148       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1149       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
1150       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1151     <span class="keyword">end</span>
1152     
1153   <span class="keyword">case</span> {<span class="string">'fiberressigwithmean'</span>}
1154     <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
1155     <span class="comment">% with added mean signal. VECTOR FORM.</span>
1156     <span class="comment">%</span>
1157     <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
1158     <span class="comment">% refinement process.</span>
1159     <span class="comment">%</span>
1160     <span class="comment">% res = feGet(fe,'fiber res sig with mean');</span>
1161     
1162     <span class="comment">% predicted = feGet(fe,'psig fiber');</span>
1163     <span class="comment">% measured  = feGet(fe,'dsigdemeaned');</span>
1164     <span class="comment">% val = (measured_full - predicted demeaned);</span>
1165     val = (<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsig full'</span>)' - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig fiber'</span>)); 
1166     
1167     <span class="keyword">if</span> ~isempty(varargin)
1168       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1169       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1170       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
1171       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
1172     <span class="keyword">end</span>
1173     
1174   <span class="keyword">case</span> {<span class="string">'predictedfibersignalvoxel'</span>,<span class="string">'psigfvox'</span>}
1175     <span class="comment">% Predicted signal by the fiber model in a set of voxels.</span>
1176     <span class="comment">%</span>
1177     <span class="comment">% Vox subfield stores per voxel within the VOI</span>
1178     <span class="comment">% The pSig has size of the dwi.</span>
1179     <span class="comment">% It is stored as val = pSig(X,Y,Z,Theta)</span>
1180     <span class="comment">%</span>
1181     <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel');</span>
1182     <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel',coords);</span>
1183     <span class="comment">% pSig = feGet(fe, 'pSig fiber by voxel',voxelIndex);</span>
1184     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1185     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1186     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber'</span>), nBvecs, nVoxels);
1187     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1188     
1189   <span class="keyword">case</span> {<span class="string">'predictedfullsignalvoxel'</span>,<span class="string">'psigfullvox'</span>}
1190     <span class="comment">% Predicted signal by the full model in a set of voxeles.</span>
1191     <span class="comment">%</span>
1192     <span class="comment">% Vox subfield stores per voxel within the VOI</span>
1193     <span class="comment">% The pSig has size of the dwi.</span>
1194     <span class="comment">% It is stored as val = pSig(X,Y,Z,Theta)</span>
1195     <span class="comment">%</span>
1196     <span class="comment">% pSig = feGet(fe, 'pSig full by voxel');</span>
1197     <span class="comment">% pSig = feGet(fe, 'pSig full by voxel',coords);</span>
1198     <span class="comment">% pSig = feGet(fe, 'pSig full by voxel',voxelIndex);</span>
1199     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1200     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1201     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig full'</span>), nBvecs, nVoxels);
1202       
1203   <span class="keyword">case</span> {<span class="string">'voxelr2'</span>,<span class="string">'r2vox'</span>,<span class="string">'voxr2'</span>,<span class="string">'r2byvoxel'</span>}
1204     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
1205     <span class="comment">% each voxel.</span>
1206     <span class="comment">%</span>
1207     <span class="comment">% R2byVox = feGet(fe,'voxr2');</span>
1208     <span class="comment">% R2byVox = feGet(fe,'voxr2',coords);</span>
1209     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
1210     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
1211     nBvecs    = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1212     val       = (1 - (sum((measured - predicted).^2 ) ./ <span class="keyword">...</span>
1213       sum((measured - repmat(mean(measured), nBvecs,1)).^2 ) ));
1214     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1215   
1216   <span class="keyword">case</span> {<span class="string">'voxelr2zero'</span>,<span class="string">'r2voxzero'</span>,<span class="string">'voxr2zero'</span>,<span class="string">'r2byvoxelzero'</span>}
1217     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
1218     <span class="comment">% each voxel. (Normalized to the squared diffusion signal in each voxel)</span>
1219     <span class="comment">%</span>
1220     <span class="comment">% R2byVox = feGet(fe,'voxr2zero');</span>
1221     <span class="comment">% R2byVox = feGet(fe,'voxr2zero',coords);</span>
1222     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
1223     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
1224     val       = (1 - (sum((measured - predicted).^2 ) ./ sum(measured.^2)));
1225     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1226    
1227   <span class="keyword">case</span> {<span class="string">'voxelvarianceexplained'</span>,<span class="string">'varexpvox'</span>,<span class="string">'voxvarexp'</span>,<span class="string">'varexpbyvoxel'</span>}
1228     <span class="comment">% Return the percent of varince explained in each voxel.</span>
1229     <span class="comment">%</span>
1230     <span class="comment">% R2byVox = feGet(fe,'var exp by voxel');</span>
1231     <span class="comment">% R2byVox = feGet(fe,'var exp by voxel',coords);</span>
1232     val = 100.*<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxr2'</span>);
1233     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1234     
1235   <span class="keyword">case</span> {<span class="string">'voxelr2voxelwise'</span>,<span class="string">'r2voxvoxelwise'</span>,<span class="string">'voxr2voxelwise'</span>}
1236     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
1237     <span class="comment">% each voxel.</span>
1238     <span class="comment">%</span>
1239     <span class="comment">% R2byVox = feGet(fe,'voxr2voxelwise');</span>
1240     <span class="comment">% R2byVox = feGet(fe,'voxr2voxewise',coords);</span>
1241     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
1242     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig f voxel wise by voxel'</span>);
1243     nBvecs    = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1244     val       = (1 - (sum((measured - predicted).^2 ) ./ <span class="keyword">...</span>
1245       sum((measured - repmat(mean(measured), nBvecs,1)).^2 ) ));
1246     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1247   
1248   <span class="keyword">case</span> {<span class="string">'voxelr2zerovoxelwise'</span>,<span class="string">'voxr2zerovoxelwise'</span>}
1249     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
1250     <span class="comment">% each voxel. (Normalized to the squared diffusion signal in each voxel)</span>
1251     <span class="comment">%</span>
1252     <span class="comment">% R2byVox = feGet(fe,'voxr2zerovoxelwise');</span>
1253     <span class="comment">% R2byVox = feGet(fe,'voxr2zerovoxelwise',coords);</span>
1254     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
1255     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig f voxel wise by voxel'</span>);
1256     val       = (1 - (sum((measured - predicted).^2 ) ./ sum(measured.^2)));
1257     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1258    
1259   <span class="keyword">case</span> {<span class="string">'voxelvarianceexplainedvoxelwise'</span>,<span class="string">'varexpvoxvoxelwise'</span>}
1260     <span class="comment">% Return the percent of varince explained in each voxel.</span>
1261     <span class="comment">%</span>
1262     <span class="comment">% R2byVox = feGet(fe,'var exp by voxel');</span>
1263     <span class="comment">% R2byVox = feGet(fe,'var exp by voxel',coords);</span>
1264     val = 100.*<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxr2voxelwise'</span>);
1265     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1266     
1267   <span class="keyword">case</span> {<span class="string">'dsigdemeanedbyvoxel'</span>,<span class="string">'dsigdemeanedvox'</span>}
1268     <span class="comment">% Demeaned diffusion signal in each voxel</span>
1269     <span class="comment">%</span>
1270     <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel');</span>
1271     <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',coords);</span>
1272     <span class="comment">% dSigByVoxel = feGet(fe,'dsigdemeaned by Voxel',vxIndex);</span>
1273     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1274     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1275     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned'</span>), nBvecs, nVoxels);
1276     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1277     
1278   <span class="keyword">case</span> {<span class="string">'dsigfullbyvoxel'</span>,<span class="string">'dsigfullvox'</span>,<span class="string">'voxdsigfull'</span>}
1279     <span class="comment">% Full (measured) signal in each voxel</span>
1280     <span class="comment">%</span>
1281     <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel');</span>
1282     <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel',coords);</span>
1283     <span class="comment">% dSigByVoxel = feGet(fe,'dSig full by Voxel',vxIndex);</span>
1284     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1285     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1286     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig full'</span>), nBvecs, nVoxels);
1287     val    = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
1288     
1289   <span class="keyword">case</span> {<span class="string">'voxelrmse'</span>,<span class="string">'voxrmse'</span>}
1290     <span class="comment">% A volume of RMSE values</span>
1291     <span class="comment">%</span>
1292     <span class="comment">% RMSE = feGet(fe,'vox rmse')</span>
1293     <span class="comment">% RMSE = feGet(fe,'vox rmse',coords)</span>
1294     <span class="comment">% RMSE = feGet(fe,'vox rmse',vxIndex)</span>
1295     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
1296     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
1297     val       = sqrt(mean((measured - predicted).^2,1));
1298     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1299    
1300   <span class="keyword">case</span> {<span class="string">'voxelrmsevoxelwise'</span>,<span class="string">'voxrmsevoxelwise'</span>}
1301     <span class="comment">% A volume of RMSE values optained with the voxel-wise (voxelwise) fit.</span>
1302     <span class="comment">%</span>
1303     <span class="comment">% RMSE = feGet(fe,'vox rmse voxelwise')</span>
1304     <span class="comment">% RMSE = feGet(fe,'vox rmse voxelwise',coords)</span>
1305     <span class="comment">% RMSE = feGet(fe,'vox rmse voxelwise',vxIndex)</span>
1306     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
1307     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxel wise by voxel'</span>);
1308    
1309     val       = sqrt(mean((measured - predicted).^2,1));
1310     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1311 
1312   <span class="keyword">case</span> {<span class="string">'voxelrmsetest'</span>,<span class="string">'voxrmsetest'</span>}
1313     <span class="comment">% A volume of RMSE values with a subset of fibers' weights set to 0.</span>
1314     <span class="comment">%</span>
1315     <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices)</span>
1316     <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices,coords)</span>
1317     <span class="comment">% RMSE = feGet(fe,'vox rmse',fiberIndices,voxelIndex)</span>
1318     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
1319     <span class="comment">% Reshape the predicted signal by voxles</span>
1320     predicted = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber test'</span>,varargin{1}), <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>), <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>));   
1321     val       = sqrt(mean((measured - predicted).^2,1));
1322     
1323     <span class="keyword">if</span> length(varargin) == 2
1324       val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1325     <span class="keyword">end</span>
1326     
1327   <span class="keyword">case</span> {<span class="string">'residualsignalfibervoxel'</span>,<span class="string">'resfibervox'</span>}
1328     <span class="comment">% Fibers' residual signal by voxel</span>
1329     <span class="comment">%</span>
1330     <span class="comment">% res = feGet(fe,'res sig fiber vox')</span>
1331     <span class="comment">% res = feGet(fe,'res sig fiber vox',coords)</span>
1332     <span class="comment">% res = feGet(fe,'res sig fiber vox',vxIndex)</span>
1333     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1334     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1335     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'res sig fiber'</span>), nBvecs, nVoxels);
1336     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
1337     
1338   <span class="keyword">case</span> {<span class="string">'residualsignalfullvoxel'</span>,<span class="string">'resfullvox'</span>}
1339     <span class="comment">% Full (measured) residual signal by voxel</span>
1340     <span class="comment">%</span>
1341     <span class="comment">% res = feGet(fe,'res sig full vox')</span>
1342     <span class="comment">% res = feGet(fe,'res sig full vox',coords)</span>
1343     <span class="comment">% res = feGet(fe,'res sig full vox',vxIndex)</span>
1344     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1345     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1346     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'res sig full'</span>), nBvecs, nVoxels);
1347     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
1348       
1349   <span class="keyword">case</span> {<span class="string">'fiberressigwithmeanvoxel'</span>}
1350     <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
1351     <span class="comment">% with added mean signal. VOXEL FORM (nBvecs x nVoxel).</span>
1352     <span class="comment">%</span>
1353     <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
1354     <span class="comment">% refinement process.</span>
1355     <span class="comment">%</span>
1356     <span class="comment">% res = feGet(fe,'fiber res sig with mean');</span>
1357     
1358     <span class="comment">% predicted = feGet(fe,'psig fiber');</span>
1359     <span class="comment">% measured  = feGet(fe,'dsigdemeaned');</span>
1360     <span class="comment">% val = (measured     - predicted) + (measured_full - measured);</span>
1361     val     = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiberressigwithmean'</span>);
1362     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1363     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1364     val     = reshape(val, nBvecs, nVoxels);
1365     
1366     <span class="keyword">if</span> ~isempty(varargin)
1367       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
1368       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
1369       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
1370       val = val(:, <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
1371     <span class="keyword">end</span>
1372     
1373   <span class="keyword">case</span> {<span class="string">'fiberressigwithmeanvox'</span>,<span class="string">'resfibermeanvox'</span>}
1374     <span class="comment">% Fibers' residual signal by voxel with mean signal added (with added</span>
1375     <span class="comment">% isotropic component).</span>
1376     <span class="comment">%</span>
1377     <span class="comment">% This is used to compute the residual signal for the refinement.</span>
1378     <span class="comment">%</span>
1379     <span class="comment">% res = feGet(fe,'fiber res sig with mean vox')</span>
1380     <span class="comment">% res = feGet(fe,'fiber res sig with mean vox',coords)</span>
1381     <span class="comment">% res = feGet(fe,'fiber res sig with mean vox',vxIndex)</span>
1382     nBvecs  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nBvecs'</span>);
1383     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
1384     val     = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'fiber res sig with mean'</span>), nBvecs, nVoxels);
1385     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
1386     
1387   <span class="keyword">case</span> {<span class="string">'voxelsindices'</span>,<span class="string">'returnvoxelindices'</span>,<span class="string">'voxelindexes''returnvoxelindexes'</span>}
1388     <span class="comment">% Given an VOI or a set of indices to voxels returns the indices of the matching voxels inside the big</span>
1389     <span class="comment">% volume, which ordinarily represents the full connectome.</span>
1390     <span class="comment">%</span>
1391     <span class="comment">% voxelIndices = feGet(fe,'voxelsindices',coords)</span>
1392     <span class="comment">% voxelIndices = feGet(fe,'voxelsindices',voxelIndices)</span>
1393     <span class="comment">%</span>
1394     <span class="comment">% coords is a Nx3 set of coordinates in image space</span>
1395     <span class="comment">% voxelIndices is a vector of 1's and 0's, there is a one for each</span>
1396     <span class="comment">% location the the connectome coordinates for which there is a match in</span>
1397     <span class="comment">% the coords</span>
1398     <span class="comment">%</span>
1399     varargin = varargin{1};
1400     <span class="keyword">if</span> ( ~isempty(varargin) )
1401       <span class="keyword">if</span> ( size(varargin{1},2) == 3 )
1402         <span class="comment">% If a set of coordinates were passed in we return the indices.</span>
1403         val = logical(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'find voxels'</span>,varargin{1}));
1404       <span class="keyword">else</span>
1405         <span class="comment">% If indices were passed in, we sort and return them.</span>
1406         val = sort(varargin{1});
1407       <span class="keyword">end</span>
1408     <span class="keyword">else</span>
1409       <span class="comment">% If no coordinates were passed at all, we return all the indices.</span>
1410       val = true(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>),1);
1411     <span class="keyword">end</span>
1412     
1413   <span class="keyword">case</span> {<span class="string">'findvoxels'</span>,<span class="string">'findvoxelindexes'</span>,<span class="string">'findvoxelsinconnectome'</span>,<span class="string">'findvoxelsinconnectomeroi'</span>, <span class="keyword">...</span>
1414       <span class="string">'voxel2index'</span>,<span class="string">'coords2index'</span>}
1415     <span class="comment">% Given an VOI finds the indices of the matching voxels inside the big</span>
1416     <span class="comment">% volume, which ordinarily represents the full connectome.</span>
1417     <span class="comment">%</span>
1418     <span class="comment">% foundVoxels = feGet(fe,'find voxels',coords)</span>
1419     <span class="comment">%</span>
1420     <span class="comment">% coords is a Nx3 set of coordinates in image space</span>
1421     <span class="comment">% foundVoxels is a vector of 1's and 0's, there is a one for each</span>
1422     <span class="comment">% location the the connectome coordinates for which there is a match in</span>
1423     <span class="comment">% the coords</span>
1424     
1425     <span class="comment">% Compute the values for a subset of voxels</span>
1426     <span class="keyword">if</span> isempty(varargin)
1427       <span class="comment">% If no coordinates were passed at all, we return all the indices.</span>
1428       val = ones(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>),1);
1429     <span class="keyword">else</span>
1430       <span class="comment">% The stored coordinates are at a resolution of the image, typically</span>
1431       <span class="comment">% 2mm isotropic.  The VOI should also be in image resolution.</span>
1432       <span class="comment">% ---- Franco:</span>
1433       <span class="comment">% This is how I had it. I think it is worng:</span>
1434       <span class="comment">% val = ismember(feGet(fe,'roi coords'), varargin{1}, 'rows'); % This is slow</span>
1435       <span class="comment">% This is hwo I think it should be:</span>
1436       [~,val] = ismember(varargin{1}, <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'roi coords'</span>),<span class="string">'rows'</span>); <span class="comment">% This is slow</span>
1437     <span class="keyword">end</span>
1438     
1439   <span class="keyword">case</span> {<span class="string">'voxelcoords2voxelrows'</span>,<span class="string">'coords2rows'</span>}
1440     <span class="comment">% Given a set of VOI coords finds the row numbers of the Model matrix</span>
1441     <span class="comment">% (or equivalently the dSig vector) that represent the data for this</span>
1442     <span class="comment">% set of VOI coords.</span>
1443     <span class="comment">%</span>
1444     <span class="comment">% foundVoxels = feGet(fe,'coords 2 rows',coords)</span>
1445     <span class="comment">%</span>
1446     <span class="comment">% coords      - a Nx3 set of coordinates in image space</span>
1447     <span class="comment">% foundVoxels - a binary vector that is 1 for each Model matrix row</span>
1448     <span class="comment">%               that corresponds to at least one of the coords.</span>
1449     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,find(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'find voxels'</span>,varargin{1})));
1450     
1451     <span class="comment">% ------ Spatial coordinate transforms for voxels and fg to coordinate frames</span>
1452   <span class="keyword">case</span> {<span class="string">'xformimg2acpc'</span>,<span class="string">'xform2acpc'</span>,<span class="string">'img2acpc'</span>,<span class="string">'img2acpcxform'</span>}
1453     <span class="comment">% Quaternian transformation from IMAGE space to ACPC space.</span>
1454     <span class="comment">%</span>
1455     <span class="comment">% xform = feGet(fe,'xform')</span>
1456     val = fe.life.xform.img2acpc;
1457   <span class="keyword">case</span> {<span class="string">'xformacpc2img'</span>,<span class="string">'xform2img'</span>,<span class="string">'acpc2img'</span>,<span class="string">'acpc2imgxform'</span>}
1458     <span class="comment">% Quaternian transformation from ACPC space to IMAGE space.</span>
1459     <span class="comment">%</span>
1460     <span class="comment">% xform = feGet(fe,'xform')</span>
1461     val = fe.life.xform.acpc2img;
1462   <span class="keyword">case</span> {<span class="string">'volumesize'</span>,<span class="string">'dims'</span>,<span class="string">'dim'</span>,<span class="string">'imagedim'</span>}
1463     <span class="comment">% Dimensions of the DW volume.</span>
1464     <span class="comment">%</span>
1465     <span class="comment">% dim = feGet(fe,'dims')</span>
1466     val = fe.life.imagedim;
1467   <span class="keyword">case</span> {<span class="string">'mapsize'</span>}
1468     <span class="comment">% Dimensions of the maps of parameters and results.</span>
1469     <span class="comment">%</span>
1470     <span class="comment">% dims = feGet(fe, 'mapsize')</span>
1471     val = fe.life.imagedim(1:3);
1472     
1473   <span class="keyword">case</span> {<span class="string">'anatomyfile'</span>}
1474     <span class="comment">% Path to the 3D Anatomy Volume.</span>
1475     <span class="comment">% anatomyfile = feGet(fe, 'anatomy file')</span>
1476     val = fe.path.anatomy;
1477   <span class="keyword">case</span> <span class="string">'dtfile'</span>
1478     <span class="comment">% Diffusion weighted file used for testing results</span>
1479     <span class="comment">% dtfile = feGet(fe,'dtfile')</span>
1480      val = fe.path.dtfile;  
1481 
1482   <span class="keyword">otherwise</span>
1483     help(<span class="string">'feGet'</span>)
1484     fprintf(<span class="string">'[feGet] Unknown parameter &lt;&lt; %s &gt;&gt;...\n'</span>,param);
1485     <span class="keyword">return</span>
1486 <span class="keyword">end</span>
1487 
1488 <span class="keyword">end</span> <span class="comment">% END MAIN FUNCTION</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 11:25:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>