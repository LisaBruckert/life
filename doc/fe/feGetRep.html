<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of feGetRep</title>
  <meta name="keywords" content="feGetRep">
  <meta name="description" content="Get function for fascicle evaluation structure, to use for a repeated">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">fe</a> &gt; feGetRep.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for fe&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>feGetRep
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Get function for fascicle evaluation structure, to use for a repeated</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function val = feGetRep(fe,param,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Get function for fascicle evaluation structure, to use for a repeated
 measure calculation. 

 This function is similar to feGet but uses the repeted dataset to compute
 the DWI signal and all the calculations that depend on the DWI signal
 will be different.

 Importantly, this function will use calls to feGet every time we compute
 values that depend on the LiFE model or fit.

 This function allows for computing measures of:
 (1) data reliability and 
 (2) model versus data reliability

   val = feGetRep(fe,param,varargin)

 INPUTS: 
  Coords    - Nx3 set of coordinates in image space
  voxelIndices - Vector of 1's and 0's, there is a one for each
              location the the connectome coordinates for which there is
              a match in the coords


 Franco (c) Stanford Vista Team 2012

---------- List of arguments ----
 Name of the current fe structure.
 name = feGetRep(fe,'name')
----------
 The type of objes (always, fascicle evaluation)
 type = feGetRep(fe,'type')
----------
 Load the repeated-measure diffusion weighted data.
 dwi = feGetRep(fe,'dwirepeat') 
----------
 Load the repeated measure of the diffusion weighted data.
 dwiFile = feGetRep(fe,'dwirepeatfile')
----------
 Directory where the LiFe structes are saved by defualt.
 sdir = feGetRep(fe,'savedir');
----------
 Diffusion directions.
 val = feGetRep(fe,'bvecs');
----------
 Indices to the diffusion directions in the DWi 4th Dimension.
 val = feGetRep(fe,'bvecs indices');
----------
 Number of B0's
 val = feGetRep(fe,'n bvals');
----------
 B0 Values.
 bval = feGetRep(fe,'bvals')
----------
 Returns a nVoxels X nBvecs array of measured diffusion signal
 val = feGetRep(fe,'dsiinvox');
 val = feGetRep(fe,'dsiinvox',voxelsIndices);
 val = feGetRep(fe,'dsiinvox',coords);
----------
 Returns a nVoxels X nBvecs array of demeaned diffusion signal
 val =feGetRep(fe,'dsiinvoxdemeaned');
 val =feGetRep(fe,'dsiinvoxdemeaned',voxelsIndices);
 val =feGetRep(fe,'dsiinvoxdemeaned',coords);
----------
 Get the diffusion signal at 0 diffusion weighting (B0) for this voxel
 val = feGetRep(fe,'b0signalimage');
 val = feGetRep(fe,'b0signalimage',voxelIndex);
 val = feGetRep(fe,'b0signalimage',coords);
----------
 Weights of the isotropic voxel signals, this is the mean signal in
 each voxel.
 val = feGetRep(fe,'iso weights');
 val = feGetRep(fe,'iso weights'coords)
 val = feGetRep(fe,'iso weights',voxelIndices)
----------
 Measured signal in VOI, this is the raw signal. not demeaned

 dSig = feGetRep(fe,'dSig full')
---------
 Measured signal in VOI, demeaned, this is the signal used for the
 fiber-portion of the M model.

 dSig = feGetRep(fe,'dsigdemeaned');
 dSig = feGetRep(fe,'dsigdemeaned',[1 10 100]);
 dSig = feGetRep(fe,'dsigdemeaned',coords);
---------
 Get the demeaned signal for a subset of rows.
 Useful for cross-validation.
 dSig = feGetRep(fe,'dsigrowssubset',voxelsList);
---------
 Return the global R2 (fraction of variance explained) of the full life
 model.
 R2 = feGetRep(fe,'total r2');
---------
 Percent variance explained
 R2 = feGetRep(fe,'explained variance')
---------
 Root mean squared error of the LiFE fit to the whole data
 rmse = feGetRep(fe,'rmse')
---------
 Residual signal: (fiber prediction - measured_demeaned).
 res = feGetRep(fe,'res sig fiber')
---------
 Residual signal: (full model prediction - measured signal).
 res = feGetRep(fe,'res sig full');
---------
 Residual signal: (fiber model prediction - demeaned measured signal)
 with added mean signal. Res is returned as a vector.
 This is used to reconstruct an image (volume) to be used for the
 refinement process.
 res = feGetRep(fe,'fiber res sig with mean');
 res = feGetRep(fe,'fiber res sig with mean',coords);
 res = feGetRep(fe,'fiber res sig with mean',voxelIndices);
---------
 Residual signal fiber model prediction - demeaned measured signal
 with added mean signal. Res is returned as an array (nBvecs x nVoxel).
 This is used to reconstruct an image (volume) to be used for the
 refinement process.
 res = feGetRep(fe,'fiber res sig with mean voxel');
 res = feGetRep(fe,'fiber res sig with mean voxel',coords);
 res = feGetRep(fe,'fiber res sig with mean voxel',voxelIndices);
---------
 Return a column vector of the proportion of variance explained in
 each voxel.
 R2byVox = feGetRep(fe,'voxr2');
 R2byVox = feGetRep(fe,'voxr2',coords);
---------
 Return a column vector of the proportion of variance explained in
 each voxel. (Normalized to the squared mean diffusion signal in each voxel)
 R2byVox = feGetRep(fe,'voxr2zero');
 R2byVox = feGetRep(fe,'voxr2zero',coords);
---------
 Return the percent of varince explained in each voxel.
 R2byVox = feGetRep(fe,'var exp by voxel');
 R2byVox = feGetRep(fe,'var exp by voxel',coords);
---------
 Demeaned diffusion signal in each voxel.
 dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel');
 dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',coords);
 dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',vxIndex);
---------
 Full (measured) signal in each voxel.
 dSigByVoxel = feGetRep(fe,'dSig full by Voxel');
 dSigByVoxel = feGetRep(fe,'dSig full by Voxel',coords);
 dSigByVoxel = feGetRep(fe,'dSig full by Voxel',vxIndex);
---------
 Predicted signal by the full model in a set of voxeles.
 pSigByVoxel = feGetRep(fe, 'pSig full by voxel');
 pSigByVoxel = feGetRep(fe, 'pSig full by voxel',coords);
 pSigByVoxel = feGetRep(fe, 'pSig full by voxel',voxelIndex);
---------
 A volume of RMSE values.
 RMSE = feGetRep(fe,'vox rmse')
 RMSE = feGetRep(fe,'vox rmse',coords)
 RMSE = feGetRep(fe,'vox rmse',vxIndex)
---------
 A volume of RMSE values with a subset of fibers' weights set to 0.
 RMSE = feGetRep(fe,'vox rmse',fiberIndices)
 RMSE = feGetRep(fe,'vox rmse',fiberIndices,coords)
 RMSE = feGetRep(fe,'vox rmse',fiberIndices,voxelIndex)
---------
 Fibers' residual signal by voxel.
 res = feGetRep(fe,'res sig fiber vox')
 res = feGetRep(fe,'res sig fiber vox',coords)
 res = feGetRep(fe,'res sig fiber vox',vxIndex)
---------
 Full (measured) residual signal by voxel.
 res = feGetRep(fe,'res sig full vox')
 res = feGetRep(fe,'res sig full vox',coords)
 res = feGetRep(fe,'res sig full vox',vxIndex)
---------
 Fibers' residual signal by voxel with mean signal added (with added
 isotropic component).
 This is used to compute the residual signal for the refinement.
 res = feGetRep(fe,'fiber res sig with mean vox')
 res = feGetRep(fe,'fiber res sig with mean vox',coords)
 res = feGetRep(fe,'fiber res sig with mean vox',vxIndex)
---------
 Residual signal full model prediction from a multi-voxel fit.
 res = feGetRep(fe,'res sig full voxfit');
 res = feGetRep(fe, 'res sig full voxfit',coords);
 res = feGetRep(fe, 'res sig full voxfit',voxelIndex);
---------
 Dimensions of the DW volume.
 dim = feGetRep(fe,'dims')
---------
 Dimensions of the maps of parameters and results.
 dims = feGetRep(fe, 'mapsize')

 End of feGetRep.m parameters, 
 
 Franco Pestilli (c) Stanford Vista Team 2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>	Get function for fascicle evaluation structure</li><li><a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>	Get function for fascicle evaluation structure, to use for a repeated</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>	Get function for fascicle evaluation structure</li><li><a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>	Get function for fascicle evaluation structure, to use for a repeated</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function val = feGetRep(fe,param,varargin)</a>
0002 <span class="comment">% Get function for fascicle evaluation structure, to use for a repeated</span>
0003 <span class="comment">% measure calculation.</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% This function is similar to feGet but uses the repeted dataset to compute</span>
0006 <span class="comment">% the DWI signal and all the calculations that depend on the DWI signal</span>
0007 <span class="comment">% will be different.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Importantly, this function will use calls to feGet every time we compute</span>
0010 <span class="comment">% values that depend on the LiFE model or fit.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% This function allows for computing measures of:</span>
0013 <span class="comment">% (1) data reliability and</span>
0014 <span class="comment">% (2) model versus data reliability</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%   val = feGetRep(fe,param,varargin)</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% INPUTS:</span>
0019 <span class="comment">%  Coords    - Nx3 set of coordinates in image space</span>
0020 <span class="comment">%  voxelIndices - Vector of 1's and 0's, there is a one for each</span>
0021 <span class="comment">%              location the the connectome coordinates for which there is</span>
0022 <span class="comment">%              a match in the coords</span>
0023 <span class="comment">%</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% Franco (c) Stanford Vista Team 2012</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%---------- List of arguments ----</span>
0028 <span class="comment">% Name of the current fe structure.</span>
0029 <span class="comment">% name = feGetRep(fe,'name')</span>
0030 <span class="comment">%----------</span>
0031 <span class="comment">% The type of objes (always, fascicle evaluation)</span>
0032 <span class="comment">% type = feGetRep(fe,'type')</span>
0033 <span class="comment">%----------</span>
0034 <span class="comment">% Load the repeated-measure diffusion weighted data.</span>
0035 <span class="comment">% dwi = feGetRep(fe,'dwirepeat')</span>
0036 <span class="comment">%----------</span>
0037 <span class="comment">% Load the repeated measure of the diffusion weighted data.</span>
0038 <span class="comment">% dwiFile = feGetRep(fe,'dwirepeatfile')</span>
0039 <span class="comment">%----------</span>
0040 <span class="comment">% Directory where the LiFe structes are saved by defualt.</span>
0041 <span class="comment">% sdir = feGetRep(fe,'savedir');</span>
0042 <span class="comment">%----------</span>
0043 <span class="comment">% Diffusion directions.</span>
0044 <span class="comment">% val = feGetRep(fe,'bvecs');</span>
0045 <span class="comment">%----------</span>
0046 <span class="comment">% Indices to the diffusion directions in the DWi 4th Dimension.</span>
0047 <span class="comment">% val = feGetRep(fe,'bvecs indices');</span>
0048 <span class="comment">%----------</span>
0049 <span class="comment">% Number of B0's</span>
0050 <span class="comment">% val = feGetRep(fe,'n bvals');</span>
0051 <span class="comment">%----------</span>
0052 <span class="comment">% B0 Values.</span>
0053 <span class="comment">% bval = feGetRep(fe,'bvals')</span>
0054 <span class="comment">%----------</span>
0055 <span class="comment">% Returns a nVoxels X nBvecs array of measured diffusion signal</span>
0056 <span class="comment">% val = feGetRep(fe,'dsiinvox');</span>
0057 <span class="comment">% val = feGetRep(fe,'dsiinvox',voxelsIndices);</span>
0058 <span class="comment">% val = feGetRep(fe,'dsiinvox',coords);</span>
0059 <span class="comment">%----------</span>
0060 <span class="comment">% Returns a nVoxels X nBvecs array of demeaned diffusion signal</span>
0061 <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned');</span>
0062 <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned',voxelsIndices);</span>
0063 <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned',coords);</span>
0064 <span class="comment">%----------</span>
0065 <span class="comment">% Get the diffusion signal at 0 diffusion weighting (B0) for this voxel</span>
0066 <span class="comment">% val = feGetRep(fe,'b0signalimage');</span>
0067 <span class="comment">% val = feGetRep(fe,'b0signalimage',voxelIndex);</span>
0068 <span class="comment">% val = feGetRep(fe,'b0signalimage',coords);</span>
0069 <span class="comment">%----------</span>
0070 <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0071 <span class="comment">% each voxel.</span>
0072 <span class="comment">% val = feGetRep(fe,'iso weights');</span>
0073 <span class="comment">% val = feGetRep(fe,'iso weights'coords)</span>
0074 <span class="comment">% val = feGetRep(fe,'iso weights',voxelIndices)</span>
0075 <span class="comment">%----------</span>
0076 <span class="comment">% Measured signal in VOI, this is the raw signal. not demeaned</span>
0077 <span class="comment">%</span>
0078 <span class="comment">% dSig = feGetRep(fe,'dSig full')</span>
0079 <span class="comment">%---------</span>
0080 <span class="comment">% Measured signal in VOI, demeaned, this is the signal used for the</span>
0081 <span class="comment">% fiber-portion of the M model.</span>
0082 <span class="comment">%</span>
0083 <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned');</span>
0084 <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned',[1 10 100]);</span>
0085 <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned',coords);</span>
0086 <span class="comment">%---------</span>
0087 <span class="comment">% Get the demeaned signal for a subset of rows.</span>
0088 <span class="comment">% Useful for cross-validation.</span>
0089 <span class="comment">% dSig = feGetRep(fe,'dsigrowssubset',voxelsList);</span>
0090 <span class="comment">%---------</span>
0091 <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
0092 <span class="comment">% model.</span>
0093 <span class="comment">% R2 = feGetRep(fe,'total r2');</span>
0094 <span class="comment">%---------</span>
0095 <span class="comment">% Percent variance explained</span>
0096 <span class="comment">% R2 = feGetRep(fe,'explained variance')</span>
0097 <span class="comment">%---------</span>
0098 <span class="comment">% Root mean squared error of the LiFE fit to the whole data</span>
0099 <span class="comment">% rmse = feGetRep(fe,'rmse')</span>
0100 <span class="comment">%---------</span>
0101 <span class="comment">% Residual signal: (fiber prediction - measured_demeaned).</span>
0102 <span class="comment">% res = feGetRep(fe,'res sig fiber')</span>
0103 <span class="comment">%---------</span>
0104 <span class="comment">% Residual signal: (full model prediction - measured signal).</span>
0105 <span class="comment">% res = feGetRep(fe,'res sig full');</span>
0106 <span class="comment">%---------</span>
0107 <span class="comment">% Residual signal: (fiber model prediction - demeaned measured signal)</span>
0108 <span class="comment">% with added mean signal. Res is returned as a vector.</span>
0109 <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0110 <span class="comment">% refinement process.</span>
0111 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean');</span>
0112 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean',coords);</span>
0113 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean',voxelIndices);</span>
0114 <span class="comment">%---------</span>
0115 <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
0116 <span class="comment">% with added mean signal. Res is returned as an array (nBvecs x nVoxel).</span>
0117 <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0118 <span class="comment">% refinement process.</span>
0119 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean voxel');</span>
0120 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean voxel',coords);</span>
0121 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean voxel',voxelIndices);</span>
0122 <span class="comment">%---------</span>
0123 <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0124 <span class="comment">% each voxel.</span>
0125 <span class="comment">% R2byVox = feGetRep(fe,'voxr2');</span>
0126 <span class="comment">% R2byVox = feGetRep(fe,'voxr2',coords);</span>
0127 <span class="comment">%---------</span>
0128 <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0129 <span class="comment">% each voxel. (Normalized to the squared mean diffusion signal in each voxel)</span>
0130 <span class="comment">% R2byVox = feGetRep(fe,'voxr2zero');</span>
0131 <span class="comment">% R2byVox = feGetRep(fe,'voxr2zero',coords);</span>
0132 <span class="comment">%---------</span>
0133 <span class="comment">% Return the percent of varince explained in each voxel.</span>
0134 <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel');</span>
0135 <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel',coords);</span>
0136 <span class="comment">%---------</span>
0137 <span class="comment">% Demeaned diffusion signal in each voxel.</span>
0138 <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel');</span>
0139 <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',coords);</span>
0140 <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',vxIndex);</span>
0141 <span class="comment">%---------</span>
0142 <span class="comment">% Full (measured) signal in each voxel.</span>
0143 <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel');</span>
0144 <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel',coords);</span>
0145 <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel',vxIndex);</span>
0146 <span class="comment">%---------</span>
0147 <span class="comment">% Predicted signal by the full model in a set of voxeles.</span>
0148 <span class="comment">% pSigByVoxel = feGetRep(fe, 'pSig full by voxel');</span>
0149 <span class="comment">% pSigByVoxel = feGetRep(fe, 'pSig full by voxel',coords);</span>
0150 <span class="comment">% pSigByVoxel = feGetRep(fe, 'pSig full by voxel',voxelIndex);</span>
0151 <span class="comment">%---------</span>
0152 <span class="comment">% A volume of RMSE values.</span>
0153 <span class="comment">% RMSE = feGetRep(fe,'vox rmse')</span>
0154 <span class="comment">% RMSE = feGetRep(fe,'vox rmse',coords)</span>
0155 <span class="comment">% RMSE = feGetRep(fe,'vox rmse',vxIndex)</span>
0156 <span class="comment">%---------</span>
0157 <span class="comment">% A volume of RMSE values with a subset of fibers' weights set to 0.</span>
0158 <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices)</span>
0159 <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices,coords)</span>
0160 <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices,voxelIndex)</span>
0161 <span class="comment">%---------</span>
0162 <span class="comment">% Fibers' residual signal by voxel.</span>
0163 <span class="comment">% res = feGetRep(fe,'res sig fiber vox')</span>
0164 <span class="comment">% res = feGetRep(fe,'res sig fiber vox',coords)</span>
0165 <span class="comment">% res = feGetRep(fe,'res sig fiber vox',vxIndex)</span>
0166 <span class="comment">%---------</span>
0167 <span class="comment">% Full (measured) residual signal by voxel.</span>
0168 <span class="comment">% res = feGetRep(fe,'res sig full vox')</span>
0169 <span class="comment">% res = feGetRep(fe,'res sig full vox',coords)</span>
0170 <span class="comment">% res = feGetRep(fe,'res sig full vox',vxIndex)</span>
0171 <span class="comment">%---------</span>
0172 <span class="comment">% Fibers' residual signal by voxel with mean signal added (with added</span>
0173 <span class="comment">% isotropic component).</span>
0174 <span class="comment">% This is used to compute the residual signal for the refinement.</span>
0175 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox')</span>
0176 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox',coords)</span>
0177 <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox',vxIndex)</span>
0178 <span class="comment">%---------</span>
0179 <span class="comment">% Residual signal full model prediction from a multi-voxel fit.</span>
0180 <span class="comment">% res = feGetRep(fe,'res sig full voxfit');</span>
0181 <span class="comment">% res = feGetRep(fe, 'res sig full voxfit',coords);</span>
0182 <span class="comment">% res = feGetRep(fe, 'res sig full voxfit',voxelIndex);</span>
0183 <span class="comment">%---------</span>
0184 <span class="comment">% Dimensions of the DW volume.</span>
0185 <span class="comment">% dim = feGetRep(fe,'dims')</span>
0186 <span class="comment">%---------</span>
0187 <span class="comment">% Dimensions of the maps of parameters and results.</span>
0188 <span class="comment">% dims = feGetRep(fe, 'mapsize')</span>
0189 <span class="comment">%</span>
0190 <span class="comment">% End of feGetRep.m parameters,</span>
0191 <span class="comment">%</span>
0192 <span class="comment">% Franco Pestilli (c) Stanford Vista Team 2012</span>
0193    
0194 val = [];
0195 
0196 <span class="comment">% Format the input parameters.</span>
0197 param = lower(strrep(param,<span class="string">' '</span>,<span class="string">''</span>));
0198 
0199 <span class="comment">% Start sorting the input and computing the output.</span>
0200 <span class="keyword">switch</span> param
0201   <span class="keyword">case</span> <span class="string">'name'</span>
0202     <span class="comment">% Name of the current fe structure.</span>
0203     <span class="comment">%</span>
0204     <span class="comment">% name = feGetRep(fe,'name')</span>
0205     val = fe.rep.name;
0206     
0207   <span class="keyword">case</span> <span class="string">'type'</span>
0208     <span class="comment">% The type of objes (always, fascicle evaluation)</span>
0209     <span class="comment">%</span>
0210     <span class="comment">% type = feGetRep(fe,'type')</span>
0211     val = fe.rep.type; <span class="comment">% Always fascicle evaluation</span>
0212       
0213   <span class="keyword">case</span> <span class="string">'dwi'</span>
0214     <span class="comment">%  Load the diffusion weighted data.</span>
0215     <span class="comment">%</span>
0216     <span class="comment">% dwi = feGetRep(fe,'dwirepeat')</span>
0217     val = dwiLoad(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dwifile'</span>));
0218         
0219   <span class="keyword">case</span> <span class="string">'dwifile'</span>
0220     <span class="comment">%  Load the repeated measure of the diffusion weighted data.</span>
0221     <span class="comment">%</span>
0222     <span class="comment">% dwiFile = feGetRep(fe,'dwirepeatfile')</span>
0223     val = fe.path.dwifilerep;
0224     
0225   <span class="keyword">case</span> {<span class="string">'bvecs'</span>}
0226     <span class="comment">% Diffusion directions.</span>
0227     <span class="comment">%</span>
0228     <span class="comment">% val = feGetRep(fe,'bvecs');</span>
0229     val = fe.rep.bvecs;
0230     
0231   <span class="keyword">case</span> {<span class="string">'bvecsindices'</span>}
0232     <span class="comment">% Indices to the diffusion directions in the DWi 4th Dimension.</span>
0233     <span class="comment">%</span>
0234     <span class="comment">% val = feGetRep(fe,'bvecs indices rep');</span>
0235     val = fe.rep.bvecsindices;
0236     
0237   <span class="keyword">case</span> {<span class="string">'nbvecs'</span>,<span class="string">'nbvals'</span>}
0238     <span class="comment">% Number of B0's</span>
0239     <span class="comment">%</span>
0240     <span class="comment">% val = feGetRep(fe,'n bvals');</span>
0241     val = length(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'bvals'</span>));
0242     
0243   <span class="keyword">case</span> {<span class="string">'bvals'</span>}
0244     <span class="comment">% B0 Values.</span>
0245     <span class="comment">%</span>
0246     <span class="comment">% bval = feGetRep(fe,'bvals')</span>
0247     val = fe.rep.bvals;
0248     
0249   <span class="keyword">case</span> {<span class="string">'diffusionsignalinvoxel'</span>,<span class="string">'dsiinvox'</span>,<span class="string">'dsigvox'</span>,<span class="string">'dsigmeasuredvoxel'</span>}
0250     <span class="comment">% Returns a nVoxels X nBvecs array of measured diffusion signal</span>
0251     <span class="comment">%</span>
0252     <span class="comment">% val = feGetRep(fe,'dsiinvox');</span>
0253     <span class="comment">% val = feGetRep(fe,'dsiinvox',voxelsIndices);</span>
0254     <span class="comment">% val = feGetRep(fe,'dsiinvox',coords);</span>
0255     val = fe.rep.diffusion_signal_img(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin),:)';
0256     
0257   <span class="keyword">case</span> {<span class="string">'diffusionsignalinvoxeldemeaned'</span>,<span class="string">'dsiinvoxdemeaned'</span>}
0258     <span class="comment">% Returns a nVoxels X nBvecs array of demeaned diffusion signal</span>
0259     <span class="comment">%</span>
0260     <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned');</span>
0261     <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned',voxelsIndices);</span>
0262     <span class="comment">% val =feGetRep(fe,'dsiinvoxdemeaned',coords);</span>
0263     nBvecs       = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0264     voxelIndices = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin);
0265     val = fe.rep.diffusion_signal_img(voxelIndices,:) - repmat(mean(fe.rep.diffusion_signal_img(voxelIndices,:), 2),1,nBvecs);
0266     keyboard <span class="comment">% THis seems to be worng</span>
0267     
0268   <span class="keyword">case</span> {<span class="string">'b0signalimage'</span>,<span class="string">'b0vox'</span>}
0269     <span class="comment">% Get the diffusion signal at 0 diffusion weighting (B0) for this voxel</span>
0270     <span class="comment">%</span>
0271     <span class="comment">% val = feGetRep(fe,'b0signalimage');</span>
0272     <span class="comment">% val = feGetRep(fe,'b0signalimage',voxelIndex);</span>
0273     <span class="comment">% val = feGetRep(fe,'b0signalimage',coords);</span>
0274     val = fe.rep.diffusion_S0_img(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin), :);
0275  
0276   <span class="keyword">case</span> {<span class="string">'isoweights'</span>,<span class="string">'weightsiso'</span>,<span class="string">'meanvoxelsignal'</span>}
0277     <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0278     <span class="comment">% each voxel.</span>
0279     <span class="comment">%</span>
0280     <span class="comment">% val = feGetRep(fe,'iso weights');</span>
0281     <span class="comment">% val = feGetRep(fe,'iso weights'coords)</span>
0282     <span class="comment">% val = feGetRep(fe,'iso weights',voxelIndices)</span>
0283     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Miso'</span>) \ <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig full'</span>)';
0284     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0285      
0286   <span class="keyword">case</span> {<span class="string">'dsigiso'</span>,<span class="string">'isodsig'</span>}
0287     <span class="comment">% mean signalin each voxel, returned for each diffusion direction:</span>
0288     <span class="comment">% size(nBvecsxnVoxels, 1).</span>
0289     <span class="comment">%</span>
0290     <span class="comment">% val = feGetRep(fe,'iso disg');</span>
0291     <span class="comment">% val = feGetRep(fe,'iso disg',coords)</span>
0292     <span class="comment">% val = feGetRep(fe,'iso dsig',voxelIndices)</span>
0293     val = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'iso weights'</span>);
0294     val = repmat(val,1,<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nbvecs'</span>))';
0295     val = val(:);
0296     
0297   <span class="keyword">case</span> {<span class="string">'dsigmeasured'</span>,<span class="string">'dsigfull'</span>}
0298     <span class="comment">% Measured signal in VOI, this is the raw signal. not demeaned</span>
0299     <span class="comment">%</span>
0300     <span class="comment">% dSig = feGetRep(fe,'dSig full')</span>
0301     val = fe.rep.diffusion_signal_img';
0302     val = val(:)';
0303 
0304     <span class="comment">% Return a subset of voxels</span>
0305     <span class="keyword">if</span> ~isempty(varargin)
0306       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0307       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0308       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
0309       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0310     <span class="keyword">end</span>
0311     
0312   <span class="keyword">case</span> {<span class="string">'diffusionsignaldemeaned'</span>,<span class="string">'dsigdemeaned'</span>}
0313     <span class="comment">% Measured signal in VOI, demeaned, this is the signal used for the</span>
0314     <span class="comment">% fiber-portion of the M model.</span>
0315     <span class="comment">%</span>
0316     <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned');</span>
0317     <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned',[1 10 100]);</span>
0318     <span class="comment">% dSig = feGetRep(fe,'dsigdemeaned',coords);</span>
0319     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>);
0320     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0321     val     = (<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig measured'</span>) - reshape(repmat( <span class="keyword">...</span>
0322       mean(reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig measured'</span>), nBvecs, nVoxels),1),<span class="keyword">...</span>
0323       nBvecs,1), size(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig measured'</span>))))';
0324     <span class="comment">% Return a subset of voxels</span>
0325     <span class="keyword">if</span> ~isempty(varargin)
0326       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0327       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0328       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0329       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0330     <span class="keyword">end</span>
0331     
0332   <span class="keyword">case</span> {<span class="string">'dsigrowssubset'</span>,<span class="string">'diffusionsignaldemeanedinsubsetofrows'</span>}
0333     <span class="comment">% Get the demeaned signal for a subset of rows.</span>
0334     <span class="comment">% Useful for cross-validation.</span>
0335     <span class="comment">%</span>
0336     <span class="comment">% dSig = feGetRep(fe,'dsigrowssubset',voxelsList);</span>
0337     dSig = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned'</span>);
0338     <span class="keyword">for</span> vv = 1:length(voxelsList)
0339       val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,vv)) = dSig(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,voxelList(vv)));
0340     <span class="keyword">end</span>
0341     
0342   <span class="keyword">case</span> {<span class="string">'totalr2'</span>}
0343     <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
0344     <span class="comment">% model.</span>
0345     <span class="comment">%</span>
0346     <span class="comment">% R2 = feGetRep(fe,'total r2');</span>
0347 
0348     <span class="comment">%     measured  = feGetRep(fe,'dsigdemeaned');</span>
0349     <span class="comment">%     predicted = feGetRep(fe,'fiber p sig');</span>
0350     <span class="comment">%     val = (1 - (sum((measured - predicted).^2 ) ./ ...</span>
0351     <span class="comment">%                 sum((measured - mean(measured)).^2) ));</span>
0352     val = (1 - (sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0353       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber'</span>)).^2 ) ./ <span class="keyword">...</span>
0354       sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0355       mean(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>))).^2) ));
0356   
0357   <span class="keyword">case</span> {<span class="string">'totalr2voxelwise'</span>}
0358     <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
0359     <span class="comment">% model from a voxel-wise fit</span>
0360     <span class="comment">%</span>
0361     <span class="comment">% R2 = feGetRep(fe,'total r2');</span>
0362 
0363     <span class="comment">%     measured  = feGetRep(fe,'dsigdemeaned');</span>
0364     <span class="comment">%     predicted = feGetRep(fe,'p sig f voxel wise');</span>
0365     <span class="comment">%     val = (1 - (sum((measured - predicted).^2 ) ./ ...</span>
0366     <span class="comment">%                 sum((measured - mean(measured)).^2) ));</span>
0367     val = (1 - (sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>)' - <span class="keyword">...</span>
0368       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxel wise'</span>)).^2 ) ./ <span class="keyword">...</span>
0369       sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0370       mean(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>))).^2) ));
0371   
0372   <span class="keyword">case</span> {<span class="string">'totpve'</span>}
0373     <span class="comment">% Total percent variance explained by data1 on data2</span>
0374     <span class="comment">%</span>
0375     <span class="comment">% R2 = feGetRep(fe,'tot pve data')</span>
0376     val = 100 * <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total r2'</span>);
0377 
0378   <span class="keyword">case</span> {<span class="string">'totalr2data'</span>}
0379     <span class="comment">% Return the global R2 (fraction of variance explained) of the full life</span>
0380     <span class="comment">% model in data set 2 by data set 1.</span>
0381     <span class="comment">%</span>
0382     <span class="comment">% R2 = feGetRep(fe,'total r2 data');</span>
0383 
0384     <span class="comment">%     measured  = feGetRep(fe,'dsigdemeaned');</span>
0385     <span class="comment">%     predicted = feGetRep(fe,'fiber p sig');</span>
0386     <span class="comment">%     val = (1 - (sum((measured - predicted).^2 ) ./ ...</span>
0387     <span class="comment">%                 sum((measured - mean(measured)).^2) ));</span>
0388     val = (1 - (sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0389       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>)).^2 ) ./ <span class="keyword">...</span>
0390       sum((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0391       mean(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>))).^2) ));
0392  
0393   <span class="keyword">case</span> {<span class="string">'totpvedata'</span>}
0394     <span class="comment">% Total percent variance explained by data1 on data2</span>
0395     <span class="comment">%</span>
0396     <span class="comment">% R2 = feGetRep(fe,'tot pve data')</span>
0397     val = 100 * <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total r2 data'</span>);
0398     
0399   <span class="keyword">case</span> {<span class="string">'totalrmsedata'</span>}
0400     <span class="comment">% Global root mean squared error of data1 on data 2</span>
0401     <span class="comment">%</span>
0402     <span class="comment">% rmse = feGetRep(fe,'rmse data')</span>
0403     val = sqrt(mean((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0404       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'diffusion signal demeaned'</span>)).^2));
0405       
0406   <span class="keyword">case</span> {<span class="string">'totalrmseratio'</span>}
0407     <span class="comment">% Global ratio of root mean squared error of Model/Data</span>
0408     <span class="comment">%</span>
0409     <span class="comment">% rmse = feGetRep(fe,'rmse data ratio')</span>
0410     val = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total rmse'</span>) ./ <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total rmse data'</span>);
0411      
0412   <span class="keyword">case</span> {<span class="string">'totalrmseratiovoxelwise'</span>}
0413     <span class="comment">% Global ratio of root mean squared error of Model/Data from a</span>
0414     <span class="comment">% voxel-wise fit</span>
0415     <span class="comment">%</span>
0416     <span class="comment">% rmse = feGetRep(fe,'totalrmseratiovoxelwise')</span>
0417     val = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total rmse voxelwise'</span>) ./ <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'total rmse data'</span>);
0418 
0419   <span class="keyword">case</span> {<span class="string">'totalrmse'</span>}
0420     <span class="comment">% Root mean squared error of the LiFE fit to the whole data</span>
0421     <span class="comment">%</span>
0422     <span class="comment">% rmse = feGetRep(fe,'rmse')</span>
0423     val = sqrt(mean((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>) - <span class="keyword">...</span>
0424       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfiber'</span>)).^2));
0425   
0426   <span class="keyword">case</span> {<span class="string">'totalrmsevoxelwise'</span>}
0427     <span class="comment">% Root mean squared error of the LiFE fit to the whole data from a</span>
0428     <span class="comment">% voxel-wise fit</span>
0429     <span class="comment">%</span>
0430     <span class="comment">% rmse = feGetRep(fe,'totalrmsevoxelwise')</span>
0431     val = sqrt(mean((<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'diffusion signal demeaned'</span>)' - <span class="keyword">...</span>
0432       <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfvoxelwise'</span>)).^2));
0433 
0434   <span class="keyword">case</span> {<span class="string">'ressigfiber'</span>}
0435     <span class="comment">% Residual signal fiber prediction - measured_demeaned.</span>
0436     <span class="comment">%</span>
0437     <span class="comment">% res = feGetRep(fe,'res sig fiber')</span>
0438     val = (<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned'</span>)    - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig fiber'</span>));
0439     <span class="keyword">if</span> ~isempty(varargin)
0440       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0441       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0442       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
0443       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0444     <span class="keyword">end</span>
0445     
0446   <span class="keyword">case</span> {<span class="string">'ressigfull'</span>}
0447     <span class="comment">% Residual signal full model prediction - measured signal.</span>
0448     <span class="comment">%</span>
0449     <span class="comment">% res = feGetRep(fe,'res sig full');</span>
0450     <span class="comment">% res = feGetRep(fe, 'res sig full',coords);</span>
0451     <span class="comment">% res = feGetRep(fe, 'res sig full',voxelIndex);</span>
0452     val = (<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig full'</span>)    - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig full'</span>)');
0453     <span class="keyword">if</span> ~isempty(varargin)
0454       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0455       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0456       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0457       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0458     <span class="keyword">end</span>
0459     
0460   <span class="keyword">case</span> {<span class="string">'ressigfullvoxelwise'</span>}
0461     <span class="comment">% Residual signal full model prediction from a multi-voxel fit.</span>
0462     <span class="comment">%</span>
0463     <span class="comment">% res = feGetRep(fe,'res sig full voxfit');</span>
0464     <span class="comment">% res = feGetRep(fe, 'res sig full voxfit',coords);</span>
0465     <span class="comment">% res = feGetRep(fe, 'res sig full voxfit',voxelIndex);</span>
0466     <span class="comment">%tic,val      = feGetRep(fe,'dsig demeaned') - feGet(fe,'psigfvoxelwise') + feGetRep(fe,'dsigiso');toc</span>
0467     val      = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig full'</span>) - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psigfvoxelwise'</span>);
0468     <span class="keyword">if</span> ~isempty(varargin)
0469       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0470       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0471       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0472       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0473     <span class="keyword">end</span>
0474     
0475    <span class="keyword">case</span> {<span class="string">'voxressigfullvoxelwise'</span>}
0476     <span class="comment">% Residual signal full model prediction from a multi-voxel fit.</span>
0477     <span class="comment">% ORganized in nvecsxn</span>
0478     <span class="comment">%</span>
0479     <span class="comment">% res = feGetRep(fe,'voxressigfullvoxelwise');</span>
0480     <span class="comment">% res = feGetRep(fe, 'voxressigfullvoxelwise',coords);</span>
0481     <span class="comment">% res = feGetRep(fe, 'voxressigfullvoxelwise',voxelIndex);</span>
0482     <span class="comment">%tic,val      = feGetRep(fe,'dsig demeaned') - feGet(fe,'psigfvoxelwise') + feGetRep(fe,'dsigiso');toc</span>
0483     val = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'ressigfullvoxelwise'</span>),<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nbvecs'</span>),<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nvoxels'</span>));
0484 
0485     <span class="keyword">if</span> ~isempty(varargin)
0486       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0487       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0488       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0489       val = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0490     <span class="keyword">end</span>
0491     
0492   <span class="keyword">case</span> {<span class="string">'voxisoweights'</span>,<span class="string">'voxweightsiso'</span>,<span class="string">'voxmeanvoxelsignal'</span>}
0493     <span class="comment">% Weights of the isotropic voxel signals, this is the mean signal in</span>
0494     <span class="comment">% each voxel.</span>
0495     <span class="comment">% Organized nBvecs x nVoxels</span>
0496     <span class="comment">%</span>
0497     <span class="comment">% val = feGet(fe,'voxiso weights');</span>
0498     <span class="comment">% val = feGet(fe,'voxiso weights'coords)</span>
0499     <span class="comment">% val = feGet(fe,'voxiso weights',voxelIndices)</span>
0500     val = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'Miso'</span>) \ <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig full'</span>)';
0501     val = repmat(val,1,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nbvecs'</span>))';
0502 
0503     <span class="keyword">if</span> ~isempty(varargin)
0504       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0505       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0506       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0507       val = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin));
0508     <span class="keyword">end</span>
0509     
0510   <span class="keyword">case</span> {<span class="string">'fiberressigwithmean'</span>}
0511     <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
0512     <span class="comment">% with added mean signal. VECTOR FORM.</span>
0513     <span class="comment">%</span>
0514     <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0515     <span class="comment">% refinement process.</span>
0516     <span class="comment">%</span>
0517     <span class="comment">% res = feGetRep(fe,'fiber res sig with mean');</span>
0518     
0519     <span class="comment">% predicted = feGet(fe,'psig fiber');</span>
0520     <span class="comment">% measured  = feGetRep(fe,'dsigdemeaned');</span>
0521     <span class="comment">% val = (measured_full - predicted demeaned);</span>
0522     val = (<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsig full'</span>)' - <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'psig fiber'</span>)); 
0523     
0524     <span class="keyword">if</span> ~isempty(varargin)
0525       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0526       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0527       <span class="comment">% val           = val(voxelRowsToKeep,:);</span>
0528       val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxel rows'</span>,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'voxelsindices'</span>,varargin)));
0529     <span class="keyword">end</span>
0530     
0531   <span class="keyword">case</span> {<span class="string">'predictedfullsignalvoxel'</span>,<span class="string">'psigfullvox'</span>}
0532     <span class="comment">% Predicted signal by the full model in a set of voxeles.</span>
0533     <span class="comment">%</span>
0534     <span class="comment">% Vox subfield stores per voxel within the VOI</span>
0535     <span class="comment">% The pSig has size of the dwi.</span>
0536     <span class="comment">% It is stored as val = pSig(X,Y,Z,Theta)</span>
0537     <span class="comment">%</span>
0538     <span class="comment">% pSig = feGetRep(fe, 'pSig full by voxel');</span>
0539     <span class="comment">% pSig = feGetRep(fe, 'pSig full by voxel',coords);</span>
0540     <span class="comment">% pSig = feGetRep(fe, 'pSig full by voxel',voxelIndex);</span>
0541     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0542     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0543     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'pSig full'</span>), nBvecs, nVoxels);
0544       
0545   <span class="keyword">case</span> {<span class="string">'voxelr2'</span>,<span class="string">'r2vox'</span>,<span class="string">'voxr2'</span>,<span class="string">'r2byvoxel'</span>}
0546     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0547     <span class="comment">% each voxel.</span>
0548     <span class="comment">%</span>
0549     <span class="comment">% R2byVox = feGetRep(fe,'voxr2');</span>
0550     <span class="comment">% R2byVox = feGetRep(fe,'voxr2',coords);</span>
0551     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0552     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
0553     nBvecs    = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0554     val       = (1 - (sum((measured - predicted).^2 ) ./ <span class="keyword">...</span>
0555       sum((measured - repmat(mean(measured), nBvecs,1)).^2 ) ));
0556     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0557 
0558   <span class="keyword">case</span> {<span class="string">'voxelr2data'</span>,<span class="string">'r2voxdata'</span>,<span class="string">'voxr2data'</span>,<span class="string">'r2byvoxeldata'</span>}
0559     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0560     <span class="comment">% each voxel in data set 2 given the data in dataset 1.</span>
0561     <span class="comment">%</span>
0562     <span class="comment">% R2byVox = feGetRep(fe,'voxr2data');</span>
0563     <span class="comment">% R2byVox = feGetRep(fe,'voxr2data',coords);</span>
0564     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0565     measured2 = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0566     nBvecs    = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0567     val       = (1 - (sum((measured - measured2).^2 ) ./ <span class="keyword">...</span>
0568       sum((measured - repmat(mean(measured), nBvecs,1)).^2 ) ));
0569     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0570 
0571   <span class="keyword">case</span> {<span class="string">'voxelr2zero'</span>,<span class="string">'r2voxzero'</span>,<span class="string">'voxr2zero'</span>,<span class="string">'r2byvoxelzero'</span>}
0572     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0573     <span class="comment">% each voxel. (Normalized to the squared diffusion signal in each voxel)</span>
0574     <span class="comment">%</span>
0575     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zero');</span>
0576     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zero',coords);</span>
0577     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0578     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
0579     val       = (1 - (sum((measured - predicted).^2 ) ./ sum(measured.^2)));
0580     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0581     
0582   <span class="keyword">case</span> {<span class="string">'voxelr2zerodata'</span>,<span class="string">'r2voxzerodata'</span>,<span class="string">'voxr2zerodata'</span>,<span class="string">'r2byvoxelzerodata'</span>}
0583     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0584     <span class="comment">% each voxel in dataset 1 given the data in data set 2.</span>
0585     <span class="comment">% (Normalized to the squared diffusion signal in each voxel)</span>
0586     <span class="comment">%</span>
0587     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zerodata');</span>
0588     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zerodata',coords);</span>
0589     measured  = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0590     measured2 = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0591     val       = (1 - (sum((measured - measured2).^2 ) ./ sum(measured.^2)));
0592     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0593 
0594   
0595   <span class="keyword">case</span> {<span class="string">'voxelr2voxelwise'</span>,<span class="string">'r2voxvoxelwise'</span>,<span class="string">'voxr2voxelwise'</span>,<span class="string">'r2voxelwisebyvoxel'</span>}
0596     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0597     <span class="comment">% each voxel.</span>
0598     <span class="comment">%</span>
0599     <span class="comment">% R2byVox = feGetRep(fe,'voxr2voxelwise');</span>
0600     <span class="comment">% R2byVox = feGetRep(fe,'voxr2voxelwise',coords);</span>
0601     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0602     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxel wise by voxel'</span>);
0603     nBvecs    = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0604     val       = (1 - (sum((measured - predicted).^2 ) ./ <span class="keyword">...</span>
0605       sum((measured - repmat(mean(measured), nBvecs,1)).^2 ) ));
0606     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0607 
0608   <span class="keyword">case</span> {<span class="string">'voxelr2zerovoxelwise'</span>,<span class="string">'r2zerovoxelwisebyvoxel'</span>,<span class="string">'voxr2zerovoxelwise'</span>}
0609     <span class="comment">% Return a column vector of the proportion of variance explained in</span>
0610     <span class="comment">% each voxel. (Normalized to the squared diffusion signal in each voxel)</span>
0611     <span class="comment">%</span>
0612     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zerovoxelwise');</span>
0613     <span class="comment">% R2byVox = feGetRep(fe,'voxr2zerovoxelwise',coords);</span>
0614     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig demeaned by voxel'</span>);
0615     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxel wise by voxel'</span>);
0616     val       = (1 - (sum((measured - predicted).^2 ) ./ sum(measured.^2)));
0617     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));    
0618     
0619   <span class="keyword">case</span> {<span class="string">'voxelvarianceexplained'</span>,<span class="string">'varexpvox'</span>,<span class="string">'voxvarexp'</span>,<span class="string">'varexpbyvoxel'</span>}
0620     <span class="comment">% Return the percent of varince explained in each voxel.</span>
0621     <span class="comment">%</span>
0622     <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel');</span>
0623     <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel',coords);</span>
0624     val = 100.*<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'voxr2'</span>);
0625     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0626    
0627   <span class="keyword">case</span> {<span class="string">'voxelvarianceexplaineddata'</span>,<span class="string">'varexpvoxdata'</span>,<span class="string">'voxvarexpdata'</span>,<span class="string">'varexpbyvoxeldata'</span>}
0628     <span class="comment">% Return the percent of variance explained in each voxel in data set 1</span>
0629     <span class="comment">% given the data in data set 2.</span>
0630     <span class="comment">%</span>
0631     <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel data');</span>
0632     <span class="comment">% R2byVox = feGetRep(fe,'var exp by voxel data',coords);</span>
0633     val = 100.*<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'voxr2 data'</span>);
0634     val = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0635  
0636   <span class="keyword">case</span> {<span class="string">'dsigdemeanedbyvoxel'</span>,<span class="string">'dsigdemeanedvox'</span>}
0637     <span class="comment">% Demeaned diffusion signal in each voxel</span>
0638     <span class="comment">%</span>
0639     <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel');</span>
0640     <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',coords);</span>
0641     <span class="comment">% dSigByVoxel = feGetRep(fe,'dsigdemeaned by Voxel',vxIndex);</span>
0642     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0643     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0644     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned'</span>), nBvecs, nVoxels);
0645     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0646     
0647   <span class="keyword">case</span> {<span class="string">'dsigfullbyvoxel'</span>,<span class="string">'dsigfullvox'</span>}
0648     <span class="comment">% Full (measured) signal in each voxel</span>
0649     <span class="comment">%</span>
0650     <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel');</span>
0651     <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel',coords);</span>
0652     <span class="comment">% dSigByVoxel = feGetRep(fe,'dSig full by Voxel',vxIndex);</span>
0653     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0654     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0655     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dSig full'</span>), nBvecs, nVoxels);
0656     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
0657     
0658   <span class="keyword">case</span> {<span class="string">'voxelrmse'</span>,<span class="string">'voxrmse'</span>}
0659     <span class="comment">% A volume of RMSE values</span>
0660     <span class="comment">%</span>
0661     <span class="comment">% RMSE = feGetRep(fe,'vox rmse')</span>
0662     <span class="comment">% RMSE = feGetRep(fe,'vox rmse',coords)</span>
0663     <span class="comment">% RMSE = feGetRep(fe,'vox rmse',vxIndex)</span>
0664     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0665     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f vox'</span>);
0666     val       = sqrt(mean((measured - predicted).^2,1));
0667     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0668     
0669   <span class="keyword">case</span> {<span class="string">'voxelrmsevoxelwise'</span>,<span class="string">'voxrmsevoxelwise'</span>}
0670     <span class="comment">% A volume of RMSE values optained with the voxel-wise (vw) fit.</span>
0671     <span class="comment">%</span>
0672     <span class="comment">% RMSE = feGetRep(fe,'vox rmse vw')</span>
0673     <span class="comment">% RMSE = feGetRep(fe,'vox rmse vw',coords)</span>
0674     <span class="comment">% RMSE = feGetRep(fe,'vox rmse vw',vxIndex)</span>
0675     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0676     predicted = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig f voxel wise by voxel'</span>);
0677     val       = sqrt(mean((measured - predicted).^2,1));
0678     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0679 
0680   <span class="keyword">case</span> {<span class="string">'voxelrmseratio'</span>,<span class="string">'voxrmseratio'</span>}
0681     <span class="comment">% A volume with the ratio of the RMSE of model/data</span>
0682     <span class="comment">%</span>
0683     <span class="comment">% rmseRatio = feGetRep(fe,'vox rmse ratio')</span>
0684     <span class="comment">% rmseRatio = feGetRep(fe,'vox rmse ratio',coords)</span>
0685     <span class="comment">% rmseRatio  = feGetRep(fe,'vox rmse ratio',vxIndex)</span>
0686     rmseData  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'vox rmse data'</span>);
0687     rmseModel = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'vox rmse'</span>);
0688     val       = rmseModel ./ rmseData;
0689     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0690 
0691   <span class="keyword">case</span> {<span class="string">'voxelrmseratiovoxelwise'</span>,<span class="string">'voxrmseratiovoxelwise'</span>}
0692     <span class="comment">% A volume with the ratio of the RMSE of model/data</span>
0693     <span class="comment">%</span>
0694     <span class="comment">% rmseRatio = feGetRep(fe,'vox rmse ratio voxel wise')</span>
0695     <span class="comment">% rmseRatio = feGetRep(fe,'vox rmse ratio voxel wise',coords)</span>
0696     <span class="comment">% rmseRatio  = feGetRep(fe,'vox rmse ratio voxel wise',vxIndex)</span>
0697     rmseData  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'vox rmse data'</span>);
0698     rmseModel = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'vox rmse voxel wise'</span>);
0699     val       = rmseModel ./ rmseData;
0700     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0701 
0702   <span class="keyword">case</span> {<span class="string">'voxelrmsedata'</span>,<span class="string">'voxrmsedata'</span>}
0703     <span class="comment">% A volume of RMSE values from data set 1 to data set 2</span>
0704     <span class="comment">%</span>
0705     <span class="comment">% RMSE = feGetRep(fe,'vox rmse data')</span>
0706     <span class="comment">% RMSE = feGetRep(fe,'vox rmse data',coords)</span>
0707     <span class="comment">% RMSE = feGetRep(fe,'vox rmse data',vxIndex)</span>
0708     measured  =    <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0709     measured2 = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0710     val       = sqrt(mean((measured - measured2).^2,1));
0711     val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0712 
0713   <span class="keyword">case</span> {<span class="string">'voxelrmsetest'</span>,<span class="string">'voxrmsetest'</span>}
0714     <span class="comment">% A volume of RMSE values with a subset of fibers' weights set to 0.</span>
0715     <span class="comment">%</span>
0716     <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices)</span>
0717     <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices,coords)</span>
0718     <span class="comment">% RMSE = feGetRep(fe,'vox rmse',fiberIndices,voxelIndex)</span>
0719     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0720     <span class="comment">% Reshape the predicted signal by voxles</span>
0721     predicted = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber test voxel wise'</span>,varargin{1}), <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>), <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>));   
0722     val       = sqrt(mean((measured - predicted).^2,1));
0723     
0724     <span class="keyword">if</span> length(varargin) == 2
0725       val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0726     <span class="keyword">end</span>
0727     
0728   <span class="keyword">case</span> {<span class="string">'voxelrmsetestvoxelwise'</span>,<span class="string">'voxrmsetestvoxelwise'</span>}
0729     <span class="comment">% A volume of RMSE values with a subset of fibers' weights set to 0.</span>
0730     <span class="comment">%</span>
0731     <span class="comment">% RMSE = feGetRep(fe,'voxel rmse test voxel wise',fiberIndices)</span>
0732     <span class="comment">% RMSE = feGetRep(fe,'voxel rmse test voxel wise',fiberIndices,coords)</span>
0733     <span class="comment">% RMSE = feGetRep(fe,'voxel rmse test voxel wise',fiberIndices,voxelIndex)</span>
0734     measured  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'dsigdemeaned by voxel'</span>);
0735     <span class="comment">% Reshape the predicted signal by voxles</span>
0736     predicted = reshape(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'pSig fiber test voxel wise'</span>,varargin{1}), <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>), <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'nVoxels'</span>));   
0737     val       = sqrt(mean((measured - predicted).^2,1));
0738     
0739     <span class="keyword">if</span> length(varargin) == 2
0740       val       = val(<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0741     <span class="keyword">end</span>
0742     
0743   <span class="keyword">case</span> {<span class="string">'residualsignalfibervoxel'</span>,<span class="string">'resfibervox'</span>}
0744     <span class="comment">% Fibers' residual signal by voxel</span>
0745     <span class="comment">%</span>
0746     <span class="comment">% res = feGetRep(fe,'res sig fiber vox')</span>
0747     <span class="comment">% res = feGetRep(fe,'res sig fiber vox',coords)</span>
0748     <span class="comment">% res = feGetRep(fe,'res sig fiber vox',vxIndex)</span>
0749     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0750     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0751     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'res sig fiber'</span>), nBvecs, nVoxels);
0752     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
0753     
0754   <span class="keyword">case</span> {<span class="string">'residualsignalfullvoxel'</span>,<span class="string">'resfullvox'</span>}
0755     <span class="comment">% Full (measured) residual signal by voxel</span>
0756     <span class="comment">%</span>
0757     <span class="comment">% res = feGetRep(fe,'res sig full vox')</span>
0758     <span class="comment">% res = feGetRep(fe,'res sig full vox',coords)</span>
0759     <span class="comment">% res = feGetRep(fe,'res sig full vox',vxIndex)</span>
0760     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0761     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0762     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'res sig full'</span>), nBvecs, nVoxels);
0763     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))';
0764       
0765   <span class="keyword">case</span> {<span class="string">'fiberressigwithmeanvoxel'</span>}
0766     <span class="comment">% Residual signal fiber model prediction - demeaned measured signal</span>
0767     <span class="comment">% with added mean signal. VOXEL FORM (nBvecs x nVoxel).</span>
0768     <span class="comment">%</span>
0769     <span class="comment">% This is used to reconstruct an image (volume) to be used for the</span>
0770     <span class="comment">% refinement process.</span>
0771     <span class="comment">%</span>
0772     <span class="comment">% res = feGetRep(fe,'fiber res sig with mean');</span>
0773     
0774     <span class="comment">% predicted = feGet(fe,'psig fiber');</span>
0775     <span class="comment">% measured  = feGetRep(fe,'dsigdemeaned');</span>
0776     <span class="comment">% val = (measured     - predicted) + (measured_full - measured);</span>
0777     val     = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'fiberressigwithmean'</span>);
0778     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0779     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0780     val     = reshape(val, nBvecs, nVoxels);
0781     
0782     <span class="keyword">if</span> ~isempty(varargin)
0783       <span class="comment">% voxelIndices     = feGet(fe,'voxelsindices',varargin);</span>
0784       <span class="comment">% voxelRowsToKeep  = feGet(fe,'voxel rows',voxelIndices);</span>
0785       <span class="comment">% val              = val(voxelRowsToKeep,:);</span>
0786       val = val(:, <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin));
0787     <span class="keyword">end</span>
0788     
0789   <span class="keyword">case</span> {<span class="string">'fiberressigwithmeanvox'</span>,<span class="string">'resfibermeanvox'</span>}
0790     <span class="comment">% Fibers' residual signal by voxel with mean signal added (with added</span>
0791     <span class="comment">% isotropic component).</span>
0792     <span class="comment">%</span>
0793     <span class="comment">% This is used to compute the residual signal for the refinement.</span>
0794     <span class="comment">%</span>
0795     <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox')</span>
0796     <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox',coords)</span>
0797     <span class="comment">% res = feGetRep(fe,'fiber res sig with mean vox',vxIndex)</span>
0798     nBvecs  = <a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'nBvecs'</span>);
0799     nVoxels = <a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'n voxels'</span>);
0800     val     = reshape(<a href="feGetRep.html" class="code" title="function val = feGetRep(fe,param,varargin)">feGetRep</a>(fe,<span class="string">'fiber res sig with mean'</span>), nBvecs, nVoxels);
0801     val     = val(:,<a href="feGet.html" class="code" title="function val = feGet(fe,param,varargin)">feGet</a>(fe,<span class="string">'return voxel indices'</span>,varargin))'; 
0802 
0803   <span class="keyword">case</span> {<span class="string">'volumesize'</span>,<span class="string">'dims'</span>,<span class="string">'dim'</span>,<span class="string">'imagedim'</span>}
0804     <span class="comment">% Dimensions of the DW volume.</span>
0805     <span class="comment">%</span>
0806     <span class="comment">% dim = feGetRep(fe,'dims')</span>
0807     val = fe.rep.imagedim;
0808   <span class="keyword">case</span> {<span class="string">'mapsize'</span>}
0809     <span class="comment">% Dimensions of the maps of parameters and results.</span>
0810     <span class="comment">%</span>
0811     <span class="comment">% dims = feGetRep(fe, 'mapsize')</span>
0812     val = fe.rep.imagedim(1:3);
0813     
0814   <span class="keyword">otherwise</span>
0815     help(<span class="string">'feGetRep'</span>)
0816     fprintf(<span class="string">'[feGetRep] Unknown parameter &lt;&lt; %s &gt;&gt;...\n'</span>,param);
0817     keyboard
0818 <span class="keyword">end</span>
0819 
0820 <span class="keyword">end</span> <span class="comment">% END MAIN FUNCTION</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 11:25:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>