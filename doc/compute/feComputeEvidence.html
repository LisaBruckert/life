<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of feComputeEvidence</title>
  <meta name="keywords" content="feComputeEvidence">
  <meta name="description" content="Computes a series of distance metrics between two RMSE distribtions.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">compute</a> &gt; feComputeEvidence.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for compute&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>feComputeEvidence
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Computes a series of distance metrics between two RMSE distribtions.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function se = feComputeEvidence(rmse1,rmse2) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Computes a series of distance metrics between two RMSE distribtions.

 Compute summary statistics on to characterize the lesion,:
 We compute:
 - The strength of evidence, namely the effect size of the lesion
 - The Kullback-Leibler Divergence
 - Jeffrey's Divergence
 - The Eath Mover's distance

 Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function se = feComputeEvidence(rmse1,rmse2)</a>
0002 <span class="comment">% Computes a series of distance metrics between two RMSE distribtions.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Compute summary statistics on to characterize the lesion,:</span>
0005 <span class="comment">% We compute:</span>
0006 <span class="comment">% - The strength of evidence, namely the effect size of the lesion</span>
0007 <span class="comment">% - The Kullback-Leibler Divergence</span>
0008 <span class="comment">% - Jeffrey's Divergence</span>
0009 <span class="comment">% - The Eath Mover's distance</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</span>
0012 
0013 <span class="comment">% Prepare the distribution of errors and the histograms describing the</span>
0014 <span class="comment">% erros.</span>
0015 se.nolesion.rmse.all  = rmse1;
0016 se.lesion.rmse.all    = rmse2;
0017 se.nolesion.rmse.mean = mean(se.nolesion.rmse.all);
0018 se.lesion.rmse.mean   = mean(se.lesion.rmse.all);
0019 
0020 <span class="comment">% Histograms</span>
0021 se.xrange(1) = ceil(min([se.lesion.rmse.all se.nolesion.rmse.all]));
0022 se.xrange(2) = floor(max([se.lesion.rmse.all se.nolesion.rmse.all]));
0023 se.nbins     = 60;
0024 se.bins      = linspace(se.xrange(1),se.xrange(2),se.nbins);
0025 [se.lesion.hist,   se.lesion.xhist]   = hist(se.lesion.rmse.all,  se.bins);
0026 [se.nolesion.hist, se.nolesion.xhist] = hist(se.nolesion.rmse.all,se.bins);
0027 se.lesion.hist     = se.lesion.hist ./   sum(se.lesion.hist);
0028 se.nolesion.hist   = se.nolesion.hist ./ sum(se.nolesion.hist);
0029 
0030 <span class="comment">% Kullback-Leibler Divergence</span>
0031 se.kl.name = sprintf(<span class="string">'Kullbackâ€“Leibler divergence: http://en.wikipedia.org/wiki/Kullback-Leibler_divergence'</span>);
0032 tmp = se.nolesion.hist .* log2( (se.nolesion.hist) ./ (se.lesion.hist + eps) );
0033 se.kl.mean = nansum(tmp);clear tmp
0034 se.kl.std  = nan;
0035 
0036 <span class="comment">% Jeffrey's divergence</span>
0037 se.j.name = sprintf(<span class="string">'Jeffrey''s divergence: http://en.wikipedia.org/wiki/Divergence_(statistics)'</span>);
0038 tmp = se.nolesion.hist .* log2( (se.nolesion.hist) ./ ((se.lesion.hist + se.lesion.hist + eps)./2)  ) + <span class="keyword">...</span>
0039       se.lesion.hist .* log2( (se.lesion.hist) ./ ((se.lesion.hist + se.lesion.hist + eps)./2) );
0040 se.j.mean = nansum(tmp); clear tmp
0041 se.j.std   = nan;
0042 
0043 <span class="comment">% Earth Mover's Distance:</span>
0044 <span class="comment">% Note: This can be very slow and my require large amounts of memory for more than 1000 voxels</span>
0045 fprintf(<span class="string">'[%s] Computing the Earth Mover''s distance... \n'</span>,mfilename)
0046 se.em.name = sprintf(<span class="string">'Earth Mover''s distance: http://en.wikipedia.org/wiki/Earth_mover''s_distance'</span>);
0047 <span class="keyword">if</span> (exist(<span class="string">'emd_mex.m'</span>,<span class="string">'file'</span>) == 2) <span class="comment">% Using Rubinov c-code fastest</span>
0048     pairwiseDist = zeros(size(se.lesion.xhist,2));
0049     <span class="keyword">for</span> i=1:size(se.nolesion.xhist,2)
0050         <span class="keyword">for</span> j=1:size(se.lesion.xhist,2)
0051             pairwiseDist(i,j) = abs(se.lesion.xhist(i)-se.nolesion.xhist(j));
0052         <span class="keyword">end</span>
0053     <span class="keyword">end</span>
0054     tmp_em = emd_mex(se.nolesion.hist,se.lesion.hist,pairwiseDist);
0055 <span class="keyword">else</span>
0056     [~,tmp_em] = emd(se.nolesion.xhist',se.lesion.xhist',se.nolesion.hist',se.lesion.hist',@gdf);
0057 <span class="keyword">end</span>
0058 se.em.mean = tmp_em;
0059 se.em.std  = nan;
0060 clear tmp_emp
0061 
0062 <span class="comment">% Strenght of evidence (effect size)</span>
0063 fprintf(<span class="string">'[%s] Computing the Strength of Evidence... \n'</span>,mfilename)
0064 se.s.name = sprintf(<span class="string">'strength of evidence, d-prime: http://en.wikipedia.org/wiki/Effect_size'</span>);
0065 se.s.nboots = 5000; 
0066 se.s.nmontecarlo = 5;
0067 se.s.nbins = 200;
0068 sizeunlesioned    = length(se.nolesion.rmse.all);
0069 nullDistributionW = nan(se.s.nboots,se.s.nmontecarlo);
0070 nullDistributionWO = nan(se.s.nboots,se.s.nmontecarlo);
0071 min_x = floor(mean([se.nolesion.rmse.all]) - mean([se.nolesion.rmse.all])*.05);
0072 max_x = ceil( mean([se.lesion.rmse.all])   + mean([se.lesion.rmse.all])*.05);
0073 
0074 <span class="keyword">for</span> inm = 1:se.s.nmontecarlo
0075     fprintf(<span class="string">'.'</span>)
0076     parfor ibt = 1:se.s.nboots
0077         nullDistributionW(ibt,inm)  = mean(randsample(se.nolesion.rmse.all,   sizeunlesioned,true));      
0078         nullDistributionWO(ibt,inm) = mean(randsample(se.lesion.rmse.all,sizeunlesioned,true));
0079     <span class="keyword">end</span>
0080     
0081     <span class="comment">% Distribution unlesioned</span>
0082     [y(:,inm),xhis] = hist(nullDistributionW(:,inm),linspace(min_x,max_x,se.s.nbins));
0083     y(:,inm) = y(:,inm)./sum(y(:,inm));
0084     
0085     <span class="comment">% Distribution lesioned</span>
0086     [woy(:,inm),woxhis] = hist(nullDistributionWO(:,inm),linspace(min_x,max_x,se.s.nbins));
0087     woy(:,inm) = woy(:,inm)./sum(woy(:,inm));
0088 <span class="keyword">end</span>
0089     
0090 se.s.mean = mean(diff([mean(nullDistributionW,1); <span class="keyword">...</span>
0091                           mean(nullDistributionWO,1)])./sqrt(sum([std(nullDistributionW,[],1);std(nullDistributionWO,[],1)].^2,1)));
0092 se.s.std  = std(diff([mean(nullDistributionW,1); <span class="keyword">...</span>
0093                           mean(nullDistributionWO,1)])./sqrt(sum([std(nullDistributionW,[],1);std(nullDistributionWO,[],1)].^2,1)));
0094 disp(<span class="string">' done.'</span>)
0095 
0096 <span class="comment">% Extract the mean and error of the botstrapped disributions of mean errors</span>
0097 y_m   = mean(y,2);
0098 ywo_m = mean(woy,2);
0099 y_e   = [y_m, y_m] + 2*[-std(y,[],2),std(y,[],2)];
0100 ywo_e = [ywo_m, ywo_m] + 2*[-std(woy,[],2),std(woy,[],2)];
0101 se.s.lesioned_e   = ywo_e;
0102 se.s.lesioned_m   = ywo_m;
0103 se.s.unlesioned_e = y_e;
0104 se.s.unlesioned_m = y_m;
0105 se.s.lesioned.xbins   = woxhis;
0106 se.s.unlesioned.xbins = xhis;
0107 se.s.min_x   = min_x;
0108 se.s.max_x = max_x;
0109 
0110 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 18:56:15 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>