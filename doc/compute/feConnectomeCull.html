<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of feConnectomeCull</title>
  <meta name="keywords" content="feConnectomeCull">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">compute</a> &gt; feConnectomeCull.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for compute&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>feConnectomeCull
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [fe fefit fexval] = feConnectomeCull(fe,maxNumInter, lowerPrct, percentReduxRMSE) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">
 Find the fibers in a connectome that explain most of the variance, by
 iteratively finding the fibers with largest weights and fitting the life
 model only to those.

   [fe fefit fexval] = feCullConnectome(fe,maxNumInter, lowerPrct, percentReduxRMSE)
 
 Inputs:
   fe            - An fe structure, see feCreate.m or v_lifeExample.m
   maxNumInter - The number of times the fit and fiber selection
                   processes are repeated.
   lowerPrct     - The lower percentile for accepting a weight. On each
                   iteration only fibers above this percentile are
                   accepted.
   percentReduxRMSE   - The max percent in R2 reduction that we allow.
                   When the cross validated R2 get smaller than tis
                   percent of the original R2, we stop culling.

 Outputs: 
   fe            - The fe structure with  the culled fibers.

 Example:
   baseDir    = fullfile(mrvDataRootPath,'diffusion','sampleData');
   dtFile     = fullfile(baseDir,'dti40','dt6.mat');
   dwiFile    = fullfile(baseDir,'raw','dwi.nii.gz');
   fgFileName = fullfile(baseDir,'fibers','leftArcuateSmall.pdb');
   fe         = feConnectomeInit(dwiFile,dtFile,fgFileName);
   fe         = feConnectomeCull(fe);
 
 Franco (c) 2012 Stanford VISTA Team.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feFitModel.html" class="code" title="function [fit w R2] = feFitModel(M,dSig,fitMethod)">feFitModel</a>	Fit the LiFE model.</li><li><a href="feXvalidate.html" class="code" title="function [xval, r2, rmse] = feXvalidate(M,dSig, fitMethod, crossValType)">feXvalidate</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [fe fefit fexval] = feConnectomeCull(fe,maxNumInter, lowerPrct, percentReduxRMSE)</a>
0002 <span class="comment">%</span>
0003 <span class="comment">% Find the fibers in a connectome that explain most of the variance, by</span>
0004 <span class="comment">% iteratively finding the fibers with largest weights and fitting the life</span>
0005 <span class="comment">% model only to those.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   [fe fefit fexval] = feCullConnectome(fe,maxNumInter, lowerPrct, percentReduxRMSE)</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Inputs:</span>
0010 <span class="comment">%   fe            - An fe structure, see feCreate.m or v_lifeExample.m</span>
0011 <span class="comment">%   maxNumInter - The number of times the fit and fiber selection</span>
0012 <span class="comment">%                   processes are repeated.</span>
0013 <span class="comment">%   lowerPrct     - The lower percentile for accepting a weight. On each</span>
0014 <span class="comment">%                   iteration only fibers above this percentile are</span>
0015 <span class="comment">%                   accepted.</span>
0016 <span class="comment">%   percentReduxRMSE   - The max percent in R2 reduction that we allow.</span>
0017 <span class="comment">%                   When the cross validated R2 get smaller than tis</span>
0018 <span class="comment">%                   percent of the original R2, we stop culling.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Outputs:</span>
0021 <span class="comment">%   fe            - The fe structure with  the culled fibers.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Example:</span>
0024 <span class="comment">%   baseDir    = fullfile(mrvDataRootPath,'diffusion','sampleData');</span>
0025 <span class="comment">%   dtFile     = fullfile(baseDir,'dti40','dt6.mat');</span>
0026 <span class="comment">%   dwiFile    = fullfile(baseDir,'raw','dwi.nii.gz');</span>
0027 <span class="comment">%   fgFileName = fullfile(baseDir,'fibers','leftArcuateSmall.pdb');</span>
0028 <span class="comment">%   fe         = feConnectomeInit(dwiFile,dtFile,fgFileName);</span>
0029 <span class="comment">%   fe         = feConnectomeCull(fe);</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Franco (c) 2012 Stanford VISTA Team.</span>
0032 
0033 <span class="comment">% For large Conectomes this number might need to be increased, convergence</span>
0034 <span class="comment">% might require more interations.</span>
0035 <span class="keyword">if</span> notDefined(<span class="string">'maxNumInter'</span>), maxNumInter = 1000;<span class="keyword">end</span>
0036 
0037 <span class="comment">% This is the percent of fibers that are removed at each iteration. The</span>
0038 <span class="comment">% larger this number the faster the convergence, but the more likely to</span>
0039 <span class="comment">% delete important fibers and produce a reduced connectome with a larger</span>
0040 <span class="comment">% loss of R2.</span>
0041 <span class="keyword">if</span> notDefined(<span class="string">'lowerPrct'</span>), lowerPrct     = 10;<span class="keyword">end</span>
0042 
0043 <span class="comment">% The percent change in R2 from that of the orignal model.</span>
0044 <span class="comment">% The smaller this number the faster the convergence, the more the fibers</span>
0045 <span class="comment">% kept in the connectome.</span>
0046 <span class="keyword">if</span> notDefined(<span class="string">'percentReduxRMSE'</span>), percentReduxRMSE = 2;<span class="keyword">end</span>
0047 
0048 <span class="comment">% Fit the model and then reduced it by only accepting fibers that pass</span>
0049 <span class="comment">% the minWeights threshold.</span>
0050 <span class="keyword">for</span> iter = 1:maxNumInter
0051   fefit  = <a href="feFitModel.html" class="code" title="function [fit w R2] = feFitModel(M,dSig,fitMethod)">feFitModel</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'sgdnn'</span>);  
0052    
0053   <span class="comment">% Check whether we start loosing percent variance explained when</span>
0054   <span class="comment">% crossvalidating</span>
0055   fexval = <a href="feXvalidate.html" class="code" title="function [xval, r2, rmse] = feXvalidate(M,dSig, fitMethod, crossValType)">feXvalidate</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'sgdnn'</span>);
0056   
0057   <span class="comment">% Start keeping trak of the quality of fit.</span>
0058   <span class="comment">% When the fit quality decreases we will stop culling.</span>
0059   <span class="keyword">if</span> (iter == 1)
0060     originalRMSE = fexval.rmse.mean;  
0061     currentRMSE  = fexval.rmse.mean;
0062   <span class="keyword">else</span>
0063     currentRMSE  = fexval.rmse.mean;
0064   <span class="keyword">end</span>
0065   
0066   <span class="keyword">if</span> currentRMSE &gt; ((originalRMSE) + (originalRMSE*(percentReduxRMSE/100)))
0067     <span class="keyword">break</span>
0068   <span class="keyword">end</span>
0069   fprintf(<span class="string">'\n\n[%s] n iter: %i, Original RMSE: %2.3f, Current RMSE: %2.3f.\n\n'</span>,mfilename, iter,originalRMSE,currentRMSE)
0070   
0071   <span class="comment">% Compute the cut-off for the fibers</span>
0072   minWeight    = prctile(fefit.weights,lowerPrct);
0073   fibersToKeep = find(fefit.weights &gt; minWeight);
0074   
0075   <span class="comment">% Reduce the connectome.</span>
0076   fe = feConnectomeSelectFibers(fe,fibersToKeep);
0077   
0078 <span class="keyword">end</span>
0079 
0080 <span class="comment">% Refit the model and save the fit</span>
0081 fefit  = <a href="feFitModel.html" class="code" title="function [fit w R2] = feFitModel(M,dSig,fitMethod)">feFitModel</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'sgdnn'</span>);  
0082 fexval = <a href="feXvalidate.html" class="code" title="function [xval, r2, rmse] = feXvalidate(M,dSig, fitMethod, crossValType)">feXvalidate</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dsigdemeaned'</span>),<span class="string">'sgdnn'</span>);
0083 
0084 <span class="comment">% Remove any fit or cross-validation</span>
0085 fe = feSet(fe,<span class="string">'fit'</span>, fefit);
0086 fe = feSet(fe,<span class="string">'xvalfit'</span>,fexval);
0087 
0088 fprintf(<span class="string">'[%s] Done culling, in %i iterations.\n Original RMSE: %2.3f, Current RMSE: %2.3f.\n'</span>,mfilename, iter,originalRMSE,currentRMSE)
0089 
0090 <span class="keyword">return</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 11:25:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>