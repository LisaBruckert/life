<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of feConnectomeCull2</title>
  <meta name="keywords" content="feConnectomeCull2">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">compute</a> &gt; feConnectomeCull2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for compute&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>feConnectomeCull2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [fe fefit fexval] = feConnectomeCull2(fe,minWeight, prctR2redux,maxNumIter) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">
 This function si currently not being used. But it might be useful in the
 future releases.

 Find the smallest set fibers in a connectome that explain most of the variance.

 It iteratively finds and drops fibers with smallest weights (zero weights).

   [fe fefit fexval] = feConnectomeCull2(fe,maxNumInter, minWeight, prctR2redux,maxNumIter)
 
 Inputs:
   fe            - An fe structure, see feCreate.m or v_lifeExample.m
   minWeight     - The lowest weight accepted.  Default, is zero.
   prctR2redux   - The max reduction in percent variance explained that we
                   allow before exiting. Default is zero.
   maxNumIter    - Maximum number of iterations allowed before retuning
                   the current connectome. Default 1000;

 Outputs: 
   fe            - The fe structure with  the culled fibers.

 Example:
   baseDir    = fullfile(mrvDataRootPath,'diffusion','sampleData');
   dtFile     = fullfile(baseDir,'dti40','dt6.mat');
   dwiFile    = fullfile(baseDir,'raw','dwi.nii.gz');
   fgFileName = fullfile(baseDir,'fibers','leftArcuateSmall.pdb');
   fe         = feConnectomeInit(dwiFile,dtFile,fgFileName);
   fe         = feConnectomeCull(fe);
 
 Franco (c) 2012 Stanford VISTA Team.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="feFitModel.html" class="code" title="function [fit w R2] = feFitModel(M,dSig,fitMethod)">feFitModel</a>	Fit the LiFE model.</li><li><a href="feXvalidate.html" class="code" title="function [xval, r2, rmse] = feXvalidate(M,dSig, fitMethod, crossValType)">feXvalidate</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [fe fefit fexval] = feConnectomeCull2(fe,minWeight, prctR2redux,maxNumIter)</a>
0002 <span class="comment">%</span>
0003 <span class="comment">% This function si currently not being used. But it might be useful in the</span>
0004 <span class="comment">% future releases.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Find the smallest set fibers in a connectome that explain most of the variance.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% It iteratively finds and drops fibers with smallest weights (zero weights).</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   [fe fefit fexval] = feConnectomeCull2(fe,maxNumInter, minWeight, prctR2redux,maxNumIter)</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Inputs:</span>
0013 <span class="comment">%   fe            - An fe structure, see feCreate.m or v_lifeExample.m</span>
0014 <span class="comment">%   minWeight     - The lowest weight accepted.  Default, is zero.</span>
0015 <span class="comment">%   prctR2redux   - The max reduction in percent variance explained that we</span>
0016 <span class="comment">%                   allow before exiting. Default is zero.</span>
0017 <span class="comment">%   maxNumIter    - Maximum number of iterations allowed before retuning</span>
0018 <span class="comment">%                   the current connectome. Default 1000;</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Outputs:</span>
0021 <span class="comment">%   fe            - The fe structure with  the culled fibers.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Example:</span>
0024 <span class="comment">%   baseDir    = fullfile(mrvDataRootPath,'diffusion','sampleData');</span>
0025 <span class="comment">%   dtFile     = fullfile(baseDir,'dti40','dt6.mat');</span>
0026 <span class="comment">%   dwiFile    = fullfile(baseDir,'raw','dwi.nii.gz');</span>
0027 <span class="comment">%   fgFileName = fullfile(baseDir,'fibers','leftArcuateSmall.pdb');</span>
0028 <span class="comment">%   fe         = feConnectomeInit(dwiFile,dtFile,fgFileName);</span>
0029 <span class="comment">%   fe         = feConnectomeCull(fe);</span>
0030 <span class="comment">%</span>
0031 <span class="comment">% Franco (c) 2012 Stanford VISTA Team.</span>
0032 
0033 <span class="comment">% This is the percent of fibers that are removed at each iteration. The</span>
0034 <span class="comment">% larger this number the faster the convergence, but the more likely to</span>
0035 <span class="comment">% delete important fibers and produce a reduced connectome with a larger</span>
0036 <span class="comment">% loss of R2.</span>
0037 <span class="keyword">if</span> notDefined(<span class="string">'minWeight'</span>), minWeight     = 0;<span class="keyword">end</span>
0038 
0039 <span class="comment">% The percent change in R2 from that of the orignal model.</span>
0040 <span class="comment">% The smaller this number the faster the convergence, the more the fibers</span>
0041 <span class="comment">% kept in the connectome.</span>
0042 <span class="keyword">if</span> notDefined(<span class="string">'prctR2redux'</span>), prctR2redux = 0;<span class="keyword">end</span>
0043 
0044 <span class="comment">% Maximum number of iterations.</span>
0045 <span class="keyword">if</span> notDefined(<span class="string">'maxNumIter'</span>), maxNumIter   = 1000;<span class="keyword">end</span>
0046 
0047 <span class="comment">% Show a plot of the results:</span>
0048 makePlot = 0;
0049 
0050 <span class="comment">% Bookkeeping variables.</span>
0051 all_orig_r2 = [];
0052 all_curr_r2 = [];
0053 all_nfibers = [];
0054 
0055 <span class="comment">% Fit the model and then reduced it by only accepting fibers that pass</span>
0056 <span class="comment">% the minWeights threshold.</span>
0057 <span class="keyword">for</span> iter = 1:maxNumIter
0058   fefit        = <a href="feFitModel.html" class="code" title="function [fit w R2] = feFitModel(M,dSig,fitMethod)">feFitModel</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dSig demeaned'</span>),<span class="string">'sgdnn'</span>);  
0059    
0060   <span class="comment">% Check whether we start loosing percent variance explained when</span>
0061   <span class="comment">% crossvalidating</span>
0062   fexval = <a href="feXvalidate.html" class="code" title="function [xval, r2, rmse] = feXvalidate(M,dSig, fitMethod, crossValType)">feXvalidate</a>(feGet(fe,<span class="string">'Mfiber'</span>),feGet(fe,<span class="string">'dSig demeaned'</span>),<span class="string">'sgdnn'</span>);
0063   
0064   <span class="comment">% STOP criteria: When the fit quality decreases we stop culling.</span>
0065   <span class="comment">% Keep track of the quality of fit.</span>
0066   <span class="keyword">if</span> iter == 1
0067     originalR2 = fexval.r2.mean;  
0068     currentR2  = fexval.r2.mean;
0069   
0070     <span class="comment">% Book-keeping</span>
0071     all_orig_r2 = [all_orig_r2, originalR2];
0072     all_curr_r2 = [all_curr_r2,  currentR2];
0073     all_nfibers = [all_nfibers, feGet(fe,<span class="string">'n fibers'</span>)];
0074   <span class="keyword">else</span>
0075     currentR2  = fexval.r2.mean;
0076     <span class="comment">% Check whether the new R2 is higher then the original. If it is, set</span>
0077     <span class="comment">% the target R2 to the current one.</span>
0078     <span class="keyword">if</span> currentR2 &gt; originalR2, originalR2 = currentR2;<span class="keyword">end</span>
0079   <span class="keyword">end</span>
0080   
0081   <span class="keyword">if</span> currentR2 &lt; ((originalR2) - (originalR2*(prctR2redux/100)))
0082     <span class="comment">% Book-keeping</span>
0083     all_orig_r2 = [all_orig_r2, originalR2];
0084     all_curr_r2 = [all_curr_r2,  currentR2];
0085     all_nfibers = [all_nfibers, length(find(fefit.weights &gt; minWeight))];    
0086     <span class="keyword">break</span>
0087 
0088   <span class="keyword">end</span>
0089   fprintf(<span class="string">'\n\n[%s] n iter: %i, Original R^2: %2.3f, Current R^2: %2.3f.\n\n'</span>,mfilename, iter,originalR2,currentR2)
0090   
0091   <span class="comment">% Compute the cut-off for the fibers</span>
0092   <span class="comment">% minWeight    = prctile(fefit.weights,minWeight);</span>
0093   fibersToKeep = find(fefit.weights &gt; minWeight);
0094   
0095   <span class="comment">% Reduce the connectome.</span>
0096   fe = feConnectomeSelectFibers(fe,fibersToKeep);
0097   
0098   <span class="comment">% Book-keeping</span>
0099   all_orig_r2 = [all_orig_r2, originalR2];
0100   all_curr_r2 = [all_curr_r2,  currentR2];
0101   all_nfibers = [all_nfibers, feGet(fe,<span class="string">'n fibers'</span>)];  
0102 <span class="keyword">end</span>
0103 
0104 fprintf(<span class="string">'[%s] Done culling, in %i iterations.\n    Original R^2: %2.3f, Current R^2: %2.3f.\n'</span>,mfilename, iter,originalR2,currentR2)
0105 
0106 <span class="keyword">if</span> makePlot
0107   <span class="comment">% Make a plot of the culling results</span>
0108   mrvNewGraphWin(<span class="string">'Culling procedure'</span>);
0109   subplot(1,2,1),plot(all_curr_r2,<span class="string">'ko-'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'k'</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'w'</span>,<span class="string">'MarkerSize'</span>,16)
0110   hold on
0111   subplot(1,2,1),plot(all_orig_r2,<span class="string">'ro-'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'r'</span>,<span class="string">'MarkerEdgeColor'</span>,<span class="string">'r'</span>,<span class="string">'MarkerSize'</span>,12)
0112   subplot(1,2,1),plot([iter iter],get(gca,<span class="string">'ylim'</span>))
0113   ylabel(<span class="string">'Percent Variance Explaied (R^2)'</span>), xlabel(<span class="string">'Interation'</span>),legend({<span class="string">'Current R^2'</span>, <span class="string">'Target R2'</span>})
0114   subplot(1,2,2),plot(all_nfibers,<span class="string">'k.-'</span>);
0115   set(gca,<span class="string">'yLim'</span>,[min(all_nfibers)-5 max(all_nfibers) + 5]), ylabel(<span class="string">'Number of Fibers'</span>), xlabel(<span class="string">'Iteration'</span>);
0116   hold on
0117   subplot(1,2,2),plot([iter iter],get(gca,<span class="string">'ylim'</span>))
0118 <span class="keyword">end</span>
0119 
0120 <span class="keyword">return</span></pre></div>
<hr><address>Generated on Tue 01-Jul-2014 11:25:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>