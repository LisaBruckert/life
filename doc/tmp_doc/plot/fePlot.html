<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fePlot</title>
  <meta name="keywords" content="fePlot">
  <meta name="description" content="Gateway routine for plotting from the fascicle evaluation (fe) struct">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">plot</a> &gt; fePlot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for plot&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>fePlot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Gateway routine for plotting from the fascicle evaluation (fe) struct</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [uData, g] = fePlot(fe,plotType,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Gateway routine for plotting from the fascicle evaluation (fe) struct

   [uData, g] = fePlot(fe,plotType,varargin)

 Example
   fePlot(fe,'quality of fit');
   fePlot(fe,'A matrix');

   fePlot(fe,'bvecs');

   fePlot(fe,'dsig measured');

 Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.

-----------
 Plot the fiber group in a matlab 3D mesh.
 uData = fePlot(fe,'connectome')
-----------
 Plots the quality of fit of the LiFE model
 fData = ePlot(fe,'quality of fit');
-----------
 Show an image of the LiFE model/matrix
 uData = fePlot(fe,'model')
-----------
 Plot the series of the measured diffusion signal reordered in such a way
 that close angle in on the sphere are close together in the series. This
 call uses the functionality in feGet(fe,dsig measured', varargin)
 uData = fePlot(fe,'dsig measured')
 uData = fePlot(fe,'dsig measured',voxelIndex)
 uData = fePlot(fe,'dsig measured',coords)
-----------
 Shows the bvecs on a sphere.
 uData = dwiPlot(fe,'bvecs')
-----------
 Plot a histogram of the length of the fibers in the connectome.
 uData = fePlot(fe,'fiber length')
-----------

 Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [uData, g] = fePlot(fe,plotType,varargin)</a>
0002 <span class="comment">% Gateway routine for plotting from the fascicle evaluation (fe) struct</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%   [uData, g] = fePlot(fe,plotType,varargin)</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Example</span>
0007 <span class="comment">%   fePlot(fe,'quality of fit');</span>
0008 <span class="comment">%   fePlot(fe,'A matrix');</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   fePlot(fe,'bvecs');</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%   fePlot(fe,'dsig measured');</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%-----------</span>
0017 <span class="comment">% Plot the fiber group in a matlab 3D mesh.</span>
0018 <span class="comment">% uData = fePlot(fe,'connectome')</span>
0019 <span class="comment">%-----------</span>
0020 <span class="comment">% Plots the quality of fit of the LiFE model</span>
0021 <span class="comment">% fData = ePlot(fe,'quality of fit');</span>
0022 <span class="comment">%-----------</span>
0023 <span class="comment">% Show an image of the LiFE model/matrix</span>
0024 <span class="comment">% uData = fePlot(fe,'model')</span>
0025 <span class="comment">%-----------</span>
0026 <span class="comment">% Plot the series of the measured diffusion signal reordered in such a way</span>
0027 <span class="comment">% that close angle in on the sphere are close together in the series. This</span>
0028 <span class="comment">% call uses the functionality in feGet(fe,dsig measured', varargin)</span>
0029 <span class="comment">% uData = fePlot(fe,'dsig measured')</span>
0030 <span class="comment">% uData = fePlot(fe,'dsig measured',voxelIndex)</span>
0031 <span class="comment">% uData = fePlot(fe,'dsig measured',coords)</span>
0032 <span class="comment">%-----------</span>
0033 <span class="comment">% Shows the bvecs on a sphere.</span>
0034 <span class="comment">% uData = dwiPlot(fe,'bvecs')</span>
0035 <span class="comment">%-----------</span>
0036 <span class="comment">% Plot a histogram of the length of the fibers in the connectome.</span>
0037 <span class="comment">% uData = fePlot(fe,'fiber length')</span>
0038 <span class="comment">%-----------</span>
0039 <span class="comment">%</span>
0040 <span class="comment">% Copyright (2013-2014), Franco Pestilli, Stanford University, pestillifranco@gmail.com.</span>
0041 
0042 <span class="keyword">if</span> notDefined(<span class="string">'fe'</span>),       error(<span class="string">'''fe'' structure required.'</span>); <span class="keyword">end</span>
0043 <span class="keyword">if</span> notDefined(<span class="string">'plotType'</span>), error(<span class="string">'plotType required'</span>); <span class="keyword">end</span>
0044 
0045 <span class="comment">% Open up your window for the current figure</span>
0046 g = mrvNewGraphWin(sprintf(<span class="string">'LiFE - %s - %s'</span>,upper(plotType),feGet(fe,<span class="string">'name'</span>)));
0047 uData = [];
0048 
0049 <span class="comment">% Format the input parameter</span>
0050 plotType = mrvParamFormat(plotType);
0051 
0052 <span class="comment">% Find the plot</span>
0053 <span class="keyword">switch</span> plotType
0054   <span class="keyword">case</span> {<span class="string">'2dhistogram'</span>}
0055       <span class="comment">% Makes a 2D density map.</span>
0056       uData.x  = feGetRep(fe,varargin{1});
0057       uData.y  = feGetRep(fe,varargin{2});
0058       uData.ax.min   = min([uData.x,uData.y]);
0059       uData.ax.max   = max([uData.x,uData.y]);
0060       uData.ax.res   = 100;
0061       uData.ax.bins  = linspace(uData.ax.min,uData.ax.max,uData.ax.res);
0062       ymap = hist3([uData.x;uData.y]',{uData.ax.bins, uData.ax.bins});
0063       uData.sh = imagesc(flipud(ymap));
0064       colormap(flipud(hot)); 
0065       view(0,90);
0066       axis(<span class="string">'square'</span>)
0067       
0068   <span class="keyword">case</span> {<span class="string">'wmvolume'</span>}
0069     <span class="comment">% get the fiber density</span>
0070     mmpVx = feGet(fe,<span class="string">'xform img 2 acpc'</span>);
0071     mmpVx = mmpVx(1:3,1:3);
0072     mmpVx = diag(mmpVx);
0073     vxNum = size(feGet(fe,<span class="string">'roi coords'</span>),1);
0074     connectomeVol = vxNum*prod(mmpVx);<span class="comment">% in mm^3</span>
0075         
0076     <span class="comment">% Total WM volume in the original ROI</span>
0077     testVol = <span class="string">'/azure/scr1/frk/rois/life_right_occipital_example_large_no_cc_smaller.mat'</span>;
0078     ROI = dtiReadRoi(testVol);
0079     vxNum    = size(unique(floor(mrAnatXformCoords(feGet(fe,<span class="string">'xform acpc 2 img'</span>),ROI.coords)),<span class="string">'rows'</span>),1);
0080     totWMvol = vxNum*prod(mmpVx);<span class="comment">% in mm^3</span>
0081     uData = connectomeVol/totWMvol*100;
0082     close(g)
0083 
0084     g(1) = mrvNewGraphWin(sprintf(<span class="string">'%s_percentWMVolume'</span>,feGet(fe,<span class="string">'name'</span>)));
0085     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0086     
0087     <span class="comment">% Volume of the ROI</span>
0088     h = bar(uData,<span class="string">'r'</span>);
0089     set(gca,<span class="string">'ylim'</span>,[60 120],<span class="string">'xlim'</span>,[.5 1.5])
0090     ylabel(<span class="string">'Percent white-matter volume'</span>)
0091     title(sprintf(<span class="string">'Percent volume: %2.2f'</span>,uData))
0092     set(gca,  <span class="string">'ytick'</span>,[60 80 100 120], <span class="keyword">...</span>
0093       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>)
0094     
0095     g(2) = mrvNewGraphWin(sprintf(<span class="string">'%s_WMVolume'</span>,feGet(fe,<span class="string">'name'</span>)));
0096     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0097     
0098     <span class="comment">% Volume of the ROI</span>
0099     h = bar([totWMvol, connectomeVol],<span class="string">'r'</span>);
0100     set(gca,<span class="string">'ylim'</span>,[0 46000],<span class="string">'xlim'</span>,[0 3])
0101     ylabel(<span class="string">'White-matter volume (mm^3)'</span>)
0102     title(sprintf(<span class="string">'Volume: total %6.0fmm^3, connectome %6.0fmm^3'</span>,totWMvol,connectomeVol))
0103     set(gca,  <span class="string">'ytick'</span>,[0 46000/2 46000], <span class="keyword">...</span>
0104         <span class="string">'xticklabel'</span>,{<span class="string">'Total WM'</span>,<span class="string">'Connectome'</span>}, <span class="keyword">...</span>
0105         <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>)
0106     
0107   <span class="keyword">case</span> {<span class="string">'fiberdensitymap'</span>}
0108     <span class="comment">% Select a slice of brain in sagittal vie.</span>
0109     <span class="comment">% only Sagittal view is implemented</span>
0110     <span class="keyword">if</span> isempty(varargin),  slice = 30;
0111     <span class="keyword">else</span> slice = varargin{1}; <span class="keyword">end</span>
0112     <span class="keyword">if</span> ~isempty(varargin) &amp;&amp; length(varargin)==2
0113         fd = varargin{2};
0114     <span class="keyword">else</span>
0115         <span class="comment">% get the fiber density</span>
0116         fd = (feGet(fe,<span class="string">'fiber density'</span>));
0117     <span class="keyword">end</span>
0118     
0119     close(g)
0120     g(1) = mrvNewGraphWin(sprintf(<span class="string">'%s_FiberDensityMapFull'</span>,feGet(fe,<span class="string">'name'</span>)));
0121     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)   
0122     img = feReplaceImageValues(nan(feGet(fe,<span class="string">'map size'</span>)),fd(:,1)',feGet(fe,<span class="string">'roiCoords'</span>));
0123     maxfd = nanmax(img(:)); <span class="comment">% This will be used tonormalize the fiber density plots</span>
0124     surf(((fliplr(img(:,:,slice)./maxfd)'*255)),<span class="keyword">...</span>
0125       <span class="string">'facecolor'</span>,<span class="string">'texture'</span>,<span class="string">'faceAlpha'</span>,1,<span class="string">'edgealpha'</span>,0,<span class="string">'CDataMapping'</span>,<span class="string">'Direct'</span>);
0126     axis off; axis equal;
0127     set(gca,<span class="string">'ylim'</span>,[75 95],<span class="string">'xlim'</span>,[40 65])
0128     view(0,-90)
0129     
0130     cmap = colormap(jet(255));
0131     colorbar(<span class="string">'ytick'</span>,[.25*size(cmap,1) .5*size(cmap,1) .75*size(cmap,1) size(cmap,1)],<span class="string">'yticklabel'</span>, <span class="keyword">...</span>
0132         {num2str(ceil(maxfd/8)) num2str(ceil(maxfd/4)) <span class="keyword">...</span>
0133         num2str(ceil(maxfd/2)) num2str(ceil(maxfd))},<span class="string">'tickdir'</span>,<span class="string">'out'</span>)
0134     
0135     <span class="comment">% Fiber density after life</span>
0136     g(2) = mrvNewGraphWin(sprintf(<span class="string">'%s_FiberDensityMapLiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0137     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0138     img = feReplaceImageValues(nan(feGet(fe,<span class="string">'map size'</span>)),(fd(:,2))',feGet(fe,<span class="string">'roiCoords'</span>));
0139     surf(fliplr(img(:,:,slice)./maxfd)'*255,<span class="keyword">...</span>
0140         <span class="string">'facecolor'</span>,<span class="string">'texture'</span>,<span class="string">'faceAlpha'</span>,1,<span class="string">'edgealpha'</span>,0,<span class="string">'CDataMapping'</span>,<span class="string">'Direct'</span>);
0141     axis off; axis equal;
0142     set(gca,<span class="string">'ylim'</span>,[75 95],<span class="string">'xlim'</span>,[40 65])
0143     <span class="comment">% set(gca,'ylim',[100 130],'xlim',[50 85])</span>
0144     
0145     <span class="comment">%set(gca,'ylim',[70 100],'xlim',[40 65])</span>
0146     view(0,-90)
0147     
0148     cmap = colormap(jet(255));
0149     colorbar(<span class="string">'ytick'</span>,[.25*size(cmap,1) .5*size(cmap,1) .75*size(cmap,1) size(cmap,1)],<span class="string">'yticklabel'</span>, <span class="keyword">...</span>
0150         {num2str(ceil(maxfd/8)) num2str(ceil(maxfd/4)) <span class="keyword">...</span>
0151         num2str(ceil(maxfd/2)) num2str(ceil(maxfd))},<span class="string">'tickdir'</span>,<span class="string">'out'</span>)
0152     
0153     <span class="comment">% Weigth density (sum of weights)</span>
0154     g(3) = mrvNewGraphWin(sprintf(<span class="string">'%s_SumOfWeightsMapLiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0155     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0156     img = feReplaceImageValues(nan(feGet(fe,<span class="string">'map size'</span>)),(fd(:,3))',feGet(fe,<span class="string">'roiCoords'</span>));
0157     maxw = nanmax(img(:)); <span class="comment">% This will be used tonormalize the fiber density plots</span>
0158     minw = nanmin(img(:)); <span class="comment">% This will be used tonormalize the fiber density plots</span>
0159     surf(fliplr(img(:,:,slice+10)./maxw)'*255,<span class="keyword">...</span>
0160         <span class="string">'facecolor'</span>,<span class="string">'texture'</span>,<span class="string">'faceAlpha'</span>,1,<span class="string">'edgealpha'</span>,0,<span class="string">'CDataMapping'</span>,<span class="string">'Direct'</span>);
0161     axis off; axis equal;
0162     set(gca,<span class="string">'ylim'</span>,[75 95],<span class="string">'xlim'</span>,[40 65])
0163     <span class="comment">%set(gca,'ylim',[70 100],'xlim',[40 65])</span>
0164     <span class="comment">%set(gca,'ylim',[100 130],'xlim',[50 85])</span>
0165     view(0,-90)
0166     
0167     cmap = colormap(jet(255));
0168     colorbar(<span class="string">'ytick'</span>,[0 .5*size(cmap,1) size(cmap,1)],<span class="string">'yticklabel'</span>, <span class="keyword">...</span>
0169       {num2str(minw)  num2str(maxw/2)  num2str(maxw)},<span class="string">'tickdir'</span>,<span class="string">'out'</span>)
0170     
0171   <span class="keyword">case</span> {<span class="string">'fiberdensityhist'</span>}
0172     <span class="comment">% get the fiber density</span>
0173     fd = feGet(fe,<span class="string">'fiber density'</span>);
0174     close(g)
0175 
0176     g(1) = mrvNewGraphWin(sprintf(<span class="string">'%s_FiberDensityHistFull_&amp;_LiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0177     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0178     
0179     <span class="comment">% Fiber density before life</span>
0180     edges = logspace(.5,3.2,100);
0181     linspace()
0182     centers = sqrt(edges(1:end-1).*edges(2:end));
0183     uData.full = histc(fd(:,1),edges)/size(fd,1)*100;
0184     h = bar(uData.full,<span class="string">'r'</span>);
0185     set(h,<span class="string">'edgecolor'</span>,<span class="string">'r'</span>,<span class="string">'linewidth'</span>,.01)
0186     set(get(h,<span class="string">'Children'</span>),<span class="string">'FaceAlpha'</span>,.5,<span class="string">'EdgeAlpha'</span>,.5)
0187     
0188     <span class="comment">% Fiber density after life</span>
0189     hold on
0190     uData.life = histc(fd(:,2),edges)/size(fd,1)*100;
0191     h = bar(uData.life,<span class="string">'b'</span>);
0192     set(h,<span class="string">'edgecolor'</span>,<span class="string">'b'</span>,<span class="string">'linewidth'</span>,.01)
0193     set(get(h,<span class="string">'Children'</span>),<span class="string">'FaceAlpha'</span>,.35,<span class="string">'EdgeAlpha'</span>,.35)
0194     set(gca,<span class="string">'ylim'</span>,[0 3],<span class="string">'xlim'</span>,[1 100])
0195     ticks = get(gca,<span class="string">'xtick'</span>); 
0196     ylabel(<span class="string">'Percent white-matter volume'</span>)
0197     xlabel(<span class="string">'Number of fibers per voxel'</span>)
0198     set(gca,  <span class="string">'ytick'</span>,[0 1 2 3], <span class="keyword">...</span>
0199       <span class="string">'xticklabel'</span>, ceil(centers(ticks-1)) ,<span class="keyword">...</span>
0200       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>,<span class="string">'xscale'</span>,<span class="string">'lin'</span>)
0201     
0202     <span class="comment">% Weigth density (sum of weights)</span>
0203     g(2) = mrvNewGraphWin(sprintf(<span class="string">'%s_SumOfWeightsHistLiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0204     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0205     edges = logspace(-7,0,100);
0206     centers = sqrt(edges(1:end-1).*edges(2:end));
0207     y = histc(fd(:,3),edges)/size(fd,1)*100;
0208     h = bar(y,<span class="string">'k'</span>);
0209     set(h,<span class="string">'edgecolor'</span>,<span class="string">'k'</span>,<span class="string">'linewidth'</span>,.01)
0210     ylabel(<span class="string">'Percent white-matter volume'</span>)
0211     xlabel(<span class="string">'Sum of fascicles'' contribution to the voxel signal'</span>)
0212     set(gca,<span class="string">'ylim'</span>,[0 ceil(max(y))],<span class="string">'xlim'</span>,[.5 100])
0213     ticks = get(gca,<span class="string">'xtick'</span>);
0214     set(gca, <span class="string">'ytick'</span>,[0 ceil(max(y))./2 ceil(max(y))], <span class="keyword">...</span>
0215       <span class="string">'xticklabel'</span>, ceil(1000000*centers(ticks-1))/1000000 ,<span class="keyword">...</span>
0216       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>,<span class="string">'xscale'</span>,<span class="string">'lin'</span>)
0217     
0218     <span class="comment">% Weight density (mean of weights)</span>
0219     g(3) = mrvNewGraphWin(sprintf(<span class="string">'%s_MedianWeightsHistLiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0220     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0221     edges = logspace(-7,0,100);
0222     centers = sqrt(edges(1:end-1).*edges(2:end));
0223     y = histc(fd(:,4),edges)/size(fd,1)*100;
0224     h = bar(y,<span class="string">'k'</span>);
0225     set(h,<span class="string">'edgecolor'</span>,<span class="string">'k'</span>,<span class="string">'linewidth'</span>,.01)
0226     ylabel(<span class="string">'Percent white-matter volume'</span>)
0227     xlabel(<span class="string">'Mean fascicles'' contribution to the voxel signal'</span>)
0228       set(gca,<span class="string">'ylim'</span>,[0 ceil(max(y))],<span class="string">'xlim'</span>,[.5 100])
0229     ticks = get(gca,<span class="string">'xtick'</span>);
0230     set(gca, <span class="string">'ytick'</span>,[0 ceil(max(y))./2 ceil(max(y))], <span class="keyword">...</span>
0231       <span class="string">'xticklabel'</span>, ceil(1000000*centers(ticks-1))/1000000 ,<span class="keyword">...</span>
0232       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>,<span class="string">'xscale'</span>,<span class="string">'lin'</span>)
0233 
0234     <span class="comment">% Weight density (var of weights)</span>
0235     g(4) = mrvNewGraphWin(sprintf(<span class="string">'%s_VarianceWeightsHistLiFE'</span>,feGet(fe,<span class="string">'name'</span>)));
0236     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0237     edges = logspace(-7,0,100);
0238     centers = sqrt(edges(1:end-1).*edges(2:end));
0239     y = histc(fd(:,5),edges)/size(fd,1)*100;
0240     h = bar(y,<span class="string">'k'</span>);
0241     set(h,<span class="string">'edgecolor'</span>,<span class="string">'k'</span>,<span class="string">'linewidth'</span>,.01)
0242     ylabel(<span class="string">'Percent white-matter volume'</span>)
0243     xlabel(<span class="string">'Variance of fascicles'' contribution to the voxel signal'</span>)
0244     set(gca,<span class="string">'ylim'</span>,[0 ceil(max(y))],<span class="string">'xlim'</span>,[.5 100])
0245     ticks = get(gca,<span class="string">'xtick'</span>);
0246     set(gca, <span class="string">'ytick'</span>,[0 ceil(max(y))./2 ceil(max(y))], <span class="keyword">...</span>
0247       <span class="string">'xticklabel'</span>, ceil(1000000*centers(ticks-1))/1000000 ,<span class="keyword">...</span>
0248       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>,<span class="string">'xscale'</span>,<span class="string">'lin'</span>)
0249     
0250   <span class="keyword">case</span> {<span class="string">'rmseratiohistogram'</span>}
0251     <span class="comment">% Weigth density after life</span>
0252     set(gcf,<span class="string">'color'</span>,<span class="string">'w'</span>)
0253     R = (feGet(fe,<span class="string">'rmseratio'</span>));
0254  
0255     edges = logspace(-.3,.6,100);
0256     centers = sqrt(edges(1:end-1).*edges(2:end));
0257     y = histc(R,edges)/length(R)*100;
0258     h = bar(y,<span class="string">'k'</span>);
0259     set(h,<span class="string">'edgecolor'</span>,<span class="string">'k'</span>,<span class="string">'linewidth'</span>,.01)
0260     ylabel(<span class="string">'Percent white-matter volume'</span>)
0261     xlabel(<span class="string">'R_{rmse}'</span>)
0262     set(gca,<span class="string">'ylim'</span>,[0 6],<span class="string">'xlim'</span>,[.5 100])
0263     ticks = get(gca,<span class="string">'xtick'</span>);
0264     set(gca, <span class="string">'ytick'</span>,[0 3 6], <span class="keyword">...</span>
0265       <span class="string">'xticklabel'</span>, ceil(100*centers(ticks-1))/100 ,<span class="keyword">...</span>
0266       <span class="string">'box'</span>,<span class="string">'off'</span>,<span class="string">'tickDir'</span>,<span class="string">'out'</span>,<span class="string">'xscale'</span>,<span class="string">'lin'</span>)
0267     
0268   <span class="keyword">case</span> {<span class="string">'map'</span>,<span class="string">'maprep'</span>}
0269     <span class="comment">% Generate the requested map and save it to volume.</span>
0270     <span class="keyword">if</span> (length(plotType) &gt; 3)
0271       <span class="comment">% Use the xvalidation 'get' routine</span>
0272       map = feValues2volume(feGetRep(fe, varargin{1}), <span class="keyword">...</span>
0273         feGet(fe,<span class="string">'roi coords'</span>), <span class="keyword">...</span>
0274         feGetRep(fe,<span class="string">'map size'</span>));
0275     <span class="keyword">else</span>
0276       <span class="comment">% use the default 'get' routine.</span>
0277       map = feValues2volume(feGet(fe, varargin{1}), <span class="keyword">...</span>
0278         feGet(fe,<span class="string">'roi coords'</span>), <span class="keyword">...</span>
0279         feGet(fe,<span class="string">'map size'</span>));
0280     <span class="keyword">end</span>
0281     
0282     <span class="comment">% Get the slices to display (acpc) -120 to 120</span>
0283     <span class="keyword">if</span> (length(varargin)==1), slices = [-11:13];
0284     <span class="keyword">else</span> slices = varargin{2};<span class="keyword">end</span>
0285     
0286     <span class="comment">% The xform is taken from the LiFE structure.</span>
0287     mapXform = feGet(fe,<span class="string">'xform img2acpc'</span>);
0288     
0289     <span class="comment">% Get the T1 anatomy from the session.</span>
0290     ni         = niftiRead(feGet(fe,<span class="string">'anatomy file'</span>));
0291     anatomyImg = double(ni.data);
0292     
0293     <span class="comment">% Get the anatomy xform, from the file?</span>
0294     anatomyXform = ni.qto_xyz;
0295     clear ni;
0296     
0297     <span class="comment">% Get the range of the map to display from the data.</span>
0298     clippingRange = [0 max(map(:))];<span class="comment">%[max([0,min(map(:))]) max([max(map(:)),1])];</span>
0299     mrAnatOverlayMontage(map, mapXform, anatomyImg, anatomyXform, [], clippingRange,slices);
0300     colormap(<span class="string">'autumn'</span>);colorbar(<span class="string">'location'</span>,<span class="string">'eastoutside'</span>)
0301     title(upper(varargin{1}))
0302     
0303   <span class="keyword">case</span> <span class="string">'rmse'</span>
0304     <span class="comment">% Plot a histogram of the RMSE of the LiFE fit.</span>
0305     <span class="comment">% uData = fePlot(fe,'rmse')</span>
0306     uData.totVarExp = feGet(fe,<span class="string">'totpve'</span>);
0307     uData.totrmse   = feGet(fe,<span class="string">'totalrmse'</span>);
0308     uData.rmsebyVox   = feGet(fe,<span class="string">'voxrmse'</span>);
0309     uData.rmsemedian = nanmedian(uData.rmsebyVox);
0310 
0311     <span class="comment">% male a histogram of the length of the fibers</span>
0312     [y,x] = hist(uData.rmsebyVox,ceil(length(uData.rmsebyVox)/10));
0313     bar(x,y,.65,<span class="string">'r'</span>)
0314     hold on
0315     plot([uData.rmsemedian uData.rmsemedian],[0 400],<span class="string">'k'</span>)
0316     title(sprintf(<span class="string">'Total percent variance explained: %2.2f\nTotal RMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0317     xlabel(<span class="string">'Root mean square error'</span>)
0318     ylabel(<span class="string">'Number of occurrences'</span>)
0319      
0320   <span class="keyword">case</span> <span class="string">'pve'</span>
0321     <span class="comment">% Plot a histogram of the percent variance explained in each voxel with</span>
0322     <span class="comment">% the LiFE fit.</span>
0323     <span class="comment">% uData = fePlot(fe,'pve')</span>
0324     uData.totVarExp = feGet(fe,<span class="string">'totpve'</span>);
0325     uData.totrmse   = feGet(fe,<span class="string">'totalrmse'</span>);
0326     uData.pve   = 100*feGet(fe,<span class="string">'voxr2zero'</span>);
0327     uData.pve( uData.pve &lt; -1000 ) = -200; <span class="comment">% if some of the values are -Inf set them to -200</span>
0328     uData.medianpve = nanmedian(uData.pve);
0329 
0330     <span class="comment">% male a histogram of the length of the fibers</span>
0331     [y,x] = hist(uData.pve,ceil(length(uData.pve)/10));
0332     bar(x,y,1,<span class="string">'r'</span>)    
0333     hold on
0334     plot([uData.medianpve uData.medianpve],[0 400],<span class="string">'k'</span>)
0335     title(sprintf(<span class="string">'Percent variance explained: %2.2f\nRMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0336     xlabel(<span class="string">'Percent variance explained'</span>)
0337     ylabel(<span class="string">'Number of occurrences'</span>)
0338 
0339   <span class="keyword">case</span> <span class="string">'rmserep'</span>
0340     <span class="comment">% Plot a histogram of the RMSE of the LiFE fit.</span>
0341     <span class="comment">% uData = fePlot(fe,'rmse')</span>
0342     uData.totVarExp  = feGetRep(fe,<span class="string">'totpve'</span>);
0343     uData.totrmse    = feGetRep(fe,<span class="string">'totalrmse'</span>);
0344     uData.rmsebyVox  = feGetRep(fe,<span class="string">'voxrmse'</span>);
0345     uData.rmsemedian = nanmedian(uData.rmsebyVox);
0346     
0347     <span class="comment">% male a histogram of the length of the fibers</span>
0348     [y,x] = hist(uData.rmsebyVox,ceil(length(uData.rmsebyVox)/10));
0349     bar(x,y,.65,<span class="string">'r'</span>)
0350     hold on
0351     plot([uData.rmsemedian uData.rmsemedian],[0 400],<span class="string">'k'</span>)
0352     title(sprintf(<span class="string">'Total percent variance explained: %2.2f\nTotal RMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0353     xlabel(<span class="string">'Root mean square error'</span>)
0354     ylabel(<span class="string">'Number of occurrences'</span>)
0355      
0356   <span class="keyword">case</span> <span class="string">'pverep'</span>
0357     <span class="comment">% Plot a histogram of the percent variance explained in each voxel with</span>
0358     <span class="comment">% the LiFE fit.</span>
0359     <span class="comment">% uData = fePlot(fe,'pve')</span>
0360     uData.totVarExp = feGetRep(fe,<span class="string">'totpve'</span>);
0361     uData.totrmse   = feGetRep(fe,<span class="string">'totalrmse'</span>);
0362     uData.pve       = 100*feGetRep(fe,<span class="string">'voxr2zero'</span>);
0363     uData.pve( uData.pve &lt; -1000 ) = -200; <span class="comment">% if some of the values are -Inf set them to -200</span>
0364     uData.medianpve = nanmedian(uData.pve);
0365 
0366     <span class="comment">% male a histogram of the length of the fibers</span>
0367     [y,x] = hist(uData.pve,ceil(length(uData.pve)/10));
0368     bar(x,y,1,<span class="string">'r'</span>)    
0369     hold on
0370     plot([uData.medianpve uData.medianpve],[0 400],<span class="string">'k'</span>)
0371     title(sprintf(<span class="string">'Percent variance explained: %2.2f\nRMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0372     xlabel(<span class="string">'Percent variance explained'</span>)
0373     ylabel(<span class="string">'Number of occurrences'</span>)
0374      
0375   <span class="keyword">case</span> <span class="string">'rmserepdata'</span>
0376     <span class="comment">% Plot a histogram of the RMSE of the LiFE fit.</span>
0377     <span class="comment">% uData = fePlot(fe,'rmse')</span>
0378     uData.totVarExp  = feGetRep(fe,<span class="string">'totpvedata'</span>);
0379     uData.totrmse    = feGetRep(fe,<span class="string">'totalrmsedata'</span>);
0380     uData.rmsebyVox  = feGetRep(fe,<span class="string">'voxrmsedata'</span>);
0381     uData.rmsemedian = nanmedian(uData.rmsebyVox);
0382      
0383     <span class="comment">% male a histogram of the length of the fibers</span>
0384     [y,x] = hist(uData.rmsebyVox,ceil(length(uData.rmsebyVox)/10));
0385     bar(x,y,.65,<span class="string">'g'</span>)
0386     hold on
0387     plot([uData.rmsemedian uData.rmsemedian],[0 400],<span class="string">'k'</span>)
0388     title(sprintf(<span class="string">'Total percent variance explained by the data : %2.2f\nTotal RMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0389     xlabel(<span class="string">'Root mean square error'</span>)
0390     ylabel(<span class="string">'Number of occurrences'</span>)
0391   
0392   <span class="keyword">case</span> <span class="string">'pverepdata'</span>
0393     <span class="comment">% Plot a histogram of the percent variance explained in each voxel with</span>
0394     <span class="comment">% the LiFE fit.</span>
0395     <span class="comment">% uData = fePlot(fe,'pve')</span>
0396     uData.totVarExp = feGetRep(fe,<span class="string">'totpvedata'</span>);
0397     uData.totrmse   = feGetRep(fe,<span class="string">'totalrmsedata'</span>);
0398     uData.pve       = 100*feGetRep(fe,<span class="string">'voxr2zerodata'</span>);
0399     uData.pve( uData.pve &lt; -1000 ) = -200; <span class="comment">% if some of the values are -Inf set them to -200</span>
0400     uData.medianpve = nanmedian(uData.pve);
0401     
0402     <span class="comment">% male a histogram of the length of the fibers</span>
0403     [y,x] = hist(uData.pve,ceil(length(uData.pve)/10));
0404     bar(x,y,1,<span class="string">'g'</span>)    
0405     hold on
0406     plot([uData.medianpve uData.medianpve],[0 400],<span class="string">'k'</span>)
0407     title(sprintf(<span class="string">'Percent variance explained by the data: %2.2f\nRMSE: %2.2f'</span>,uData.totVarExp, uData.totrmse))
0408     xlabel(<span class="string">'Percent variance explained'</span>)
0409     ylabel(<span class="string">'Number of occurrences'</span>)
0410   
0411   <span class="keyword">case</span> <span class="string">'rmseratio'</span>
0412     <span class="comment">% Plot a histogram of the RMSE of the LiFE fit.</span>
0413     <span class="comment">% uData = fePlot(fe,'rmseratio')</span>
0414     uData.totVarExpD   = feGetRep(fe,<span class="string">'totpvedata'</span>);
0415     uData.totVarExpM  = feGetRep(fe,<span class="string">'totpve'</span>);
0416     uData.totVarExpMvw= 100*feGetRep(fe,<span class="string">'totalr2voxelwise'</span>);
0417     uData.totrmse     = feGetRep(fe,<span class="string">'totalrmseratio'</span>);
0418     uData.rmsebyVox   = feGetRep(fe,<span class="string">'voxrmseratio'</span>);
0419     uData.medianRmse  = nanmedian(uData.rmsebyVox);
0420     
0421     <span class="comment">% male a histogram of the length of the fibers</span>
0422     [y,x] = hist(uData.rmsebyVox,ceil(length(uData.rmsebyVox)/10));
0423     bar(x,y,.65,<span class="string">'k'</span>)
0424     hold on
0425     plot([uData.medianRmse uData.medianRmse],[0 400],<span class="string">'k'</span>)
0426     title(sprintf(<span class="string">'PVE Data1/Data2 (%2.2f) | Global (%2.2f) | Voxel-wise (%2.2f)\nRMSE Ratio, Total (%2.2f) | Median (%2.2f)'</span>, <span class="keyword">...</span>
0427       uData.totVarExpD, <span class="keyword">...</span>
0428       uData.totVarExpM, <span class="keyword">...</span>
0429       uData.totVarExpMvw, <span class="keyword">...</span>
0430       uData.totrmse,   <span class="keyword">...</span>
0431       uData.medianRmse))
0432     xlabel(<span class="string">'Root mean square error'</span>)
0433     ylabel(<span class="string">'Number of occurrences'</span>)
0434 
0435   <span class="keyword">case</span> <span class="string">'rmseratiovoxelwise'</span>
0436     <span class="comment">% Plot a histogram of the RMSE of the LiFE fit.</span>
0437     <span class="comment">% uData = fePlot(fe,'rmseratio')</span>
0438     uData.totVarExpD  = feGetRep(fe,<span class="string">'totpvedata'</span>);
0439     uData.totVarExpM  = feGetRep(fe,<span class="string">'totpve'</span>);
0440     uData.totVarExpMvw= 100*feGetRep(fe,<span class="string">'totalr2voxelwise'</span>);
0441     uData.totrmse     = feGetRep(fe,<span class="string">'totalrmseratiovoxelwise'</span>);
0442     uData.rmsebyVox   = feGetRep(fe,<span class="string">'voxrmseratiovoxelwise'</span>);
0443     uData.medianRmse  = nanmedian(uData.rmsebyVox);
0444     
0445     <span class="comment">% male a histogram of the length of the fibers</span>
0446     [y,x] = hist(uData.rmsebyVox,ceil(length(uData.rmsebyVox)/10));
0447     bar(x,y,.65,<span class="string">'k'</span>)
0448     hold on
0449     plot([uData.medianRmse uData.medianRmse],[0 400],<span class="string">'k'</span>)
0450     title(sprintf(<span class="string">'PVE Data1/Data2 (%2.2f) | Global (%2.2f) | Voxel-wise (%2.2f)\nRMSE Ratio, Total (%2.2f) | Median (%2.2f)'</span>, <span class="keyword">...</span>
0451       uData.totVarExpD, <span class="keyword">...</span>
0452       uData.totVarExpM, <span class="keyword">...</span>
0453       uData.totVarExpMvw, <span class="keyword">...</span>
0454       uData.totrmse,   <span class="keyword">...</span>
0455       uData.medianRmse))
0456     xlabel(<span class="string">'Root mean square error'</span>)
0457     ylabel(<span class="string">'Number of occurrences'</span>)
0458 
0459   <span class="keyword">case</span> <span class="string">'fiberlength'</span>
0460     <span class="comment">% Plot a histogram of the length of the fibers in the connectome.</span>
0461     <span class="comment">% uData = fePlot(fe,'fiber length')</span>
0462     uData.len       = fefgGet(feGet(fe,<span class="string">'fg acpc'</span>),<span class="string">'length'</span>);
0463     uData.nanmedian = nanmedian(uData.len);
0464     
0465     <span class="comment">% male a histogram of the length of the fibers</span>
0466     [y,x] = hist(uData.len,ceil(length(uData.len)/10));
0467     bar(x,y,2,<span class="string">'r'</span>)
0468     hold on
0469     plot([uData.nanmedian uData.nanmedian],[0 1400],<span class="string">'k'</span>)
0470     title(sprintf(<span class="string">'Total number of fibers: %i'</span>,feGet(fe,<span class="string">'n fibers'</span>)))
0471     xlabel(<span class="string">'Fiber length in mm'</span>)
0472     ylabel(<span class="string">'Number of occurrences'</span>)
0473     
0474   <span class="keyword">case</span> <span class="string">'qualityoffit'</span>
0475     <span class="comment">% Plots the quality of fit of the LiFE model</span>
0476     <span class="comment">% fData = fePlot(fe,'quality of fit');</span>
0477     uData = fePlotQualityOfFit(fe);
0478     
0479   <span class="keyword">case</span> {<span class="string">'mmatrix'</span>,<span class="string">'model'</span>}
0480     <span class="comment">% Show an image of the LiFE model/matrix</span>
0481     <span class="comment">% uData = fePlot(fe,'model')</span>
0482     uData.M = feGet(fe,<span class="string">'M fiber'</span>);
0483     imagesc(uData.M);
0484     
0485   <span class="keyword">case</span> <span class="string">'dsigmeasured'</span>
0486     <span class="comment">% Plot the series of the measured diffusion signal reordered in such a</span>
0487     <span class="comment">% way that close angle in on the sphere are close together in the</span>
0488     <span class="comment">% series. This call uses the functionality in feGet(fe,dsig measured',</span>
0489     <span class="comment">% varargin)</span>
0490     <span class="comment">% uData = fePlot(fe,'dsig measured')</span>
0491     <span class="comment">% uData = fePlot(fe,'dsig measured',voxelIndex)</span>
0492     <span class="comment">% uData = fePlot(fe,'dsig measured',coords)</span>
0493     
0494     <span class="comment">% Use routine in dwiPlot to reorder the x-axis of this so that</span>
0495     <span class="comment">% every voxel is plotted</span>
0496     dsig = feGet(fe,<span class="string">'dsig measured'</span>);
0497     dsig = dsig(1:150);
0498     
0499     <span class="comment">% From dwiPlot</span>
0500     bvecs = feGet(fe,<span class="string">'bvecs'</span>);
0501     
0502     <span class="comment">% Prepare the signal in 2D (imag) format:</span>
0503     bFlat = sphere2flat(bvecs,<span class="string">'xy'</span>);
0504     
0505     <span class="comment">% Interpolating function on the 2D representation</span>
0506     F = TriScatteredInterp(bFlat,dsig(:));
0507     
0508     <span class="comment">% Set the (x,y) range and interpolate</span>
0509     x = linspace(min(bFlat(:,1)),max(bFlat(:,1)),sqrt(feGet(fe,<span class="string">'nbvecs'</span>)));
0510     y = linspace(min(bFlat(:,1)),max(bFlat(:,1)),sqrt(feGet(fe,<span class="string">'nbvecs'</span>)));
0511     [X Y] = meshgrid(x,y);
0512     est = F(X,Y);
0513     est(isnan(est)) = 0;  <span class="comment">% Make extrapolated 0 rather than NaN</span>
0514     <span class="comment">%est = round(est./2);</span>
0515     
0516     inData.x = X;
0517     inData.y = Y;
0518     inData.data = est;
0519     
0520     uData = dwiSpiralPlot(inData);
0521     dwiSpiralPlot(inData);
0522 
0523   <span class="keyword">case</span> <span class="string">'bvecs'</span>
0524     <span class="comment">% Shows the bvecs on a sphere.</span>
0525     <span class="comment">% uData = dwiPlot(fe,'bvecs')</span>
0526     uData = dwiPlot(feGet(fe,<span class="string">'dwi'</span>),<span class="string">'bvecs'</span>);
0527     
0528   <span class="keyword">case</span> {<span class="string">'connectome'</span>,<span class="string">'fg'</span>,<span class="string">'fibers'</span>}    
0529     <span class="comment">% Plot the fiber group in a matlab 3D mesh.</span>
0530     <span class="comment">% uData = fePlot(fe,'fg')</span>
0531     <span class="comment">% We also look for fibers that are 'broken.' And display those as</span>
0532     <span class="comment">% separated fibers.</span>
0533     uData = feConnectomeDisplay(feSplitLoopFibers( feGet(fe,<span class="string">'fg img'</span>)),g);
0534     <span class="comment">%uData = feConnectomeDisplay(feGet(fe,'fg img'),figure);</span>
0535 
0536   <span class="keyword">otherwise</span>
0537     error(<span class="string">'Unknown plot type %s\n'</span>,plotType);
0538 <span class="keyword">end</span>
0539 
0540 <span class="comment">% Set Figure properties</span>
0541 <span class="keyword">if</span> ~notDefined(<span class="string">'uData'</span>)
0542   set(g,<span class="string">'userdata'</span>,uData)
0543 <span class="keyword">end</span>
0544 
0545 <span class="comment">% Set axes properties</span>
0546 set(gca, <span class="string">'FontSize'</span>, 16, <span class="keyword">...</span>
0547   <span class="string">'tickDir'</span>,<span class="string">'out'</span>, <span class="keyword">...</span>
0548   <span class="string">'box'</span>,<span class="string">'off'</span>);
0549 
0550 <span class="keyword">end</span>
0551 
0552 
0553 <span class="comment">%% Scratch</span>
0554 <span class="comment">% g = mrvNewGraphWin;</span>
0555 <span class="comment">% u = randn(128,128);</span>
0556 <span class="comment">% clear uData</span>
0557 <span class="comment">% uData.u = u;</span>
0558 <span class="comment">% imagesc(u);</span>
0559 <span class="comment">% set(g,'userdata',uData);</span>
0560 <span class="comment">%</span>
0561 <span class="comment">% foo = get(g,'userdata')</span>
0562</pre></div>
<hr><address>Generated on Tue 01-Jul-2014 18:45:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>