<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of alphavol</title>
  <meta name="keywords" content="alphavol">
  <meta name="description" content="ALPHAVOL Alpha shape of 2D or 3D point set.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">plot</a> &gt; alphavol.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for plot&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>alphavol
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>ALPHAVOL Alpha shape of 2D or 3D point set.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [V,S] = alphavol(X,R,fig) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">ALPHAVOL Alpha shape of 2D or 3D point set.
   V = ALPHAVOL(X,R) gives the area or volume V of the basic alpha shape
   for a 2D or 3D point set. X is a coordinate matrix of size Nx2 or Nx3.

   R is the probe radius with default value R = Inf. In the default case
   the basic alpha shape (or alpha hull) is the convex hull.

   [V,S] = ALPHAVOL(X,R) outputs a structure S with fields:
    S.tri - Triangulation of the alpha shape (Mx3 or Mx4)
    S.vol - Area or volume of simplices in triangulation (Mx1)
    S.rcc - Circumradius of simplices in triangulation (Mx1)
    S.bnd - Boundary facets (Px2 or Px3)

   ALPHAVOL(X,R,1) plots the alpha shape.

   % 2D Example - C shape
   t = linspace(0.6,5.7,500)';
   X = 2*[cos(t),sin(t)] + rand(500,2);
   subplot(221), alphavol(X,inf,1);
   subplot(222), alphavol(X,1,1);
   subplot(223), alphavol(X,0.5,1);
   subplot(224), alphavol(X,0.2,1);

   % 3D Example - Sphere
   [x,y,z] = sphere;
   [V,S] = alphavol([x(:),y(:),z(:)]);
   trisurf(S.bnd,x,y,z,'FaceColor','blue','FaceAlpha',1)
   axis equal

   % 3D Example - Ring
   [x,y,z] = sphere;
   ii = abs(z) &lt; 0.4;
   X = [x(ii),y(ii),z(ii)];
   X = [X; 0.8*X];
   subplot(211), alphavol(X,inf,1);
   subplot(212), alphavol(X,0.5,1);

   See also DELAUNAY, TRIREP, TRISURF</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="mctDisplayRoi.html" class="code" title="function hRoi = mctDisplayRoi(fh,roi)">mctDisplayRoi</a>	function hs = mctDisplayRoi(roi)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function vol = volumes(T,X)</a></li><li><a href="#_sub2" class="code">function B = trueboundary(B,X)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [V,S] = alphavol(X,R,fig)</a>
0002 <span class="comment">%ALPHAVOL Alpha shape of 2D or 3D point set.</span>
0003 <span class="comment">%   V = ALPHAVOL(X,R) gives the area or volume V of the basic alpha shape</span>
0004 <span class="comment">%   for a 2D or 3D point set. X is a coordinate matrix of size Nx2 or Nx3.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%   R is the probe radius with default value R = Inf. In the default case</span>
0007 <span class="comment">%   the basic alpha shape (or alpha hull) is the convex hull.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%   [V,S] = ALPHAVOL(X,R) outputs a structure S with fields:</span>
0010 <span class="comment">%    S.tri - Triangulation of the alpha shape (Mx3 or Mx4)</span>
0011 <span class="comment">%    S.vol - Area or volume of simplices in triangulation (Mx1)</span>
0012 <span class="comment">%    S.rcc - Circumradius of simplices in triangulation (Mx1)</span>
0013 <span class="comment">%    S.bnd - Boundary facets (Px2 or Px3)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   ALPHAVOL(X,R,1) plots the alpha shape.</span>
0016 <span class="comment">%</span>
0017 <span class="comment">%   % 2D Example - C shape</span>
0018 <span class="comment">%   t = linspace(0.6,5.7,500)';</span>
0019 <span class="comment">%   X = 2*[cos(t),sin(t)] + rand(500,2);</span>
0020 <span class="comment">%   subplot(221), alphavol(X,inf,1);</span>
0021 <span class="comment">%   subplot(222), alphavol(X,1,1);</span>
0022 <span class="comment">%   subplot(223), alphavol(X,0.5,1);</span>
0023 <span class="comment">%   subplot(224), alphavol(X,0.2,1);</span>
0024 <span class="comment">%</span>
0025 <span class="comment">%   % 3D Example - Sphere</span>
0026 <span class="comment">%   [x,y,z] = sphere;</span>
0027 <span class="comment">%   [V,S] = alphavol([x(:),y(:),z(:)]);</span>
0028 <span class="comment">%   trisurf(S.bnd,x,y,z,'FaceColor','blue','FaceAlpha',1)</span>
0029 <span class="comment">%   axis equal</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   % 3D Example - Ring</span>
0032 <span class="comment">%   [x,y,z] = sphere;</span>
0033 <span class="comment">%   ii = abs(z) &lt; 0.4;</span>
0034 <span class="comment">%   X = [x(ii),y(ii),z(ii)];</span>
0035 <span class="comment">%   X = [X; 0.8*X];</span>
0036 <span class="comment">%   subplot(211), alphavol(X,inf,1);</span>
0037 <span class="comment">%   subplot(212), alphavol(X,0.5,1);</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   See also DELAUNAY, TRIREP, TRISURF</span>
0040 
0041 <span class="comment">%   Author: Jonas Lundgren &lt;splinefit@gmail.com&gt; 2010</span>
0042 
0043 <span class="comment">%   2010-09-27  First version of ALPHAVOL.</span>
0044 <span class="comment">%   2010-10-05  DelaunayTri replaced by DELAUNAYN. 3D plots added.</span>
0045 <span class="comment">%   2012-03-08  More output added. DELAUNAYN replaced by DELAUNAY.</span>
0046 
0047 <span class="keyword">if</span> nargin &lt; 2 || isempty(R), R = inf; <span class="keyword">end</span>
0048 <span class="keyword">if</span> nargin &lt; 3, fig = 0; <span class="keyword">end</span>
0049 
0050 <span class="comment">% Check coordinates</span>
0051 dim = size(X,2);
0052 <span class="keyword">if</span> dim &lt; 2 || dim &gt; 3
0053     error(<span class="string">'alphavol:dimension'</span>,<span class="string">'X must have 2 or 3 columns.'</span>)
0054 <span class="keyword">end</span>
0055 
0056 <span class="comment">% Check probe radius</span>
0057 <span class="keyword">if</span> ~isscalar(R) || ~isreal(R) || isnan(R)
0058     error(<span class="string">'alphavol:radius'</span>,<span class="string">'R must be a real number.'</span>)
0059 <span class="keyword">end</span>
0060 
0061 <span class="comment">% Unique points</span>
0062 [X,imap] = unique(X,<span class="string">'rows'</span>);
0063 
0064 <span class="comment">% Delaunay triangulation</span>
0065 T = delaunayn(X);
0066 
0067 <span class="comment">% Remove zero volume tetrahedra since</span>
0068 <span class="comment">% these can be of arbitrary large circumradius</span>
0069 <span class="keyword">if</span> dim == 3
0070     n = size(T,1);
0071     vol = <a href="#_sub1" class="code" title="subfunction vol = volumes(T,X)">volumes</a>(T,X);
0072     epsvol = 1e-12*sum(vol)/n;
0073     T = T(vol &gt; epsvol,:);
0074     holes = size(T,1) &lt; n;
0075 <span class="keyword">end</span>
0076 
0077 <span class="comment">% Limit circumradius of simplices</span>
0078 [~,rcc] = circumcenters(TriRep(T,X));
0079 T = T(rcc &lt; R,:);
0080 rcc = rcc(rcc &lt; R);
0081 
0082 <span class="comment">% Volume/Area of alpha shape</span>
0083 vol = <a href="#_sub1" class="code" title="subfunction vol = volumes(T,X)">volumes</a>(T,X);
0084 V = sum(vol);
0085 
0086 <span class="comment">% Return?</span>
0087 <span class="keyword">if</span> nargout &lt; 2 &amp;&amp; ~fig
0088     <span class="keyword">return</span>
0089 <span class="keyword">end</span>
0090 
0091 <span class="comment">% Turn off TriRep warning</span>
0092 warning(<span class="string">'off'</span>,<span class="string">'MATLAB:TriRep:PtsNotInTriWarnId'</span>)
0093 
0094 <span class="comment">% Alpha shape boundary</span>
0095 <span class="keyword">if</span> ~isempty(T)
0096     <span class="comment">% Facets referenced by only one simplex</span>
0097     B = freeBoundary(TriRep(T,X));
0098     <span class="keyword">if</span> dim == 3 &amp;&amp; holes
0099         <span class="comment">% The removal of zero volume tetrahedra causes false boundary</span>
0100         <span class="comment">% faces in the interior of the volume. Take care of these.</span>
0101         B = <a href="#_sub2" class="code" title="subfunction B = trueboundary(B,X)">trueboundary</a>(B,X);
0102     <span class="keyword">end</span>
0103 <span class="keyword">else</span>
0104     B = zeros(0,dim);
0105 <span class="keyword">end</span>
0106 
0107 <span class="comment">% Plot alpha shape</span>
0108 <span class="keyword">if</span> fig
0109     <span class="keyword">if</span> dim == 2
0110         <span class="comment">% Plot boundary edges and point set</span>
0111         x = X(:,1);
0112         y = X(:,2);
0113         plot(x(B)',y(B)',<span class="string">'r'</span>,<span class="string">'linewidth'</span>,2), hold on
0114         plot(x,y,<span class="string">'k.'</span>), hold off
0115         str = <span class="string">'Area'</span>;
0116     <span class="keyword">elseif</span> ~isempty(B)
0117         <span class="comment">% Plot boundary faces</span>
0118         trisurf(TriRep(B,X),<span class="string">'FaceColor'</span>,<span class="string">'red'</span>,<span class="string">'FaceAlpha'</span>,1/3);
0119         str = <span class="string">'Volume'</span>;
0120     <span class="keyword">else</span>
0121         cla
0122         str = <span class="string">'Volume'</span>;
0123     <span class="keyword">end</span>
0124     axis equal
0125     str = sprintf(<span class="string">'Radius = %g,   %s = %g'</span>,R,str,V);
0126     title(str,<span class="string">'fontsize'</span>,12)
0127 <span class="keyword">end</span>
0128 
0129 <span class="comment">% Turn on TriRep warning</span>
0130 warning(<span class="string">'on'</span>,<span class="string">'MATLAB:TriRep:PtsNotInTriWarnId'</span>)
0131 
0132 <span class="comment">% Return structure</span>
0133 <span class="keyword">if</span> nargout == 2
0134     S = struct(<span class="string">'tri'</span>,imap(T),<span class="string">'vol'</span>,vol,<span class="string">'rcc'</span>,rcc,<span class="string">'bnd'</span>,imap(B));
0135 <span class="keyword">end</span>
0136 
0137 
0138 <span class="comment">%--------------------------------------------------------------------------</span>
0139 <a name="_sub1" href="#_subfunctions" class="code">function vol = volumes(T,X)</a>
0140 <span class="comment">%VOLUMES Volumes/areas of tetrahedra/triangles</span>
0141 
0142 <span class="comment">% Empty case</span>
0143 <span class="keyword">if</span> isempty(T)
0144     vol = zeros(0,1);
0145     <span class="keyword">return</span>
0146 <span class="keyword">end</span>
0147 
0148 <span class="comment">% Local coordinates</span>
0149 A = X(T(:,1),:);
0150 B = X(T(:,2),:) - A;
0151 C = X(T(:,3),:) - A;
0152     
0153 <span class="keyword">if</span> size(X,2) == 3
0154     <span class="comment">% 3D Volume</span>
0155     D = X(T(:,4),:) - A;
0156     BxC = cross(B,C,2);
0157     vol = dot(BxC,D,2);
0158     vol = abs(vol)/6;
0159 <span class="keyword">else</span>
0160     <span class="comment">% 2D Area</span>
0161     vol = B(:,1).*C(:,2) - B(:,2).*C(:,1);
0162     vol = abs(vol)/2;
0163 <span class="keyword">end</span>
0164 
0165 
0166 <span class="comment">%--------------------------------------------------------------------------</span>
0167 <a name="_sub2" href="#_subfunctions" class="code">function B = trueboundary(B,X)</a>
0168 <span class="comment">%TRUEBOUNDARY True boundary faces</span>
0169 <span class="comment">%   Remove false boundary caused by the removal of zero volume</span>
0170 <span class="comment">%   tetrahedra. The input B is the output of TriRep/freeBoundary.</span>
0171 
0172 <span class="comment">% Surface triangulation</span>
0173 facerep = TriRep(B,X);
0174 
0175 <span class="comment">% Find edges attached to two coplanar faces</span>
0176 E0 = edges(facerep);
0177 E1 = featureEdges(facerep, 1e-6);
0178 E2 = setdiff(E0,E1,<span class="string">'rows'</span>);
0179 
0180 <span class="comment">% Nothing found</span>
0181 <span class="keyword">if</span> isempty(E2)
0182     <span class="keyword">return</span>
0183 <span class="keyword">end</span>
0184 
0185 <span class="comment">% Get face pairs attached to these edges</span>
0186 <span class="comment">% The edges connects faces into planar patches</span>
0187 facelist = edgeAttachments(facerep,E2);
0188 pairs = cell2mat(facelist);
0189 
0190 <span class="comment">% Compute planar patches (connected regions of faces)</span>
0191 n = size(B,1);
0192 C = sparse(pairs(:,1),pairs(:,2),1,n,n);
0193 C = C + C' + speye(n);
0194 [~,p,r] = dmperm(C);
0195 
0196 <span class="comment">% Count planar patches</span>
0197 iface = diff(r);
0198 num = numel(iface);
0199 
0200 <span class="comment">% List faces and vertices in patches</span>
0201 facelist = cell(num,1);
0202 vertlist = cell(num,1);
0203 <span class="keyword">for</span> k = 1:num
0204 
0205     <span class="comment">% Neglect singel face patches, they are true boundary</span>
0206     <span class="keyword">if</span> iface(k) &gt; 1
0207         
0208         <span class="comment">% List of faces in patch k</span>
0209         facelist{k} = p(r(k):r(k+1)-1);
0210         
0211         <span class="comment">% List of unique vertices in patch k</span>
0212         vk = B(facelist{k},:);
0213         vk = sort(vk(:))';
0214         ik = [true,diff(vk)&gt;0];
0215         vertlist{k} = vk(ik);
0216         
0217     <span class="keyword">end</span>
0218 <span class="keyword">end</span>
0219 
0220 <span class="comment">% Sort patches by number of vertices</span>
0221 ivert = cellfun(@numel,vertlist);
0222 [ivert,isort] = sort(ivert);
0223 facelist = facelist(isort);
0224 vertlist = vertlist(isort);
0225 
0226 <span class="comment">% Group patches by number of vertices</span>
0227 p = [0;find(diff(ivert));num] + 1;
0228 ipatch = diff(p);
0229 
0230 <span class="comment">% Initiate true boundary list</span>
0231 ibound = true(n,1);
0232 
0233 <span class="comment">% Loop over groups</span>
0234 <span class="keyword">for</span> k = 1:numel(ipatch)
0235 
0236     <span class="comment">% Treat groups with at least two patches and four vertices</span>
0237     <span class="keyword">if</span> ipatch(k) &gt; 1 &amp;&amp; ivert(p(k)) &gt; 3
0238 
0239         <span class="comment">% Find double patches (identical vertex rows)</span>
0240         V = cell2mat(vertlist(p(k):p(k+1)-1));
0241         [V,isort] = sortrows(V);
0242         id = ~any(diff(V),2);
0243         id = [id;0] | [0;id];
0244         id(isort) = id;
0245 
0246         <span class="comment">% Deactivate faces in boundary list</span>
0247         <span class="keyword">for</span> j = find(id')
0248             ibound(facelist{j-1+p(k)}) = 0;
0249         <span class="keyword">end</span>
0250         
0251     <span class="keyword">end</span>
0252 <span class="keyword">end</span>
0253 
0254 <span class="comment">% Remove false faces</span>
0255 B = B(ibound,:);
0256</pre></div>
<hr><address>Generated on Tue 01-Jul-2014 11:25:56 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>